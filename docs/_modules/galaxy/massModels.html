
<!DOCTYPE html>

<html lang="en">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<title>galaxy.massModels | wilfried library 1.0 documentation</title>
<link href="../../_static/pygments.css" rel="stylesheet"/>
<link href="../../_static/theme.313ea551d1799b2102b1.css" rel="stylesheet"/>
<link href="../../_static/plot_directive.css" rel="stylesheet"/>
<link href="../../_static/copybutton.css" rel="stylesheet"/>
<link href="../../search.html" rel="search" title="Search"/>
<link href="../../genindex.html" rel="index" title="Index"/>
</head>
<body class="antialiased text-gray">
<div class="h-screen xl:grid xl:grid-layout" data-action="keydown@window-&gt;search#focus" data-controller="sidebar search" id="page">
<a class="block text-xl bg-white py-4 z-20 absolute top-0 h-18 inset-x-0 text-center transform -translate-y-full focus:translate-y-0 focus:outline-none transition-transform duration-75" href="#galaxy-massmodels" title="Skip navigation links">Skip to content</a>
<header class="grid-area-header z-10 h-14 sm:h-18">
<div class="bg-gray-dark shadow-md flex items-center h-full xl:px-2 relative"><div class="flex items-center">
<button class="xl:hidden h-14 w-14 sm:h-18 sm:w-18 leading-14 sm:leading-18 text-gray-100 hover:bg-gray-700 hover:text-brand focus:outline-none focus:bg-gray-700 focus:text-brand" data-action="sidebar#open" data-sidebar-target="hamburger">
<span class="sr-only">Open navigation menu</span>
<svg aria-hidden="true" class="fill-current h-8 w-8" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg>
</button><a aria-label="Back to homepage" class="hover:bg-gray-700 focus:bg-gray-700 focus:outline-none tooltipped tooltipped-sw" href="../../index.html"><span class="hidden lg:inline-block shrink-0 font-medium text-gray-100 mx-5 leading-14 sm:leading-18 tracking-wider">wilfried library 1.0 documentation</span>
</a></div><div class="flex justify-end items-center flex-1"><form action="../../search.html" class="flex print:hidden justify-between items-center leading-14 sm:leading-18 md:ml-4 bg-gray-dark text-gray-300 focus-within:bg-gray-50 focus-within:text-gray-800 focus-within:absolute focus-within:inset-x-0 focus-within:top-0 md:focus-within:w-full md:focus-within:static" data-action="click-&gt;search#focusSearchInput" id="searchbox" method="get">
<button aria-label="Get search results" class="text-inherit h-14 w-14 sm:h-18 sm:w-18" tabindex="-1">
<svg aria-hidden="true" class="fill-current stroke-current h-8 w-8" stroke-width="0.5" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
</button>
<input aria-label="Search the docs" class="pr-2 bg-transparent text-inherit focus:outline-none w-0 md:w-auto focus:w-full transition-all duration-100" data-search-target="searchInput" id="search-input" name="q" placeholder="Search the docs" type="search"/>
</form></div>
</div>
</header>
<aside class="grid-area-sidebar h-full fixed xl:relative inset-y-0 left-0 z-20 xl:z-0 print:hidden overflow-y-auto transition-all transform transform-gpu -translate-x-full opacity-0 duration-300 xl:translate-x-0 xl:opacity-100" data-sidebar-target="sidebar">
<nav class="h-full overflow-y-auto bg-white text-gray-600 pt-8 flex flex-col" role="navigation">
<div class="nav-toc flex-1 pl-6"><ul>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../dependencies.html">Required dependencies</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../makeLifeSimpler.html">makeLifeSimpler</a></div></li>
<li class="toctree-l1"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/index.html">Useful utilities</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/coloredMessages.html">Colored messages</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/coloredMessages.html#list-of-available-functions">List of available functions</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/coloredMessages.html#example">Example</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/coloredMessages.html#module-utilities.coloredMessages">Documentation</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/dict.html">Dictionaries</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/dict.html#list-of-available-functions">List of available functions</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/dict.html#examples">Examples</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/dict.html#module-utilities.dictionaries">Documentation</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/io.html">Input/Output</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/io.html#list-of-available-functions">List of available functions</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/io.html#examples">Examples</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/io.html#module-utilities.io">Documentation</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/list.html">List manipulations</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/list.html#list-of-available-functions">List of available functions</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/list.html#examples">Examples</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/list.html#module-utilities.lists">Documentation</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/strings.html">Strings manipulation</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/strings.html#list-of-available-functions">List of available functions</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/strings.html#examples">Examples</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/strings.html#module-utilities.strings">Documentation</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/plotUtilities/index.html">Plot utilities</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/plotUtilities/asManyHists.html">Histograms</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/plotUtilities/hst.html">Galfit related plots</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/plotUtilities/misc.html">Miscellaneous</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/plotUtilities/singleContour.html">Contours</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/index.html">Galaxy module</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/angularMomentum.html">Galaxies angular momentum</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/cosmology.html">Cosmology computations</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/geometry.html">Galaxies angular momentum</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/kinematics.html">Galaxy kinematics</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/misc.html">Miscellaneous</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/massModels.html">Galaxy mass models</a></div></li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/models.html">Galaxy models</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/models.html#d-profiles">1D profiles</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/models.html#id1">2D profiles</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/morphology/index.html">Galaxies morphology</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/morphology/index.html#functions-are-split-into-the-following-modules">Functions are split into the following modules:</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/photometry/index.html">Galaxies photometry</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/photometry/index.html#functions-are-split-into-the-following-modules">Functions are split into the following modules:</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galfit/index.html">Galfit module</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galfit/galfit.html">Galfit auto-routines</a></div></li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galfit/models.html">Galfit models</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galfit/models.html#miscellaneous">Miscellaneous</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galfit/models.html#galfit-profiles">Galfit profiles</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galfit/models.html#galfit-additional-tags">Galfit additional tags</a></div></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<button class="text-4xl text-gray-800 p-4 bottom-0 hover:text-brand xl:hidden focus:text-brand self-center" data-action="" title="Close navigation menu">
<span class="sr-only">Close navigation menu</span>
<svg aria-hidden="true" class="fill-current stroke-current h-6 w-6" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</aside>
<main class="px-10 xl:ml-fluid grid-area-main overflow-y-auto flex flex-col h-full mx-0 md:mx-auto xl:mr-0" data-action="scroll-&gt;scroll#showButton" data-controller="scroll"><nav aria-label="breadcrumbs" class="print:hidden mt-12 text-sm text-gray-light" role="navigation">
<a class="text-gray-light text-sm hover:text-gray-dark font-medium focus:text-gray-dark" href="../../index.html">wilfried library 1.0 documentation</a>
<span class="mr-1">/</span><a class="text-gray-light text-sm hover:text-gray-dark" href="../index.html">Module code</a>
<span class="mr-1">/</span><span aria-current="page">galaxy.massModels</span>
</nav>
<article class="flex-1" role="main">
<h1>Source code for galaxy.massModels</h1><div class="highlight"><pre>
<code>    <span class="c1">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">"""</span>
<span class="sd">.. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>

<span class="sd">3D and 2D mass models for different mass and light profiles.</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">numpy</span>                      <span class="k">as</span>     <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">astropy.units</span>              <span class="k">as</span>     <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">wilfried.galaxy.morphology</span> <span class="k">as</span>     <span class="nn">morpho</span>
<span class="kn">from</span>   <span class="nn">astropy.units.core</span>         <span class="kn">import</span> <span class="n">UnitConversionError</span>
<span class="kn">from</span>   <span class="nn">.models</span>                    <span class="kn">import</span> <span class="n">checkAndComputeIe</span><span class="p">,</span> <span class="n">sersic_profile</span>
<span class="kn">from</span>   <span class="nn">.misc</span>                      <span class="kn">import</span> <span class="n">compute_bn</span><span class="p">,</span> <span class="n">realGammainc</span>
<span class="kn">from</span>   <span class="nn">astropy.constants</span>          <span class="kn">import</span> <span class="n">G</span>
<span class="kn">from</span>   <span class="nn">scipy.special</span>              <span class="kn">import</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">k1</span>
<span class="kn">from</span>   <span class="nn">numpy</span>                      <span class="kn">import</span> <span class="n">ndarray</span>

<span class="kn">from</span>   <span class="nn">typing</span>                     <span class="kn">import</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span>   <span class="nn">astropy.cosmology</span>      <span class="kn">import</span> <span class="n">Planck18</span> <span class="k">as</span> <span class="n">cosmo</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span>   <span class="nn">astropy.cosmology</span>      <span class="kn">import</span> <span class="n">Planck15</span> <span class="k">as</span> <span class="n">cosmo</span>

<span class="c1"># Custom types</span>
<span class="n">QuantityType</span> <span class="o">=</span> <span class="n">Type</span><span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">]</span>

<span class="c1">#######################################################################################</span>
<span class="c1">#                           3D profiles and their functions                           #</span>
<span class="c1">#######################################################################################</span>

<div class="viewcode-block" id="MassModelBase"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase">[docs]</a><span class="k">class</span> <span class="nc">MassModelBase</span><span class="p">:</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Base class for mass models.</span>
<span class="sd">    </span>
<span class="sd">    .. warning::</span>
<span class="sd">    </span>
<span class="sd">        When using a method, make sure the unit of the radial distance is identical to that of the scale parameter of the model.</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="MassModelBase.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">M_L</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'solMass.s.cm^2.A/erg)'</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            Units must be given such that they are recognised by astropy.units module.</span>

<span class="sd">        :param int dim: number of dimensions of the model</span>
<span class="sd">        :param float M_L: mass to light ratio</span>
<span class="sd">        :param str unit_M_L: unit of the mass to light ratio. Refer to the specific mass model to know which unit to provide.</span>
<span class="sd">        :raises ValueError: if **dim** is neither an int or **dim** &lt; 1, if **M_L** &lt;= 0, if **M_L** is neither an int or float or np.float16 or np.float32 or np.float64</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Given dimension is not correct.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">M_L</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Mass to light ratio is negative or null.'</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">M_L</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">M_L</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Mass to light ratio must either be an int, float, np.float16, np.float32 or np.float64.'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">M_L</span> <span class="o">=</span> <span class="n">M_L</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_M_L</span><span class="p">)</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">M_L</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Mass to light ratio must either be an int or a float.'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">M_L</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">M_L</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit_M_L</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span> <span class="o">=</span> <span class="n">dim</span></div>
        
        
<div class="viewcode-block" id="MassModelBase.__add__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.__add__">[docs]</a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">'''Add this instance with any other object. Only adding 3D models is allowed.'''</span>
        
        <span class="k">return</span> <span class="n">Multiple3DModels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="MassModelBase._checkR"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase._checkR">[docs]</a>    <span class="k">def</span> <span class="nf">_checkR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">against</span><span class="p">:</span> <span class="n">QuantityType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Check whether radial distance is positive and has a unit.</span>
<span class="sd">        </span>
<span class="sd">        :param r: radial distance</span>
<span class="sd">        :type r: int or float or astropy.units Quantity</span>
<span class="sd">        :param against: parameter to retrieve the unit from</span>
<span class="sd">        :type against: astropy.unit Quantity</span>
<span class="sd">        </span>
<span class="sd">        :returns: the radial distance</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises ValueError: if **r** &lt; 0</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">r</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Radial distance is &lt; 0. Please provide a positive valued distance.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">*=</span> <span class="n">against</span><span class="o">.</span><span class="n">unit</span>

        <span class="k">return</span> <span class="n">r</span></div>
    
    
    <span class="c1">###########################################################</span>
    <span class="c1">#       Default methods (some need to be overriden)       #</span>
    <span class="c1">###########################################################</span>
    
<div class="viewcode-block" id="MassModelBase.flux"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.flux">[docs]</a>    <span class="k">def</span> <span class="nf">flux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Compute the enclosed flux at radius r</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">                    </span>
<span class="sd">            F(&lt;r) = 4\pi \int_0^r dx~x^2 \rho (&lt;x),</span>
<span class="sd">            </span>
<span class="sd">        with :math:`\rho(r)` the light density profile.</span>

<span class="sd">        :param r: radius where to compute the luminosity</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        :returns: flux enclosed in a sphere of radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises NotImplementedError: This method needs be implemented in a subclass first in order to be used</span>
<span class="sd">        '''</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'flux method not implemented yet.'</span><span class="p">)</span>
        <span class="k">return</span></div>
    
    
<div class="viewcode-block" id="MassModelBase.gfield"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.gfield">[docs]</a>    <span class="k">def</span> <span class="nf">gfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the gravitational field at radius r.</span>

<span class="sd">        :param r: radius where the gravitational field is computed</span>
<span class="sd">        :type r: int or float</span>

<span class="sd">        :returns: g(r)</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises NotImplementedError: This method needs be implemented in a subclass first in order to be used</span>
<span class="sd">        '''</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'gfield method not implemented yet.'</span><span class="p">)</span>
        <span class="k">return</span></div>
    
    
<div class="viewcode-block" id="MassModelBase.mass"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.mass">[docs]</a>    <span class="k">def</span> <span class="nf">mass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the enclosed (integrated) mass at radius r.</span>

<span class="sd">        :param r: radius where to compute the mass</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        </span>
<span class="sd">        :returns: mass enclosed in a sphere of radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises NotImplementedError: This method needs be implemented in a subclass first in order to be used</span>
<span class="sd">        '''</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="MassModelBase.mass_profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.mass_profile">[docs]</a>    <span class="k">def</span> <span class="nf">mass_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the **mass density** profile at radius r.</span>

<span class="sd">        :param r: radius where to compute the profile</span>
<span class="sd">        :type r: int or float</span>

<span class="sd">        :returns: mass density profile at radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        '''</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="MassModelBase.profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.profile">[docs]</a>    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the light density profile at radius r.</span>

<span class="sd">        :param r: radius where to compute the profile</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        </span>
<span class="sd">        :returns: light profile at radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises NotImplementedError: This method needs be implemented in a subclass first in order to be used</span>
<span class="sd">        '''</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'profile method not implemented yet.'</span><span class="p">)</span>
        <span class="k">return</span></div>
    
    
<div class="viewcode-block" id="MassModelBase.velocity"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.velocity">[docs]</a>    <span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Velocity profile for a self-sustaining 3D profile against its own gravity through centripedal acceleration</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">            </span>
<span class="sd">            V(r) = \sqrt{\frac{G M(&lt;r)}{r}},</span>
<span class="sd">            </span>
<span class="sd">        where :math:`G` is the gravitational constant and :math:`M(&lt;r)` is the enclosed mass.</span>

<span class="sd">        :param r: radius where the velocity profile is computed</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        </span>
<span class="sd">        :returns: V(r)</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        '''</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">)</span></div>
    
    
    <span class="c1">################################</span>
    <span class="c1">#          Properties          #</span>
    <span class="c1">################################</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Ftot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Total flux of the profile.</span>
<span class="sd">        </span>
<span class="sd">        :raises NotImplementedError: This property needs be implemented in a subclass first in order to be used</span>
<span class="sd">        '''</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'Ftot method not implemented yet.'</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Mtot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Total mass of the profile.</span>
<span class="sd">        </span>
<span class="sd">        :raises NotImplementedError: This property needs be implemented in a subclass first in order to be used</span>
<span class="sd">        '''</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftot</span></div>

<div class="viewcode-block" id="Multiple3DModels"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels">[docs]</a><span class="k">class</span> <span class="nc">Multiple3DModels</span><span class="p">(</span><span class="n">MassModelBase</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    A master class used when combining two 3D models into a single object.</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="Multiple3DModels.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">'''</span>
<span class="sd">        :param model1: 1st model</span>
<span class="sd">        :type model1: MassModelBase[_dim = 3]</span>
<span class="sd">        :param model2: 2nd model</span>
<span class="sd">        :type model2: MassModelBase[_dim = 3]</span>
<span class="sd">        </span>
<span class="sd">        :raises AttributeError: if **model1** or **model2** does not have a **_dim** attribute</span>
<span class="sd">        :raises ValueError: if **model1** or **model2** do not have **_dim** = 3</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="s1">'_dim'</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="s1">'_dim'</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">'One of the objects is not a valid model instance.'</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">model1</span><span class="o">.</span><span class="n">_dim</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">model2</span><span class="o">.</span><span class="n">_dim</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'One of the models is not 3D or higher. Only 3D models can be combined. Cheers !'</span><span class="p">)</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            
        <span class="c1"># We keep track of models in a list</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">Multiple3DModels</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">Multiple3DModels</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">Multiple3DModels</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">Multiple3DModels</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">models</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">Multiple3DModels</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">Multiple3DModels</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">models</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">models</span> <span class="o">+</span> <span class="n">model2</span><span class="o">.</span><span class="n">models</span></div>
            
            
    <span class="c1">######################################################</span>
    <span class="c1">#            Methods (alphabetical order)            #</span>
    <span class="c1">######################################################</span>
    
    <span class="k">def</span> <span class="nf">__checkArgs__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">'''Check args and kwargs so that they have the same len.'''</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)):</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        
        <span class="k">return</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span>
            
    
<div class="viewcode-block" id="Multiple3DModels.gfield"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels.gfield">[docs]</a>    <span class="k">def</span> <span class="nf">gfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]],</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}])</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the full gravitational field at radius r.</span>
<span class="sd">        </span>
<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            Because models can require different arguments (for instance 3D radial distance r for one and 2D R in disk plane for the other), these are separated in lists.</span>
<span class="sd">            Each element will be passed to the corresponding model. The order is the same as in models list variable.</span>
<span class="sd">    </span>
<span class="sd">        :param list[list] args: (**Optional**) arguments to pass to each model. Order is that of models list.</span>
<span class="sd">        :param list[list] kwargs: (**Optional**) kwargs to pass to each model. Order is that of models list.</span>
<span class="sd">        </span>
<span class="sd">        :returns: sum of the gravitational fields for each model</span>
<span class="sd">        '''</span>
        
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checkArgs__</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">gfield</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>
        
        
        
<div class="viewcode-block" id="Multiple3DModels.flux"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels.flux">[docs]</a>    <span class="k">def</span> <span class="nf">flux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]],</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}])</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the enclosed flux at radius r.</span>
<span class="sd">        </span>
<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            Because models can require different arguments (for instance 3D radial distance r for one and 2D R in disk plane for the other), these are separated in lists.</span>
<span class="sd">            Each element will be passed to the corresponding model. The order is the same as in models list variable.</span>
<span class="sd">    </span>
<span class="sd">        :param list[list] args: (**Optional**) arguments to pass to each model. Order is that of models list.</span>
<span class="sd">        :param list[list] kwargs: (**Optional**) kwargs to pass to each model. Order is that of models list.</span>
<span class="sd">        </span>
<span class="sd">        :returns: sum of the flux for each model</span>
<span class="sd">        '''</span>
        
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checkArgs__</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">mass</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>
        
    
<div class="viewcode-block" id="Multiple3DModels.mass"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels.mass">[docs]</a>    <span class="k">def</span> <span class="nf">mass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]],</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}])</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the enclosed mass at radius r.</span>
<span class="sd">        </span>
<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            Because models can require different arguments (for instance 3D radial distance r for one and 2D R in disk plane for the other), these are separated in lists.</span>
<span class="sd">            Each element will be passed to the corresponding model. The order is the same as in models list variable.</span>
<span class="sd">    </span>
<span class="sd">        :param list[list] args: (**Optional**) arguments to pass to each model. Order is that of models list.</span>
<span class="sd">        :param list[list] kwargs: (**Optional**) kwargs to pass to each model. Order is that of models list.</span>
<span class="sd">        </span>
<span class="sd">        :returns: sum of the mass for each model</span>
<span class="sd">        '''</span>
        
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checkArgs__</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">mass</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="Multiple3DModels.mass_profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels.mass_profile">[docs]</a>    <span class="k">def</span> <span class="nf">mass_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]],</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}])</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the mass profile at radius r.</span>

<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            Because models can require different arguments (for instance 3D radial distance r for one and 2D R in disk plane for the other), these are separated in lists.</span>
<span class="sd">            Each element will be passed to the corresponding model. The order is the same as in models list variable.</span>
<span class="sd">    </span>
<span class="sd">        :param list[list] args: (**Optional**) arguments to pass to each model. Order is that of models list.</span>
<span class="sd">        :param list[list] kwargs: (**Optional**) kwargs to pass to each model. Order is that of models list.</span>
<span class="sd">        </span>
<span class="sd">        :returns: sum of the mass density profile for each model</span>
<span class="sd">        '''</span>
        
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checkArgs__</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">mass_profile</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>
    
            
<div class="viewcode-block" id="Multiple3DModels.profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels.profile">[docs]</a>    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]],</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}])</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the light profile at radius r.</span>

<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            Because models can require different arguments (for instance 3D radial distance r for one and 2D R in disk plane for the other), these are separated in lists.</span>
<span class="sd">            Each element will be passed to the corresponding model. The order is the same as in models list variable.</span>
<span class="sd">    </span>
<span class="sd">        :param list[list] args: (**Optional**) arguments to pass to each model. Order is that of models list.</span>
<span class="sd">        :param list[list] kwargs: (**Optional**) kwargs to pass to each model. Order is that of models list.</span>
<span class="sd">        </span>
<span class="sd">        :returns: sum of the light profile for each model</span>
<span class="sd">        '''</span>
        
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checkArgs__</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>
    
    
    <span class="c1">################################################################</span>
    <span class="c1">#                          Velocities                          #</span>
    <span class="c1">################################################################            </span>
    
<div class="viewcode-block" id="Multiple3DModels.velocity"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels.velocity">[docs]</a>    <span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]],</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}])</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Velocity profile for the 3D models against their own gravity through centripedal acceleration.</span>

<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            Because models can require different arguments (for instance 3D radial distance r for one and 2D R in disk plane for the other), these are separated in lists.</span>
<span class="sd">            Each element will be passed to the corresponding model. The order is the same as in models list variable.</span>
<span class="sd">    </span>
<span class="sd">        :param list[list] args: (**Optional**) arguments to pass to each model. Order is that of models list.</span>
<span class="sd">        :param list[list] kwargs: (**Optional**) kwargs to pass to each model. Order is that of models list.</span>
<span class="sd">        </span>
<span class="sd">        :returns: sum of the velocity profile for each model</span>
<span class="sd">        '''</span>
        
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checkArgs__</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">velocity</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span></div>
    
    
    <span class="c1">##############################</span>
    <span class="c1">#         Properties         #</span>
    <span class="c1">##############################</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Ftot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''Total flux of the profiles.'''</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">Ftot</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Mtot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''Total mass of the profiles.'''</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">Mtot</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Hernquist"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Hernquist">[docs]</a><span class="k">class</span> <span class="nc">Hernquist</span><span class="p">(</span><span class="n">MassModelBase</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    3D Hernquist model class.</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="Hernquist.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Hernquist.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">F</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">M_L</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> 
                 <span class="n">unit_a</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">'kpc'</span><span class="p">,</span> <span class="n">unit_F</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">'erg/(s.A)'</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">'solMass.s.A.cm^2/(erg.kpc^2)'</span><span class="p">,</span> 
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        :param a: scale factor</span>
<span class="sd">        :type a: int or float</span>
<span class="sd">        :param F: amplitude parameter (total flux)</span>
<span class="sd">        :type F: int or float</span>
<span class="sd">        :param M_L: mass to light ratio</span>
<span class="sd">        :type M_L: int or float</span>
<span class="sd">               </span>
<span class="sd">        :param str unit_a: unit of the scale parameter a</span>
<span class="sd">        :param str unit_F: unit of the amplitude parameter M</span>
<span class="sd">        :param str unit_M_L: unit used to convert from light to mass profiles</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if **a** or **F** are neither int, float, np.foat16, np.float32 or np.float64</span>
<span class="sd">        '''</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">M_L</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="o">=</span><span class="n">unit_M_L</span><span class="p">)</span>
        
        <span class="c1"># If parameters are already passed as Astropy Quantities, just convert them</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a</span>  <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a</span>  <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">unit_a</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">F</span>  <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_F</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">F</span>  <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">unit_F</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'One of the parameters is not an int, float, np.float16, np.float32 or np.float64.'</span><span class="p">)</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'km/s'</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UnitConversionError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnitConversionError</span><span class="p">(</span><span class="s1">'The unit of Vmax (</span><span class="si">%s</span><span class="s1">) could not be converted to km/s. Please check carefully the units of F, a and M_L parameters. Cheers !'</span> <span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
        
        <span class="c1">#: Offset parameter to make the conversion Re (Sersic) &lt;-&gt; a (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha_a</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.454</span>
        
        <span class="c1">#: Slope parameter to make the conversion Re (Sersic) &lt;-&gt; a (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_beta_a</span>  <span class="o">=</span> <span class="mf">0.725</span>
        
        <span class="c1">#: Offset parameter to make the conversion Ie (Sersic) &lt;-&gt; F (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha_F</span> <span class="o">=</span> <span class="mf">1.194</span>
        
        <span class="c1">#: Slope parameter to make the conversion Ie (Sersic) &lt;-&gt; F (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_beta_F</span>  <span class="o">=</span> <span class="mf">1.75</span></div>
        
        
    <span class="c1">######################################################</span>
    <span class="c1">#            Methods (alphabetical order)            #</span>
    <span class="c1">######################################################    </span>
    
<div class="viewcode-block" id="Hernquist.flux"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Hernquist.flux">[docs]</a>    <span class="k">def</span> <span class="nf">flux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the enclosed flux at radius r.</span>

<span class="sd">        :param r: radius where to compute the luminosity</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        </span>
<span class="sd">        :returns: flux enclosed in a sphere of radius r</span>
<span class="sd">        :rtype: astropy.units Quantity </span>
<span class="sd">        '''</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span></div>
    
    
<div class="viewcode-block" id="Hernquist.gfield"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Hernquist.gfield">[docs]</a>    <span class="k">def</span> <span class="nf">gfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the gravitational field of a single Hernquist profile at radius r.</span>

<span class="sd">        :param r: radius where the gravitational field is computed</span>
<span class="sd">        :type r: int or float</span>

<span class="sd">        :returns: g(r)</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>   
            <span class="k">return</span> <span class="o">-</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span></div>
        
        
<div class="viewcode-block" id="Hernquist.profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Hernquist.profile">[docs]</a>    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the light density profile at radius r.</span>

<span class="sd">        :param r: radius where to compute the profile</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        </span>
<span class="sd">        :returns: light profile at radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span></div>
    
        
<div class="viewcode-block" id="Hernquist.velocity"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Hernquist.velocity">[docs]</a>    <span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">QuantityType</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Velocity profile for a self-sustaining Hernquist 3D profile against its own gravity through centripedal acceleration.</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">            </span>
<span class="sd">            V(r) = \sqrt{\frac{G M(&lt;r)}{r}},</span>
<span class="sd">            </span>
<span class="sd">        where :math:`G` is the gravitational constant and :math:`M(&lt;r)` is the enclosed mass.</span>

<span class="sd">        :param r: radius where the velocity profile is computed</span>
<span class="sd">        :type r: int, float, astropy Quantity or ndarray[float]</span>
<span class="sd">        </span>
<span class="sd">        :returns: velocity profile at a radius **r** in :math:`\rm{km/s}`</span>
<span class="sd">        :rtype: Astropy Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if **r** is neither int, float, np.float16, np.float32, np.foat64 or ndarray</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vr</span>   <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'km/s'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vr</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">+</span><span class="n">r</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">vr</span>       <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">r</span><span class="p">)),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'km/s'</span><span class="p">)</span>
            <span class="n">mask</span>     <span class="o">=</span> <span class="n">r</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="n">rmask</span>    <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">vr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">*</span><span class="n">rmask</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">+</span><span class="n">rmask</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'r array has type </span><span class="si">%s</span><span class="s1"> but only float and numpy array are expected.'</span> <span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">vr</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'km/s'</span><span class="p">)</span></div>
    
    
    <span class="c1">################################</span>
    <span class="c1">#          Properties          #</span>
    <span class="c1">################################</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Ftot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''Total flux of the profile.'''</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">todeVaucouleur</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''Alias of :py:attr:`toSersic`.'''</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">toSersic</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">toSersic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">'''</span>
<span class="sd">        Create the best fit Sersic instance from this Hernquist instance.</span>
<span class="sd">        </span>
<span class="sd">        :returns: Best-fit Sersic instance (see Mercier et al., 2021)</span>
<span class="sd">        :rtype: Sersic</span>
<span class="sd">        '''</span>
        
        <span class="n">Re</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha_a</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_beta_a</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">Ie</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha_F</span> <span class="o">*</span> <span class="n">Re</span><span class="o">.</span><span class="n">value</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_beta_F</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">unit</span><span class="o">/</span><span class="p">(</span><span class="n">Re</span><span class="o">.</span><span class="n">unit</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">deVaucouleur</span><span class="p">(</span><span class="n">Re</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="n">Ie</span><span class="p">,</span> <span class="n">unit_Re</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Re</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span> <span class="n">unit_Ie</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Ie</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span></div>
        
        
<div class="viewcode-block" id="NFW"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW">[docs]</a><span class="k">class</span> <span class="nc">NFW</span><span class="p">(</span><span class="n">MassModelBase</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Navarro Frenk and White profile.</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="NFW.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Rs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">QuantityType</span><span class="p">],</span> 
                 <span class="n">c</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Vmax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">QuantityType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                 <span class="n">unit_Rs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'kpc'</span><span class="p">,</span> <span class="n">unit_Vmax</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'km/s'</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            Two pairs of parameters can be passed:</span>
<span class="sd">                </span>
<span class="sd">                * **Rs** and **c** </span>
<span class="sd">                * **Rs** and **Vmax**</span>

<span class="sd">        :param Rs: scale parameter</span>
<span class="sd">        :type Rs: int or float or astropy.units Quantity with distance unit</span>
<span class="sd">        </span>
<span class="sd">        :param c: (**Optional**)  concentration parameter. If None, **Vmax** must be given.</span>
<span class="sd">        :type c: int or float</span>
<span class="sd">        :param Vmax: (**Optional**) maximum circular velocity at 2.15*Rs. If None, **c** must be given. If not given as an astropy Quantity, provide the correct unit with **unit_Vmax**.</span>
<span class="sd">        :type Vmax: int or float or astropy.units Quantity with velocity unit</span>
<span class="sd">        :param str unit_Rs: (**Optional**) unit of **Rs**</span>
<span class="sd">        :param str unit_Vmax: (**Optional**) unit of **Vmax**</span>
<span class="sd">        </span>
<span class="sd">        :raises ValueError: if both **Vmax** and **c** are None or if both are not None</span>
<span class="sd">        :raises TypeError: if **c** is not dimensionless</span>
<span class="sd">        :raises astropy.units.core.UnitConversionError: if **Vmax** could not be broadcast to km/s unit</span>
<span class="sd">        '''</span>
        
        <span class="n">Rmax</span>              <span class="o">=</span> <span class="mf">2.163</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_factor</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">Rmax</span><span class="p">)</span><span class="o">/</span><span class="n">Rmax</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">Rmax</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">Vmax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">Vmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Either Vmax or c must be None.'</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Rs</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span>       <span class="o">=</span> <span class="n">Rs</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_Rs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span>       <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">Rs</span><span class="p">,</span> <span class="n">unit_Rs</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">Vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless_unscaled</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'concentration parameter must have no unit.'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">c</span>    <span class="o">=</span> <span class="n">c</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">delta_c</span>  <span class="o">=</span> <span class="mi">200</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)))</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_c</span><span class="o">*</span><span class="n">cosmo</span><span class="o">.</span><span class="n">critical_density</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_factor</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'km/s'</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">UnitConversionError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UnitConversionError</span><span class="p">(</span><span class="s1">'The unit of Vmax (</span><span class="si">%s</span><span class="s1">) could not be converted to km/s. Please check carefully the units of Rs. Cheers !'</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_c</span><span class="o">*</span><span class="n">cosmo</span><span class="o">.</span><span class="n">critical_density</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span>        <span class="o">=</span> <span class="n">c</span>
            
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Vmax</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_Vmax</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">Vmax</span><span class="p">,</span> <span class="n">unit_Vmax</span><span class="p">)</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delta_c</span>  <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_factor</span><span class="o">*</span><span class="n">cosmo</span><span class="o">.</span><span class="n">critical_density</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">UnitConversionError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UnitConversionError</span><span class="p">(</span><span class="s1">'delta_c parameter could not be computed as a dimensionless quantity.'</span><span class="p">)</span>
            
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="o">=</span><span class="s1">'solMass.s.A.cm^2/(erg.kpc^2)'</span><span class="p">)</span></div>
      
        
    <span class="c1">######################################################</span>
    <span class="c1">#            Methods (alphabetical order)            #</span>
    <span class="c1">######################################################</span>
    
<div class="viewcode-block" id="NFW.flux"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW.flux">[docs]</a>    <span class="k">def</span> <span class="nf">flux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the enclosed flux at radius r.</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            The flux returned is 0 since this is a DM profile.</span>

<span class="sd">        :param r: radius where to compute the luminosity</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        :returns: flux enclosed in a sphere of radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'erg/(s.A)'</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="NFW.gfield"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW.gfield">[docs]</a>    <span class="k">def</span> <span class="nf">gfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the gravitational field of a single NFW profile at radius r.</span>

<span class="sd">        :param r: radius where the gravitational field is computed</span>
<span class="sd">        :type r: int or float</span>

<span class="sd">        :returns: g(r)</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises NotImplementedError: This method needs be implemented</span>
<span class="sd">        '''</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'gfield not implemented for a NFW profile'</span><span class="p">)</span>
        <span class="k">return</span></div>
    
    
<div class="viewcode-block" id="NFW.mass"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW.mass">[docs]</a>    <span class="k">def</span> <span class="nf">mass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
         <span class="sd">'''</span>
<span class="sd">        Compute the enclosed (integrated) mass at radius r.</span>
<span class="sd">        </span>
<span class="sd">        :param r: radius where to compute the mass</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        :returns: mass enclosed in a sphere of radius r</span>
<span class="sd">        :rtype: astropy.units Quantity'''</span>
        
         <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">r</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">velocity</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">G</span></div>

    
<div class="viewcode-block" id="NFW.mass_profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW.mass_profile">[docs]</a>    <span class="k">def</span> <span class="nf">mass_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the **mass density** profile at radius r.</span>

<span class="sd">        :param r: radius where to compute the profile</span>
<span class="sd">        :type r: int or float</span>

<span class="sd">        :returns: mass density profile at radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_factor</span> <span class="o">*</span> <span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="NFW.profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW.profile">[docs]</a>    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the light density profile at radius r.</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            The light density profile returned is 0 since this is a DM profile.</span>

<span class="sd">        :param r: radius where to compute the profile</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        </span>
<span class="sd">        :returns: light profile at radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'erg/(s.A.cm^2)'</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="NFW.velocity"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW.velocity">[docs]</a>    <span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">QuantityType</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Velocity profile for a self-sustaining 3D profile against its own gravity through centripedal acceleration</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">            </span>
<span class="sd">            V(r) = \sqrt{\frac{G M(&lt;r)}{r}},</span>
<span class="sd">            </span>
<span class="sd">        where :math:`G` is the gravitational constant and :math:`M(&lt;r)` is the enclosed mass.</span>

<span class="sd">        :param r: radius where the velocity profile is computed</span>
<span class="sd">        :type r: int, float, astropy Quantity or ndarray[float]</span>
<span class="sd">        </span>
<span class="sd">        :returns: velocity profile at a radius **r** in :math:`\rm{km/s}`</span>
<span class="sd">        :rtype: Astropy Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if **r** is neither int, float, np.float16, np.float32, np.foat64 or ndarray</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vr</span>   <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'km/s'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vr</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span><span class="o">/</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factor</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">vr</span>       <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">r</span><span class="p">)),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'km/s'</span><span class="p">)</span>
            <span class="n">mask</span>     <span class="o">=</span> <span class="n">r</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="n">rmask</span>    <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">vr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rmask</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span><span class="o">/</span><span class="n">rmask</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">rmask</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factor</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'r array has type </span><span class="si">%s</span><span class="s1"> but only float and numpy array are expected.'</span> <span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">vr</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'km/s'</span><span class="p">)</span></div>
        
    
    <span class="c1">################################</span>
    <span class="c1">#          Properties          #</span>
    <span class="c1">################################</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Ftot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">'''Total flux (infinite).'''</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Mvir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''Virial mass.'''</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="mi">800</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">cosmo</span><span class="o">.</span><span class="n">critical_density</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rvir</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>

    <span class="nd">@property</span>    
    <span class="k">def</span> <span class="nf">Rvir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Virial radius.</span>
<span class="sd">        </span>
<span class="sd">        :raises ValueError: if **c** is None</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Virial radius cannot be computed if the concentration parameter is not provided.'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span></div>
        

<span class="c1">#################################################################################</span>
<span class="c1">#                                Sersic profiles                                #</span>
<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="Sersic"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Sersic">[docs]</a><span class="k">class</span> <span class="nc">Sersic</span><span class="p">:</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    2D Sersic profile class.</span>
<span class="sd">    </span>
<span class="sd">    .. warning::</span>
<span class="sd">    </span>
<span class="sd">        When using a method, make sure the unit of the radial distance is identical to that of the scale parameter of the model.</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="Sersic.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Sersic.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">Re</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> 
                 <span class="n">Ie</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mag</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                 <span class="n">unit_Re</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'kpc'</span><span class="p">,</span> <span class="n">unit_Ie</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'erg/(cm^2.s.A)'</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            You can either provide:</span>
<span class="sd">                </span>
<span class="sd">                * **n**, **Re** and **Ie**</span>
<span class="sd">                * **n**, **Re**, **mag** and **offset**</span>
<span class="sd">        </span>
<span class="sd">        :param n: Sersic index</span>
<span class="sd">        :type n: int or flat</span>
<span class="sd">        :param Re: half-light radius</span>
<span class="sd">        :type Re: int or float</span>
<span class="sd">        </span>
<span class="sd">        :param float Ie: (**Optional**) intensity at half-light radius</span>
<span class="sd">        :param float mag: (**Optional**) galaxy total integrated magnitude used to compute Ie if not given</span>
<span class="sd">        :param float offset: (**Optional**) magnitude offset in the magnitude system used</span>
<span class="sd">        :param str unit_Ie: (**Optional**) unit for the surface brightness. If **Ie** already has a unit, it is converted to this unit.</span>
<span class="sd">        :param str unit_Re: (**Optional**) unit for the scale radius **Re**. If **Re** already has a unit, it is converted to this unit.</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if n or Re are neither int, float, np.float16, np.float32 or np.float64</span>
<span class="sd">        :raises ValueError: if Ie and mag and offset are None, if n &lt;= 0, if Re &lt;= 0 or if Ie &lt;= 0</span>
<span class="sd">        """</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'n is not an int, float, np.float16, np.float32 or np.float64.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Re</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'Re is not an int, float, np.float16, np.float32 or np.float64.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">Ie</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mag</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Ie is None but no magnitude and no offset is given.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">n</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'n must be positive valued. Cheers !'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">Re</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'The effective radius Re must be positive valued. Cheers !'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">Ie</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">Ie</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'The effective radius Re must be positive valued. Cheers !'</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span>     <span class="o">=</span> <span class="mi">2</span>
        
        <span class="c1">#: Sersic index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span>        <span class="o">=</span> <span class="n">n</span>
        
        <span class="c1">#: Sersic :math:`b_n` factor defined as :math:`2\gamma(2n, b_n) = \Gamma(2n)`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bn</span>       <span class="o">=</span> <span class="n">compute_bn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        
        <span class="c1"># If the parameters already are Astropy quantities, we just convert them to the required unit</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Re</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="c1">#: Effective (half-light) radius</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Re</span>   <span class="o">=</span> <span class="n">Re</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_Re</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Re</span>   <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">Re</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit_Re</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Ie</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="c1">#: Surface brightness at Re</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span>   <span class="o">=</span> <span class="n">Ie</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_Ie</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span>   <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">checkAndComputeIe</span><span class="p">(</span><span class="n">Ie</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">offset</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit_Ie</span><span class="p">)</span>
            
        <span class="c1">#: Central intensity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I0</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span></div>
        

    <span class="c1">######################################################</span>
    <span class="c1">#            Methods (alphabetical order)            #</span>
    <span class="c1">######################################################</span>
    
<div class="viewcode-block" id="Sersic._checkR"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Sersic._checkR">[docs]</a>    <span class="k">def</span> <span class="nf">_checkR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">QuantityType</span><span class="p">],</span> <span class="n">against</span><span class="p">:</span> <span class="n">QuantityType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Check whether radial distance is positive and has a unit.</span>
<span class="sd">        </span>
<span class="sd">        :param r: radial distance</span>
<span class="sd">        :type r: int or float or astropy.units Quantity</span>
<span class="sd">        :param against: parameter to retrieve the unit from</span>
<span class="sd">        :type against: astropy.unit Quantity</span>
<span class="sd">        </span>
<span class="sd">        :returns: the radial distance</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises ValueError: if **r** &lt; 0</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">r</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Radial distance is &lt; 0. Please provide a positive valued distance.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">*=</span> <span class="n">against</span><span class="o">.</span><span class="n">unit</span>

        <span class="k">return</span> <span class="n">r</span></div>
        
<div class="viewcode-block" id="Sersic.profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Sersic.profile">[docs]</a>    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Sersic surface brightness profile at radius r.</span>

<span class="sd">        :param r: radius where the profile is computed</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        :returns: Sersic profile computed at the radius r</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sersic_profile</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="p">,</span> <span class="n">bn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="Sersic.flux"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Sersic.flux">[docs]</a>    <span class="k">def</span> <span class="nf">flux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Flux at radius r (encompassed within a disk since this is a 2D profile).</span>

<span class="sd">        :param r: radius where the profile is computed</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        :returns: flux computed within a disk of radius r</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="k">return</span> <span class="n">n2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span><span class="o">*</span><span class="n">realGammainc</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">**</span><span class="n">n2</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Ftot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''Total flux of the profile.'''</span>
        
        <span class="n">n2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="k">return</span> <span class="n">n2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span><span class="o">*</span><span class="n">gamma</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">**</span><span class="n">n2</span></div>
    
    
<div class="viewcode-block" id="deVaucouleur"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.deVaucouleur">[docs]</a><span class="k">class</span> <span class="nc">deVaucouleur</span><span class="p">(</span><span class="n">Sersic</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    2D de Vaucouleur profile.</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="deVaucouleur.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.deVaucouleur.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Re</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">Ie</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mag</span><span class="p">:</span> <span class="nb">float</span>  <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                 <span class="n">unit_Re</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">'kpc'</span><span class="p">,</span> <span class="n">unit_Ie</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'erg/(cm^2.s.A)'</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            You can either provide:</span>
<span class="sd">                </span>
<span class="sd">                * **Re** and **Ie**</span>
<span class="sd">                * **Re**, **mag** and **offset**</span>
<span class="sd">        </span>
<span class="sd">        :param Re: half-light radius</span>
<span class="sd">        :type Re: int or float</span>
<span class="sd">        </span>
<span class="sd">        :param float Ie: (**Optional**) intensity at half-light radius</span>
<span class="sd">        :param float mag: (**Optional**) galaxy total integrated magnitude used to compute Ie if not given</span>
<span class="sd">        :param float offset: (**Optional**) magnitude offset in the magnitude system used</span>
<span class="sd">        :param str unit_Ie: (**Optional**) unit for the surface brightness. If **Ie** already has a unit, it is converted to this unit.</span>
<span class="sd">        :param str unit_Re: (**Optional**) unit for the scale radius **Re**. If **Re** already has a unit, it is converted to this unit.</span>
<span class="sd">        """</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Re</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="n">Ie</span><span class="p">,</span> <span class="n">mag</span><span class="o">=</span><span class="n">mag</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">unit_Re</span><span class="o">=</span><span class="n">unit_Re</span><span class="p">,</span> <span class="n">unit_Ie</span><span class="o">=</span><span class="n">unit_Ie</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1">#: Offset parameter to make the conversion Re (Sersic) &lt;-&gt; a (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha_a</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.454</span>
        
        <span class="c1">#: Slope parameter to make the conversion Re (Sersic) &lt;-&gt; a (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_beta_a</span>  <span class="o">=</span> <span class="mf">0.725</span>
        
        <span class="c1">#: Offset parameter to make the conversion Ie (Sersic) &lt;-&gt; F (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha_F</span> <span class="o">=</span> <span class="mf">1.194</span>
        
        <span class="c1">#: Slope parameter to make the conversion Ie (Sersic) &lt;-&gt; F (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_beta_F</span>  <span class="o">=</span> <span class="mf">1.75</span></div>
        
        
<div class="viewcode-block" id="deVaucouleur.toHernquist"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.deVaucouleur.toHernquist">[docs]</a>    <span class="k">def</span> <span class="nf">toHernquist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M_L</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">unit_M_L</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'solMass.s.A.cm^2/(erg.kpc^2)'</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">Hernquist</span><span class="p">]:</span>
        <span class="sd">'''</span>
<span class="sd">        Create the best-fit Hernquist instance from this de Vaucouleur instance (see Mercier et al., 2021).</span>
<span class="sd">    </span>
<span class="sd">        :param M_L: mass to light ratio</span>
<span class="sd">        :type M_L: int or float</span>
<span class="sd">        </span>
<span class="sd">        :param str unit_M_L: unit of the mass to light ratio. If M_L already has a unit, it is converted to this unit.</span>
<span class="sd">        </span>
<span class="sd">        :returns: best-fit Hernquist instance (see Mercier et al., 2021)</span>
<span class="sd">        :rtype: Hernquist</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if M_L is neither an int, float, float16, float32, float64 or astropy.units Quantity</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">M_L</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'Mass to light ratio must either be an int, float, np.float16, np.float32 or np.float64.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">M_L</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="n">M_L</span> <span class="o">=</span> <span class="n">M_L</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_M_L</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">M_L</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">M_L</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit_M_L</span><span class="p">)</span>
    
        <span class="n">a</span>       <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha_a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">.</span><span class="n">value</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_beta_a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">F</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha_F</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">.</span><span class="n">value</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_beta_F</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">.</span><span class="n">unit</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">.</span><span class="n">unit</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">Hernquist</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">M_L</span><span class="p">,</span> <span class="n">unit_a</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span> <span class="n">unit_F</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span> <span class="n">unit_M_L</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">M_L</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span></div></div>
    

<div class="viewcode-block" id="ExponentialDisk"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.ExponentialDisk">[docs]</a><span class="k">class</span> <span class="nc">ExponentialDisk</span><span class="p">(</span><span class="n">Sersic</span><span class="p">,</span> <span class="n">MassModelBase</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    2D/3D exponential disk profile class (razor-thin).</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        Some functions such as the light profile correspond to the 2D Sersic profiles, while others such as the velocity assume a 3D **razor-thin disk**.</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="ExponentialDisk.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.ExponentialDisk.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Re</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">M_L</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">Ie</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mag</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                 <span class="n">unit_Re</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'kpc'</span><span class="p">,</span> <span class="n">unit_Ie</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'erg/(cm^2.s.A)'</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'solMass.s.A.cm^2/(erg.kpc^2)'</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>        
        <span class="sd">"""</span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            You can either provide:</span>
<span class="sd">                - **M_L**, **Re** and **Ie**</span>
<span class="sd">                - **M_L**, **Re**, **mag** and **offset**</span>
<span class="sd">        </span>
<span class="sd">        :param M_L: mass to light ratio</span>
<span class="sd">        :type M_L: int or float</span>
<span class="sd">        :param Re: half-light radius</span>
<span class="sd">        :type Re: int or float</span>
<span class="sd">        </span>
<span class="sd">        :param float Ie: (**Optional**) intensity at half-light radius</span>
<span class="sd">        :param float mag: (**Optional**) galaxy total integrated magnitude used to compute Ie if not given</span>
<span class="sd">        :param float offset: (**Optional**) magnitude offset in the magnitude system used</span>
<span class="sd">        :param str unit_Ie: (**Optional**) unit for the surface brightness. If **Ie** already has a unit, it is converted to this unit.</span>
<span class="sd">        :param str unit_M_L: (**Optional**) unit of the mass to light ratio</span>
<span class="sd">        :param str unit_Re: (**Optional**) unit for the scale radius **Re**. If **Re** already has a unit, it is converted to this unit.</span>
<span class="sd">        </span>
<span class="sd">        :raises astropy.units.core.UnitConversionError: if **Vmax** could not be broadcast to km/s unit</span>
<span class="sd">        """</span>
        
        <span class="n">MassModelBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">M_L</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="p">)</span>
        <span class="n">Sersic</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>       <span class="bp">self</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Re</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="n">Ie</span><span class="p">,</span> <span class="n">mag</span><span class="o">=</span><span class="n">mag</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">unit_Re</span><span class="o">=</span><span class="n">unit_Re</span><span class="p">,</span> <span class="n">unit_Ie</span><span class="o">=</span><span class="n">unit_Ie</span><span class="p">)</span>
        
        <span class="c1">#: Disk scale length :math:`R_{\rm{d}} = R_{\rm{e}} / b_n`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rd</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span>
        
        <span class="c1">#: Position of maximum velocity :math:`2.15 \times R_{\rm{d}}`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rmax</span>     <span class="o">=</span> <span class="mf">2.15</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#: Maximum velocity :math:`0.8798243 \times \sqrt{\pi G R_{\rm{d}} \Sigma_0 \Upsilon }` with :math:`\Sigma_0` the central surface brightness and :math:`\Upsilon` the mass to light ratio</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span> <span class="o">=</span> <span class="mf">0.8798243</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">I0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'km/s'</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UnitConversionError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnitConversionError</span><span class="p">(</span><span class="s1">'The unit of Vmax (</span><span class="si">%s</span><span class="s1">) could not be converted to km/s. Please check carefully the units of Ie, Re and M_L parameters. Cheers !'</span> <span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">))</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span></div>
        
        
    <span class="c1">######################################################</span>
    <span class="c1">#            Methods (alphabetical order)            #</span>
    <span class="c1">######################################################</span>
    
<div class="viewcode-block" id="ExponentialDisk.velocity"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.ExponentialDisk.velocity">[docs]</a>    <span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">QuantityType</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Velocity profile for a self-sustaining 3D inifinitely thin disk against its own gravity through centripedal acceleration</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">            </span>
<span class="sd">            V(r) = V_{\rm{max}} \frac{r}{0.8798243 \times R_{\rm{d}}} \sqrt{I_0(y) K_0(y) - I_1 (y) K_1 (y)}</span>
<span class="sd">            </span>
<span class="sd">        where :math:`I_i, K_i` are the modified Bessel functions of the first and second kind, respectively, of order i, and  :math:`y = r/(2 R_{\rm{d}})`.</span>

<span class="sd">        :param r: radius where the velocity profile is computed</span>
<span class="sd">        :type r: int, float, astropy Quantity or ndarray[float]</span>
<span class="sd">        </span>
<span class="sd">        :returns: velocity profile at a radius **r** in :math:`\rm{km/s}`</span>
<span class="sd">        :rtype: Astropy Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if **r** is neither int, float, np.float16, np.float32, np.foat64 or ndarray</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vr</span>   <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'km/s'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span>    <span class="o">=</span> <span class="n">r</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="p">)</span>
                <span class="n">vr</span>   <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span><span class="o">*</span><span class="n">r</span><span class="o">/</span><span class="p">(</span><span class="mf">0.8798243</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">i0</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">k0</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">i1</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">k1</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">vr</span>       <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">r</span><span class="p">)),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'km/s'</span><span class="p">)</span>
            <span class="n">mask</span>     <span class="o">=</span> <span class="n">r</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="n">rmask</span>    <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">y</span>        <span class="o">=</span> <span class="n">rmask</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="p">)</span>
            <span class="n">vr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span><span class="o">*</span><span class="n">rmask</span><span class="o">/</span><span class="p">(</span><span class="mf">0.8798243</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">i0</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">k0</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">i1</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">k1</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'r array has type </span><span class="si">%s</span><span class="s1"> but only float and numpy array are expected.'</span> <span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">vr</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'km/s'</span><span class="p">)</span></div></div>
            
        
        

<div class="viewcode-block" id="DoubleExponentialDisk"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.DoubleExponentialDisk">[docs]</a><span class="k">class</span> <span class="nc">DoubleExponentialDisk</span><span class="p">(</span><span class="n">Sersic</span><span class="p">,</span> <span class="n">MassModelBase</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Double exponential disk profile class implementing Bovy rotation curve.</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="DoubleExponentialDisk.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.DoubleExponentialDisk.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Re</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">hz</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">M_L</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> 
                 <span class="n">q0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Ie</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mag</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">inc</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">inc0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                 <span class="n">unit_Re</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'kpc'</span><span class="p">,</span> <span class="n">unit_hz</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'kpc'</span><span class="p">,</span> <span class="n">unit_Ie</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'erg/(cm^2.s.A)'</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'solMass.s.A.cm^2/(erg.kpc^2)'</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            You can either provide:</span>
<span class="sd">                </span>
<span class="sd">                * **M_L**, **hz**, **Re** and **Ie**</span>
<span class="sd">                * **M_L**, **hz**, **Re**, **mag** and **offset**</span>
<span class="sd">                </span>
<span class="sd">            You can also provide **q0** instead of **hz** (which must be None in this case).</span>
<span class="sd">            </span>
<span class="sd">            The observed or intrinsic inclination must be given with **inc** or **inc0**, respectively, if one wants to correct the central surface brightness for the effect of finite thickness.</span>
<span class="sd">            </span>
<span class="sd">        :param hz: vertical scale height</span>
<span class="sd">        :type hz: int or float</span>
<span class="sd">        :param M_L: mass to light ratio</span>
<span class="sd">        :type M_L: int or float</span>
<span class="sd">        :param Re: half-light radius in the plane of symmetry</span>
<span class="sd">        :type Re: int or float</span>
<span class="sd">    </span>
<span class="sd">        :param float inc: (**Optional**) observed inclination (not corrected of the galaxy thickness)</span>
<span class="sd">        :param float inc0: (**Optional**) intrinsic inclination (corrected of the galaxy thickness)</span>
<span class="sd">                </span>
<span class="sd">        :param float Ie: (**Optional**) intensity at half-light radius if the galaxy was seen face-on (must correct for inclination effects)</span>
<span class="sd">        :param float mag: (**Optional**) galaxy total integrated magnitude used to compute **Ie** if not given</span>
<span class="sd">        :param float offset: (**Optional**) magnitude offset in the magnitude system used</span>
<span class="sd">        :param float q0: (**Optional**) axis ratio equal to hz/Rd with Rd the disk scale length. If this value is different from None, it overrides **hz**.</span>
<span class="sd">        :param str unit_Ie: (**Optional**) unit for the surface brightness</span>
<span class="sd">        :param str unit_M_L: (**Optional**) unit of the mass to light ratio</span>
<span class="sd">        :param str unit_Re: (**Optional**) unit for the scale radius **Re**</span>
<span class="sd">        """</span>
        
        <span class="n">MassModelBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">M_L</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="p">)</span>
        <span class="n">Sersic</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>       <span class="bp">self</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Re</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="n">Ie</span><span class="p">,</span> <span class="n">mag</span><span class="o">=</span><span class="n">mag</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">unit_Re</span><span class="o">=</span><span class="n">unit_Re</span><span class="p">,</span> <span class="n">unit_Ie</span><span class="o">=</span><span class="n">unit_Ie</span><span class="p">)</span>
        
        <span class="c1">#: Disk scale length :math:`R_{\rm{d}} = R_{\rm{e}} / b_n`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rd</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span>
        
        <span class="k">if</span> <span class="n">q0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">q0</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">q0</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1">#: Axis ratio</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">q0</span> <span class="o">=</span> <span class="n">q0</span>
                
                <span class="c1">#: Scale height</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'q0 is equal to </span><span class="si">%s</span><span class="s1">, but it must be between 0 and 1.'</span> <span class="o">%</span><span class="n">q0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hz</span>     <span class="o">=</span> <span class="n">hz</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q0</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hz</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span>
            
        <span class="c1"># Surface density computed in Sersic assumes no thickness so we must correct for this effect if the user provides an intrinsic inclination (see Mercier et al., in prep.)</span>
        <span class="k">if</span> <span class="n">inc0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">inc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I0</span>     <span class="o">=</span> <span class="n">morpho</span><span class="o">.</span><span class="n">correct_I0</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q0</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="n">inc</span><span class="p">,</span> <span class="n">inc0</span><span class="o">=</span><span class="n">inc0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span></div>
        
        
    <span class="c1">######################################################</span>
    <span class="c1">#            Methods (alphabetical order)            #</span>
    <span class="c1">######################################################</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_Rmax_razor_thin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''Position of the maximum of the razor-thin disk curve'''</span>
        
        <span class="k">return</span> <span class="mf">2.2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span>
    
<div class="viewcode-block" id="DoubleExponentialDisk._velocity_correction"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.DoubleExponentialDisk._velocity_correction">[docs]</a>    <span class="k">def</span> <span class="nf">_velocity_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">QuantityType</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Velocity correction necessary for the rotation curve</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">        </span>
<span class="sd">            V_{\rm{corr}} (r) = V_{\rm{c, max}} \times \sqrt{\frac{r~e^{1-r/R_{\rm{d}}}}{R_{\rm{d}}}},</span>
<span class="sd">        </span>
<span class="sd">        where :math:`R_{\rm{d}}` is the disk scale length, and :math:`V_{\rm{c, max}}` is the maximum of the velocity correction.</span>

<span class="sd">        :param R: radius where the velocity correction is computed</span>
<span class="sd">        :type R: float or ndarray[float]</span>
<span class="sd">        </span>
<span class="sd">        :returns: velocity correction</span>
<span class="sd">        :rtype: float or ndarray[float]</span>
<span class="sd">        '''</span>
        
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Vmax_correction</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">R</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="DoubleExponentialDisk._velocity_razor_thin"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.DoubleExponentialDisk._velocity_razor_thin">[docs]</a>    <span class="k">def</span> <span class="nf">_velocity_razor_thin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">]:</span>
        <span class="sd">'''</span>
<span class="sd">        Velocity if the disk was razor thin.</span>
<span class="sd">                </span>
<span class="sd">        :param R: radius where the velocity is computed</span>
<span class="sd">        :type R: float or ndarray[float]</span>
<span class="sd">        </span>
<span class="sd">        :returns: velocity if the disk was razor thin</span>
<span class="sd">        :rtype: float or ndarray[float]</span>
<span class="sd">        </span>
<span class="sd">        .. seealso:: :py:meth:`ExponentialDisk.velocity`</span>
<span class="sd">        '''</span>
        
        <span class="n">R</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
        <span class="n">disk_RT</span> <span class="o">=</span> <span class="n">ExponentialDisk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">disk_RT</span><span class="o">.</span><span class="n">velocity</span><span class="p">(</span><span class="n">R</span><span class="p">)</span></div>
        
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_Vmax_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Maximum of the velocity correction</span>
<span class="sd">        </span>
<span class="sd">        .. math ::</span>
<span class="sd">            </span>
<span class="sd">            V_{\rm{c, max}} = \sqrt{2\pi G h_z \Upsilon \Sigma_0 / \exp\lbrace 1 \rbrace},</span>
<span class="sd">            </span>
<span class="sd">        with :math:`\Sigma_0` the central surface brightness if the disk was seen face-on, and :math:`\Upsilon` the mass to light ratio.</span>
<span class="sd">        '''</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hz</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">I0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_Vmax_razor_thin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Maximum velocity if the disk was razor thin.</span>
<span class="sd">        </span>
<span class="sd">        .. seealso:: :py:meth:`ExponentialDisk.velocity`</span>
<span class="sd">        '''</span>
        
        <span class="n">disk_RT</span> <span class="o">=</span> <span class="n">ExponentialDisk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">disk_RT</span><span class="o">.</span><span class="n">Vmax</span>
        
        
<div class="viewcode-block" id="DoubleExponentialDisk.profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.DoubleExponentialDisk.profile">[docs]</a>    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">z</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Light density profile at radius **R** and height **z**</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">            </span>
<span class="sd">            \rho(R, z) = \frac{\Sigma_0}{2 h_z} e^{-R/R_{\rm{e}} - |z|/h_z}</span>
<span class="sd">    </span>
<span class="sd">        with :math:`\Sigma_0 = I_{\rm{e}} e^{b_1}` the central surface density in the plane of the disk, :math:`R_{\rm{e}}` the disk effective radius in the plane of symmetry and :math:`h_z` the vertical scale height.</span>

<span class="sd">        :param R: radial position in the plane of symmetry</span>
<span class="sd">        :type R: int or float</span>
<span class="sd">        :param z: vertical position</span>
<span class="sd">        :type z: int or float</span>
<span class="sd">        </span>
<span class="sd">        :returns: double exponential profile computed at position (**R**, **z**)</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        '''</span>
        
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hz</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sersic_profile</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="p">,</span> <span class="n">bn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">hz</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hz</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="DoubleExponentialDisk.velocity"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.DoubleExponentialDisk.velocity">[docs]</a>    <span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">inner_correction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Velocity profile for a self-sustaining 3D double exponential disk against its own gravity through centripedal acceleration</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">        </span>
<span class="sd">            V(r) = \sqrt{V_{\rm{RT}}^2 (r) - V_{\rm{corr}}^2 (r)},</span>
<span class="sd">        </span>
<span class="sd">        where :math:`V_{\rm{RT}}` is the rotation curve of a similar razor-thin disk, and :math:`V_{\rm{corr}}` is the correction to apply to take into account the finite thickness of the disk.</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            This formula is a `Bovy rotation curve &lt;http://astro.utoronto.ca/~bovy/AST1420/notes-2017/notebooks/05.-Flattened-Mass-Distributions.html#Potentials-for-disks-with-finite-thickness&gt;`_, i.e. an approximation for a thin (but non-zero thickness) disk.</span>
<span class="sd">                </span>
<span class="sd">            This rotation curve is ill-defined below a certain radius which depends on the disk thickness since the correction will become too important near the centre of the galaxy. </span>
<span class="sd">            </span>
<span class="sd">            To correct for this effect, one can use the **inner_correction** optional parameter. This parameter will approximate the rotation curve in the inner parts. The approximation, called inner ramp, corresponds to the tangent which passes through the origin. This simply writes as</span>
<span class="sd">            </span>
<span class="sd">            .. math::</span>
<span class="sd">                </span>
<span class="sd">                V(r) = V_{\rm{d}} (R_0) \times r / R_0,</span>
<span class="sd">                </span>
<span class="sd">            where :math:`V_{\rm{d}}` is the Bovy rotation curve defined above and :math:`R_0` is the radius at which the tangent line passes through the origin. From personal derivations, this radius is the solution of the following equation</span>
<span class="sd">        </span>
<span class="sd">            .. math::</span>

<span class="sd">                x^2 \left [ I_1(x) K_0(x) - I_0(x) K_1(x) \right ] + x I_1(x) K_1(x) + q_0 (x + 0.5) e^{-2x} = 0,</span>
<span class="sd">            </span>
<span class="sd">            where :math:`I_n` and :math:`K_n` are the modified Bessel functions of first and second kind, respectively, and :math:`q_0` is the disk thickness.</span>
<span class="sd">        </span>
<span class="sd">            A numerical approximation, incorrect by less than 1% in the :math:`0 &lt; q_0 &lt; 1` range, is given by</span>
<span class="sd">        </span>
<span class="sd">            .. math::</span>
<span class="sd">            </span>
<span class="sd">                \log R / R_{\rm{d}} = 0.767 + 0.86 \times x - 0.14 \times x^2 - 0.023 \times x^3 + 0.005 \times x^4 + 0.001 \times x^5,</span>
<span class="sd">        </span>
<span class="sd">            where :math:`x = \log q_0`.</span>
<span class="sd">            </span>
<span class="sd">        :param R: radius where the velocity is computed</span>
<span class="sd">        :type R: float or ndarray[float]</span>
<span class="sd">        </span>
<span class="sd">        :param bool inner_correction: (**Optional**) whether to apply the correction in the inner parts (ramp approximation) or not</span>
<span class="sd">        </span>
<span class="sd">        :returns: velocity in :math:`\rm{km/s}`</span>
<span class="sd">        :rtype: Astropy Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if **R** is neither int, float, np.float16, np.float32, np.foat64 or ndarray</span>
<span class="sd">        '''</span>
        
        <span class="n">R</span>                 <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
        <span class="n">v_RT2</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_razor_thin</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># Razor thin velocity squared</span>
        <span class="n">v_corr2</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_correction</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># Bovy approximation correction squared</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            
            <span class="k">if</span> <span class="n">inner_correction</span> <span class="ow">and</span> <span class="n">R</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramp_radius</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">q0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vr</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner_ramp_approximation</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">v_RT2</span> <span class="o">&lt;</span> <span class="n">v_corr2</span><span class="p">:</span>
                <span class="n">vr</span>        <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'km/s'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vr</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v_RT2</span> <span class="o">-</span> <span class="n">v_corr2</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            
            <span class="n">vr</span>            <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">R</span><span class="p">)),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'km/s'</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">inner_correction</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">q0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mask</span>      <span class="o">=</span> <span class="n">R</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramp_radius</span>
                <span class="n">vr</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner_ramp_approximation</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask</span>      <span class="o">=</span> <span class="n">v_corr2</span> <span class="o">&lt;</span> <span class="n">v_RT2</span>
                
            <span class="n">vr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v_RT2</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">v_corr2</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'R array has type </span><span class="si">%s</span><span class="s1"> but only float and numpy array are expected.'</span> <span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">vr</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'km/s'</span><span class="p">)</span></div>
     
      
    <span class="c1">#####################################################</span>
    <span class="c1">#       Inner parts linear ramp approximation       #</span>
    <span class="c1">#####################################################</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_ramp_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">'''Compute the radius where the ramp approximation ends (same unit as Rd).'''</span>
     
        <span class="n">lq0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rd</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.767</span> <span class="o">+</span> <span class="mf">0.86</span><span class="o">*</span><span class="n">lq0</span> <span class="o">-</span> <span class="mf">0.14</span><span class="o">*</span><span class="n">lq0</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.023</span><span class="o">*</span><span class="n">lq0</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mf">0.005</span><span class="o">*</span><span class="n">lq0</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mf">0.001</span><span class="o">*</span><span class="n">lq0</span><span class="o">**</span><span class="mi">5</span><span class="p">)</span>
   
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_ramp_slope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">'''Compute the slope for the ramp approximation.'''</span>
       
        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramp_radius</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">inner_correction</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">/</span> <span class="n">radius</span>
    
<div class="viewcode-block" id="DoubleExponentialDisk.inner_ramp_approximation"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.DoubleExponentialDisk.inner_ramp_approximation">[docs]</a>    <span class="k">def</span> <span class="nf">inner_ramp_approximation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">]:</span>
        <span class="sd">'''</span>
<span class="sd">        Inner ramp approximation. This gives the linear model which is tagent to the bovy rotation curve. It is used to correct the rotation curves in the inner parts where the bovy correction becomes larger than the razor thin disk velocity.</span>

<span class="sd">        :param R: radius where to compute the velocity</span>
<span class="sd">        :type R: float or ndarray[float]</span>
<span class="sd">      </span>
<span class="sd">        :returns: velocity profile for the inner ramp</span>
<span class="sd">        :rtype: float or ndarray[float]</span>
<span class="sd">      </span>
<span class="sd">        :raises TypeError: if **R** is neither int, float, np.float16, np.float32, np.foat64 or ndarray</span>
<span class="sd">        :raises ValueError: if **R** is larger than the ramp radius</span>
<span class="sd">        '''</span>
      
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
      
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">R</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramp_radius</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'At least one radius in </span><span class="si">%s</span><span class="s1"> is larger than the ramp radius </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramp_radius</span><span class="p">))</span>
         
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramp_slope</span> <span class="o">*</span> <span class="n">R</span></div></div>
    
</code></pre></div>
</article>
<footer>
<div class="mt-20 mb-4 text-sm text-gray-700">© 2022, Wilfried Mercier Made with <a href="https://www.sphinx-doc.org">Sphinx 4.4.0</a></div>
</footer></main>
<button class="fixed bottom-0 right-0 z-20 opacity-0 p-4 m-4 tracking-wide bg-gray-900 text-gray-100 transition transform transform-gpu duration-500 translate-y-full" data-action="search#hideSnackbar" data-search-target="snackbar">
  Clear highlights
</button><div class="fixed hidden inset-0 bg-black bg-opacity-50" data-action="click-&gt;sidebar#close" data-sidebar-target="screen">
</div>
</div>
<script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
<script src="../../_static/jquery.js"></script>
<script src="../../_static/underscore.js"></script>
<script src="../../_static/doctools.js"></script>
<script src="../../_static/clipboard.min.js"></script>
<script src="../../_static/copybutton.js"></script>
<script src="../../_static/theme.3666d2347a4c66e5d7a8.js"></script>
</body>
</html>