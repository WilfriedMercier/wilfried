
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>galaxy.misc &#8212; wilfried library 1.0 documentation</title>
    
  <link rel="stylesheet" href="../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  
  <h1 class="site-logo" id="site-title">wilfried library 1.0 documentation</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../index.html">
   Table of content
  </a>
 </li>
</ul>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../dependencies.html">
   Required dependencies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../makeLifeSimpler.html">
   makeLifeSimpler
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../galaxy/index.html">
   Galaxy module
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../galaxy/angularMomentum.html">
     Galaxies angular momentum
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../galaxy/cosmology.html">
     Cosmology computations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../galaxy/kinematics.html">
     Galaxy kinematics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../galaxy/misc.html">
     Miscellaneous
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../galaxy/massModels.html">
     Galaxy mass models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../galaxy/models.html">
     Galaxy models
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../galaxy/morphology/index.html">
     Galaxies morphology
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../galaxy/morphology/SersicFlux.html">
       Sersic fluxes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../galaxy/morphology/Morpho.html">
       Morphological parameters
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../galaxy/morphology/Thickness.html">
       Galaxies thickness
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../galaxy/morphology/MUSE.html">
       MUSE related functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../galaxy/morphology/Other.html">
       Other Sersic related functions
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../galaxy/photometry/index.html">
     Galaxies photometry
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../galaxy/photometry/Fluxes.html">
       Fluxes, colour excess and attenuation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../galaxy/photometry/Masses_SFR.html">
       Masses and SFR estimates
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../galfit/index.html">
   Galfit module
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../galfit/galfit.html">
     Galfit auto-routines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../galfit/models.html">
     Galfit models
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/WilfriedMercier/wilfried"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <h1>Source code for galaxy.misc</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>

<span class="sd">Miscellaneous functions related to galaxy computations.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">scipy.ndimage</span>                      <span class="k">as</span>     <span class="nn">nd</span>
<span class="kn">import</span> <span class="nn">astropy.units</span>                      <span class="k">as</span>     <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">numpy</span>                              <span class="k">as</span>     <span class="nn">np</span>
<span class="kn">from</span>   <span class="nn">numpy.fft</span>                          <span class="kn">import</span> <span class="n">fft2</span><span class="p">,</span> <span class="n">ifft2</span>
<span class="kn">from</span>   <span class="nn">scipy.special</span>                      <span class="kn">import</span> <span class="n">gammaincinv</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gammainc</span>

<span class="c1">#####################################################################</span>
<span class="c1">#                 Sersic profiles related functions                 #</span>
<span class="c1">#####################################################################</span>

<div class="viewcode-block" id="checkAndComputeIe"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.checkAndComputeIe">[docs]</a><span class="k">def</span> <span class="nf">checkAndComputeIe</span><span class="p">(</span><span class="n">Ie</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">bn</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">noError</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Check whether Ie is provided. If not, but the magnitude and magnitude offset are, it computes it.</span>

<span class="sd">    :param float bn: bn factor appearing in the Sersic profile (see below)</span>
<span class="sd">    :param float Ie: intensity at effective radius</span>
<span class="sd">    :param float mag: total integrated magnitude</span>
<span class="sd">    :param n: Sersic index</span>
<span class="sd">    :type n: int or float</span>
<span class="sd">    :param float offset: magnitude offset</span>
<span class="sd">    :param float re: half-light/effective radius</span>

<span class="sd">    :param bool noError: (**Optional**) whether to not raise an error or not when data is missing to compute the intensity. If True, None is returned.</span>
<span class="sd">    </span>
<span class="sd">    :returns: Ie if it could be computed or already existed, or None if **noError** flag is set to True.</span>
<span class="sd">    :rtype: int or float or None</span>
<span class="sd">    </span>
<span class="sd">    :raises ValueError: if neither Ie, nor mag and offset are provided</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>

<span class="sd">        The bn factor is defined by the following equation</span>
<span class="sd">    </span>
<span class="sd">        .. math::</span>
<span class="sd">            </span>
<span class="sd">            2\gamma(2n, b_n) = \Gamma(2n)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">Ie</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">intensity_at_re</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">bn</span><span class="o">=</span><span class="n">bn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">noError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Ie value is None, but mag and/or offset is/are also None. If no Ie is given, please provide a value for the total magnitude and magnitude offset in order to compute the former one. Cheers !&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ie</span></div>
    
<div class="viewcode-block" id="intensity_at_re"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.intensity_at_re">[docs]</a><span class="k">def</span> <span class="nf">intensity_at_re</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">bn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Compute the intensity of a given Sersic profile with index n at the position of the half-light radius re. This assumes to know the integrated magnitude of the profile, as well as the offset used for the magnitude definition.</span>
<span class="sd">    </span>
<span class="sd">    :param float mag: total integrated magnitude of the profile</span>
<span class="sd">    :param n: Sersic index of the given profile</span>
<span class="sd">    :type n: int or float</span>
<span class="sd">    :param float offset: magnitude offset used in the defition of the magnitude system</span>
<span class="sd">    :param float re: effective (half-light) radius</span>

<span class="sd">    :param float bn: (**Optional**) bn factor appearing in the Sersic profile defined as $2\gamma(2n, bn) = \Gamma(2n)$. If None, its value will be computed from n.</span>
<span class="sd">    :returns: the intensity at re</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
 
    <span class="k">if</span> <span class="n">bn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bn</span> <span class="o">=</span> <span class="n">compute_bn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">offset</span> <span class="o">-</span> <span class="n">mag</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">bn</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">gamma</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">re</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">bn</span><span class="p">))</span></div>


<div class="viewcode-block" id="check_bns"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.check_bns">[docs]</a><span class="k">def</span> <span class="nf">check_bns</span><span class="p">(</span><span class="n">listn</span><span class="p">,</span> <span class="n">listbn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Given a list of bn values, check those which are not given (i.e. equal to None), and compute their value using the related Sersic index.</span>

<span class="sd">    :param list[float] listbn: list of bn values</span>
<span class="sd">    :param listn: list of Sersic indices</span>
<span class="sd">    :type listn: list[int] or list[float]</span>
<span class="sd">    :returns: list of bn values</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="p">[</span><span class="n">compute_bn</span><span class="p">(</span><span class="n">listn</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="k">if</span> <span class="n">listbn</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">listbn</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listn</span><span class="p">))]</span></div>


<div class="viewcode-block" id="compute_bn"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.compute_bn">[docs]</a><span class="k">def</span> <span class="nf">compute_bn</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Compute the value of bn used in the definition of a Sersic profile</span>
<span class="sd">    </span>
<span class="sd">    .. math::</span>
<span class="sd">            </span>
<span class="sd">        2\gamma(2n, b_n) = \Gamma(2n)</span>

<span class="sd">    :param n: Sersic index of the profile</span>
<span class="sd">    :type n: int or float</span>
<span class="sd">    :returns: bn</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">n</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">gammaincinv</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></div>


<span class="c1">#####################################################</span>
<span class="c1">#                       Other                       #</span>
<span class="c1">#####################################################</span>

<div class="viewcode-block" id="realGammainc"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.realGammainc">[docs]</a><span class="k">def</span> <span class="nf">realGammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;&#39;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Unnormalised lower incomplete gamma function</span>
<span class="sd">    </span>
<span class="sd">    .. math::</span>
<span class="sd">        </span>
<span class="sd">        \gamma(a, x) = \int_0^x dt~t^{a-1} e^{-t}</span>
<span class="sd">    </span>
<span class="sd">    :param a: power of the gamma function</span>
<span class="sd">    :type a: int or float</span>
<span class="sd">    :param x: upper bound of the integral</span>
<span class="sd">    :type x: int or float</span>
<span class="sd">    :returns: the incomplete gamma function</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">return</span> <span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">gammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="PSFconvolution2D"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.PSFconvolution2D">[docs]</a><span class="k">def</span> <span class="nf">PSFconvolution2D</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">arcsecToGrid</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;Gaussian2D&#39;</span><span class="p">,</span> <span class="s1">&#39;FWHMX&#39;</span><span class="p">:</span><span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;FWHMY&#39;</span><span class="p">:</span><span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;sigmaX&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;sigmaY&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="s1">&#39;arcsec&#39;</span><span class="p">},</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Convolve using fast FFT a 2D array with a pre-defined (2D) PSF.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>

<span class="sd">        **How to use**</span>
<span class="sd">        </span>
<span class="sd">        Best practice is to provide the PSF model FWHM or sigma in arcsec, and the image pixel element resolution (arcsecToPixel), so that the fonction can convert correctly the PSF width in pixels.</span>
<span class="sd">        You can provide either the FWHM or sigma. If both are given, sigma is used.</span>

<span class="sd">    :param data: data to be convolved with the PSF</span>
<span class="sd">    :type data: 2D ndarray</span>
<span class="sd">        </span>
<span class="sd">    :param float arcsecToGrid: (**Optional**) conversion factor from arcsec to the grid pixel size, that is the width and height of a single pixel in the X and Y grids. Default is the pixel size of HST-ACS images (0.03&quot;/px).</span>
<span class="sd">    :param dict model: (**Optional**) dictionnary of the PSF (and its parameters) to use for the convolution. Default is a (0, 0) centred radial gaussian (muX=muY=0 and sigmaX=sigmaY) with a FWHM corresponding to that of MUSE (~0.8&quot;~4 MUSE pixels). For now, only 2D Gaussians are accepted as PSF.</span>
<span class="sd">    :param bool verbose: (**Optional**) whether to print text on stdout or not</span>

<span class="sd">    :returns: a new convolved image</span>
<span class="sd">    :rtype: 2D ndarray[float]</span>
<span class="sd">    </span>
<span class="sd">    :raises ValueError: </span>
<span class="sd">        </span>
<span class="sd">        * if unit key in **model** dict is not a valid astropy unit </span>
<span class="sd">        * if the PSF is not a 2D Gaussian model</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="nf">setListFromDict</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fill a list with values from a dictionary or from default ones if the given key is not in the dictionary.</span>
<span class="sd">        </span>
<span class="sd">        Mandatory inputs</span>
<span class="sd">        ----------------</span>
<span class="sd">            dictionary : dict</span>
<span class="sd">                dictionary to get the keys values from</span>
<span class="sd">        </span>
<span class="sd">        Optional inputs</span>
<span class="sd">        ---------------</span>
<span class="sd">            default : list</span>
<span class="sd">                list of default values if given key is not in dictionary</span>
<span class="sd">            keys : list of str</span>
<span class="sd">                list of key names whose values will be appended into the list</span>
<span class="sd">                </span>
<span class="sd">        Return a list with values retrived from a dictionary keys or from a list of default values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Convoluting using PSF model </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">model</span><span class="p">)</span>
    
    <span class="c1"># Retrieve PSF parameters and set default values if not provided</span>
    <span class="k">if</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;gaussian2d&#39;</span><span class="p">:</span>
        <span class="n">sigmaX</span><span class="p">,</span> <span class="n">sigmaY</span><span class="p">,</span> <span class="n">FWHMX</span><span class="p">,</span> <span class="n">FWHMY</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">setListFromDict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sigmaX&#39;</span><span class="p">,</span> <span class="s1">&#39;sigmaY&#39;</span><span class="p">,</span> <span class="s1">&#39;FWHMX&#39;</span><span class="p">,</span> <span class="s1">&#39;FWHMY&#39;</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s2">&quot;arcsec&quot;</span><span class="p">])</span>
        
        <span class="c1"># Compute sigma from FWHM if sigma is not provided</span>
        <span class="k">if</span> <span class="n">sigmaX</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sigmaX</span> <span class="o">=</span> <span class="n">FWHMX</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">sigmaY</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sigmaY</span> <span class="o">=</span> <span class="n">FWHMY</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
            
        <span class="c1"># Convert sigma to arcsec and then go in grid pixel values</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sigmaX</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">sigmaX</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;arcsec&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">arcsecToGrid</span>
            <span class="n">sigmaY</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">sigmaY</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;arcsec&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">arcsecToGrid</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Given unit </span><span class="si">%s</span><span class="s1"> is not valid. Angles may generally be given in units of deg, arcmin, arcsec, hourangle, or rad.&#39;</span><span class="p">)</span>
        
        <span class="c1"># Perform convolution</span>
        <span class="n">image</span>     <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">image</span>     <span class="o">=</span> <span class="n">fft2</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">image</span>     <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">fourier_gaussian</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="p">[</span><span class="n">sigmaX</span><span class="p">,</span> <span class="n">sigmaY</span><span class="p">])</span>
        <span class="n">image</span>     <span class="o">=</span> <span class="n">ifft2</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Given model </span><span class="si">%s</span><span class="s1"> is not recognised or implemented yet. Only gaussian2d model is accepted.&#39;</span> <span class="o">%</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="n">image</span></div>
    
<div class="viewcode-block" id="fromStructuredArrayOrNot"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.fromStructuredArrayOrNot">[docs]</a><span class="k">def</span> <span class="nf">fromStructuredArrayOrNot</span><span class="p">(</span><span class="n">gal</span><span class="p">,</span> <span class="n">magD</span><span class="p">,</span> <span class="n">magB</span><span class="p">,</span> <span class="n">Rd</span><span class="p">,</span> <span class="n">Rb</span><span class="p">,</span> <span class="n">noStructuredArray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Store values of the disk magnitude, the bulge magnitude, the disk effective radius and the bulge effective radius either directly from the given values or from a numpy structured array.</span>

<span class="sd">    :param gal: structured array with data for all the galaxies. The required column names are &#39;R_d_GF&#39; (re for the disk component), &#39;R_b_GF&#39; (re for the bulge component), &#39;Mag_d_GF&#39; (the total integrated magnitude for the disk component), &#39;Mag_b_GF&#39; (the total integrated magnitude for the bulge component).</span>
<span class="sd">    :type gal: structured ndarray</span>
<span class="sd">    :param magB: total magnitude of the bulge component of the galaxies</span>
<span class="sd">    :type magB: float or list(float)</span>
<span class="sd">    :param magD: total magnitude of the disk component of the galaxies</span>
<span class="sd">    :type magD: float or list(float)</span>
<span class="sd">    :param Rb: half-light radius of the bulge components of the galaxies</span>
<span class="sd">    :type Rb: float or list(float)</span>
<span class="sd">    :param Rd: half-light radius of the disk components of the galaxies</span>
<span class="sd">    :type Rd: float or list(float)</span>
<span class="sd">    :param bool noStructuredArray: if False, the structured array gal will be used. If False, values of the magnitudes and half-light radii of the two components must be given.</span>

<span class="sd">    :returns: the disk magnitude, the bulge magnitude, the disk effective radius and the bulge effective radius</span>
<span class="sd">    :rtype: float, float, float, float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#if no structured array is given, check that each necessary variable is given instead</span>
    <span class="k">if</span> <span class="n">noStructuredArray</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">magD</span><span class="p">,</span> <span class="n">magB</span><span class="p">,</span> <span class="n">Rd</span><span class="p">,</span> <span class="n">Rb</span><span class="p">]]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ValueError: a None found. One of the inputs in the list magD, magB, Rd, Rb was not provided. If you are not using the structured array feature, you must provide magnitude and effective values for all galaxies and for both profiles (exponential disk and bulge)&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">magD</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">magD</span><span class="p">)</span>
            <span class="n">magB</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">magB</span><span class="p">)</span>
            <span class="n">Rd</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Rd</span><span class="p">)</span>
            <span class="n">Rb</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Rb</span><span class="p">)</span>
    <span class="c1">#if a structured array is given, retrieve the correct columns</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">magD</span>         <span class="o">=</span> <span class="n">gal</span><span class="p">[</span><span class="s1">&#39;Mag_d_GF&#39;</span><span class="p">]</span>
        <span class="n">magB</span>         <span class="o">=</span> <span class="n">gal</span><span class="p">[</span><span class="s1">&#39;Mag_b_GF&#39;</span><span class="p">]</span>
        <span class="n">Rd</span>           <span class="o">=</span> <span class="n">gal</span><span class="p">[</span><span class="s1">&#39;R_d_GF&#39;</span><span class="p">]</span>
        <span class="n">Rb</span>           <span class="o">=</span> <span class="n">gal</span><span class="p">[</span><span class="s1">&#39;R_b_GF&#39;</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">magD</span><span class="p">,</span> <span class="n">magB</span><span class="p">,</span> <span class="n">Rd</span><span class="p">,</span> <span class="n">Rb</span></div>


<span class="c1">####################################################################################################</span>
<span class="c1">#                                            Trash                                                 #</span>
<span class="c1">####################################################################################################</span>

<div class="viewcode-block" id="mergeModelsIntoOne"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.mergeModelsIntoOne">[docs]</a><span class="k">def</span> <span class="nf">mergeModelsIntoOne</span><span class="p">(</span><span class="n">listX</span><span class="p">,</span> <span class="n">listY</span><span class="p">,</span> <span class="n">listModels</span><span class="p">,</span> <span class="n">pixWidth</span><span class="p">,</span> <span class="n">pixHeight</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Sum the contribution of different models with distorted X and Y grids into a single image with a regular grid.</span>
<span class="sd">    </span>
<span class="sd">    .. deprecated::</span>
<span class="sd">        </span>
<span class="sd">        This function is deprecated and may be removed soon.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">    </span>
<span class="sd">        **How to use**</span>
<span class="sd">        </span>
<span class="sd">        Provide the X and Y grids for each model as well as the intensity maps.</span>
<span class="sd">        </span>
<span class="sd">    .. warning::</span>
<span class="sd">        </span>
<span class="sd">        pixWidth and pixHeight parameters are quite important as they will be used to define the pixel scale of the new regular grid. Additonally, all data points of every model falling inside a given pixel will be added to this pixel contribution.</span>
<span class="sd">        </span>
<span class="sd">        In principle, one should give the pixel scale of the original array (before sky projection was applied).</span>

<span class="sd">    :param list[2D ndarray] listX: list of X arrays for each model</span>
<span class="sd">    :param list[2D ndarray] listY: list of Y arrays for each model</span>
<span class="sd">    :param list[2D ndarray] listModels: list of intensity maps for each model</span>
<span class="sd">    :param float pixWidth: width (x-axis size) of a single pixel. With numpy meshgrid, it is possible to generate grids with Nx pixels between xmin and xmax values, so that each pixel would have a width of (xmax-xmin)/Nx.</span>
<span class="sd">    :param float pixHeight: height (y-axis size) of a single pixel. With numpy meshgrid, it is possible to generate grids with Ny pixels between ymin and ymax values, so that each pixel would have a height of (ymax-ymin)/Ny.</span>

<span class="sd">    :param 2-tuple[float] xlim: (**Optional**) lower and upper bounds (in that order) for the x-axis. If None, a symmetric grid in X is done, using the maximum absolute X value found.</span>
<span class="sd">    :param 2-tuple[float] ylim: (**Optional**) lower and upper bounds (in that order) for the y-axis. If None, a symmetric grid in Y is done, using the maximum absolute Y value found.</span>
<span class="sd">    </span>
<span class="sd">    :results: a new X grid, a new Y grid and a new model intensity map with the contribution of every model summed up</span>
<span class="sd">    :rtype: 2D ndarray, 2D ndarray, 2D ndarray</span>
<span class="sd">    </span>
<span class="sd">    :raises TypeError: if xlim or ylim are neither None, nor a tuple, nor a list</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1"># Generate the new X and Y grid</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">maxX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">listX</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">listX</span><span class="p">)])</span>
        <span class="n">minX</span> <span class="o">=</span> <span class="o">-</span><span class="n">maxX</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
        <span class="n">minX</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="n">maxX</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unvalid type (</span><span class="si">%s</span><span class="s1">) for xlim. If you provide values for xlim, please give it as a list or a tuple only. Cheers !&#39;</span> <span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">xlim</span><span class="p">))</span>
        
    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">maxY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">listY</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">listY</span><span class="p">)])</span>
        <span class="n">minY</span> <span class="o">=</span> <span class="o">-</span><span class="n">maxY</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
        <span class="n">minY</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
        <span class="n">maxY</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unvalid type (</span><span class="si">%s</span><span class="s1">) for ylim. If you provide values for ylim, please give it as a list or a tuple only. Cheers !&#39;</span> <span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">ylim</span><span class="p">))</span>

    <span class="n">nx</span>   <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">((</span><span class="n">maxX</span><span class="o">-</span><span class="n">minX</span><span class="p">)</span><span class="o">/</span><span class="n">pixWidth</span><span class="p">)</span>
    <span class="n">ny</span>   <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">((</span><span class="n">maxY</span><span class="o">-</span><span class="n">minY</span><span class="p">)</span><span class="o">/</span><span class="n">pixHeight</span><span class="p">)</span>
    <span class="n">x</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minX</span><span class="p">,</span> <span class="n">maxX</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
    <span class="n">y</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minY</span><span class="p">,</span> <span class="n">maxY</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    
    <span class="c1"># We have roundoff errors in our X and Y grids, so we need to round off to the precision of pixWidth or pixHeight</span>
    <span class="n">rnd</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="o">-</span><span class="nb">int</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">%e</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">pixWidth</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="o">-</span><span class="nb">int</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">%e</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">pixHeight</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])])</span>
    <span class="n">X</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">rnd</span><span class="p">)</span>
    <span class="n">Y</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">rnd</span><span class="p">)</span>
    
    <span class="c1"># Combine data (3 loops, not very efficient...)</span>
    <span class="n">Z</span>    <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">*</span><span class="mf">0.0</span>
    <span class="n">shp</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    
    <span class="n">rg0</span>  <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">shp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">rg1</span>  <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">shp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="k">for</span> <span class="n">Xmodel</span><span class="p">,</span> <span class="n">Ymodel</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">listX</span><span class="p">,</span> <span class="n">listY</span><span class="p">,</span> <span class="n">listModels</span><span class="p">):</span>
        <span class="n">Xmodel</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Xmodel</span><span class="p">,</span> <span class="n">rnd</span><span class="p">)</span>
        <span class="n">Ymodel</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Ymodel</span><span class="p">,</span> <span class="n">rnd</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">xpos</span> <span class="ow">in</span> <span class="n">rg0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ypos</span> <span class="ow">in</span> <span class="n">rg1</span><span class="p">:</span>
                <span class="n">Xmask</span>          <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">Xmodel</span><span class="o">&gt;=</span><span class="n">X</span><span class="p">[</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">],</span> <span class="n">Xmodel</span><span class="o">&lt;</span><span class="n">X</span><span class="p">[</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">]</span> <span class="o">+</span> <span class="n">pixWidth</span><span class="p">)</span>
                <span class="n">Ymask</span>          <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">Ymodel</span><span class="o">&gt;=</span><span class="n">Y</span><span class="p">[</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">],</span> <span class="n">Ymodel</span><span class="o">&lt;</span><span class="n">Y</span><span class="p">[</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">]</span> <span class="o">+</span> <span class="n">pixHeight</span><span class="p">)</span>
                <span class="n">mask</span>           <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">Xmask</span><span class="p">,</span> <span class="n">Ymask</span><span class="p">)</span>
                <span class="n">Z</span><span class="p">[</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span></div>


<div class="viewcode-block" id="projectModel2D"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.projectModel2D">[docs]</a><span class="k">def</span> <span class="nf">projectModel2D</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inclination</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">PA</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">splineOrder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fillVal</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Project onto the sky a 2D model of a galaxy viewed face-on.</span>
<span class="sd">    </span>
<span class="sd">    .. deprecated::</span>
<span class="sd">        </span>
<span class="sd">        This function is deprecated and may be removed soon.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        Sky projection is used with scipy ndimage functions. Two projections are applied (in this order):</span>
<span class="sd">            - inclination: the 2D model is rotated along the vertical axis passing through the centre of the image</span>
<span class="sd">            - PA rotation: the (inclined) model is rotated clock-wise in the sky plane</span>
<span class="sd">        </span>
<span class="sd">        If you do not desire to apply one of the following coordinate transform, either do not provide it, or let it be 0.</span>
<span class="sd">        By default, no transform whatsoever is applied.</span>
<span class="sd">    </span>
<span class="sd">    :param model: intensity map of the model</span>
<span class="sd">    :type model: 2D ndarray</span>

<span class="sd">    :param inclination: (**Optional**) inclination of the galaxy on the sky in **degrees**</span>
<span class="sd">    :type inclination: int or float</span>
<span class="sd">    :param fillVal: (**Optional**) value used to filled pixels with missing data</span>
<span class="sd">    :type fillVal: int or float</span>
<span class="sd">    :param PA: (**Optional**) position angle of the galaxy on the sky in degrees. Generally, this number is given between -90° and +90°</span>
<span class="sd">    :type PA: int or float</span>
<span class="sd">    :param int splineOrder: (**Optional**) order of the spline used to interpolate values at new sky coordinate</span>
<span class="sd">    </span>
<span class="sd">    :returns: a new image (intensity map) projected onto the sky with interpolated values at new coordinate location</span>
<span class="sd">    :rtype: 2D ndarray</span>
<span class="sd">    </span>
<span class="sd">    :raises ValueError: if PA not in [-90°, +90°] range or if model image is not 2-dimensional</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1"># Checking PA</span>
    <span class="k">if</span> <span class="n">PA</span><span class="o">&lt;-</span><span class="mi">90</span> <span class="ow">or</span> <span class="n">PA</span><span class="o">&gt;</span><span class="mi">90</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;PA should be given in the range -90° &lt;= PA &lt;= 90°, counting angles anti clock-wise. Cheers !&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Model should be 2-dimensional only. Current number of dimensions is </span><span class="si">%d</span><span class="s1">. Cheers !&#39;</span> <span class="o">%</span><span class="n">model</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
    
    <span class="n">newModel</span>     <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># We do not use the notation X *= something for the arrays because of cast issues when having X and Y gris with numpy int values instead of numpy floats</span>
    <span class="k">if</span> <span class="n">inclination</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">newModel</span> <span class="o">=</span> <span class="n">tiltGalaxy</span><span class="p">(</span><span class="n">newModel</span><span class="p">,</span> <span class="n">inclination</span><span class="o">=</span><span class="n">inclination</span><span class="p">,</span> <span class="n">splineOrder</span><span class="o">=</span><span class="n">splineOrder</span><span class="p">,</span> <span class="n">fillVal</span><span class="o">=</span><span class="n">fillVal</span><span class="p">)</span>
    
    <span class="c1"># PA rotation (positive PA means rotating anti clock-wise)</span>
    <span class="k">if</span> <span class="n">PA</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">newModel</span> <span class="o">=</span> <span class="n">rotateGalaxy</span><span class="p">(</span><span class="n">newModel</span><span class="p">,</span> <span class="n">PA</span><span class="o">=</span><span class="n">PA</span><span class="p">,</span> <span class="n">splineOrder</span><span class="o">=</span><span class="n">splineOrder</span><span class="p">,</span> <span class="n">fillVal</span><span class="o">=</span><span class="n">fillVal</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">newModel</span></div>


<div class="viewcode-block" id="tiltGalaxy"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.tiltGalaxy">[docs]</a><span class="k">def</span> <span class="nf">tiltGalaxy</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inclination</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">splineOrder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fillVal</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Tilt a galaxy image around the South-North axis (assumed vertical) passing through the image centre.</span>
<span class="sd">    </span>
<span class="sd">    .. deprecated::</span>
<span class="sd">        </span>
<span class="sd">        This function is deprecated and may be removed soon.</span>

<span class="sd">    :param model: intensity map of the galaxy model</span>
<span class="sd">    :type model: 2D ndarray</span>

<span class="sd">    :param fillVal: (**Optional**) value to fill pixels which may become empty</span>
<span class="sd">    :type fillVal: int or float</span>
<span class="sd">    :param bool fitIn: (**Optional**) whether to resize the image to fit it in or not. If False, a new image is generated with the same dimensions.</span>
<span class="sd">    :param inclination: (**Optional**) rotation angle to apply (counted clock-wise in degrees). Is 0, no rotation is applied.</span>
<span class="sd">    :param int splineOrder: (**Optional**) order of the spline used to compute the intensity value at new pixel location</span>
<span class="sd">    </span>
<span class="sd">    :returns: a new image of a galaxy tilted by some angle around the vertical axis passing through the image centre</span>
<span class="sd">    :rtype: 2D ndarray</span>
<span class="sd">    </span>
<span class="sd">    :raises ValueError: if model image is not 2-dimensional</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Model should be 2-dimensional only. Current number of dimensions is </span><span class="si">%d</span><span class="s1">. Cheers !&#39;</span> <span class="o">%</span><span class="n">model</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
    
    <span class="c1"># Apply coordinate transform on grid</span>
    <span class="n">inclination</span>   <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span>           <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">midX</span>           <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0</span>
    
    <span class="k">if</span> <span class="n">inclination</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">&gt;</span><span class="n">midX</span><span class="p">]</span>  <span class="o">=</span> <span class="n">midX</span> <span class="o">+</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">&gt;</span><span class="n">midX</span><span class="p">]</span><span class="o">-</span><span class="n">midX</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">inclination</span><span class="p">)</span>
        <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">&lt;=</span><span class="n">midX</span><span class="p">]</span> <span class="o">=</span> <span class="n">midX</span> <span class="o">-</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">&lt;=</span><span class="n">midX</span><span class="p">]</span><span class="o">-</span><span class="n">midX</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">inclination</span><span class="p">)</span>
    
    <span class="c1"># Apply coordinate transform on image then using the grid</span>
    <span class="k">return</span> <span class="n">nd</span><span class="o">.</span><span class="n">map_coordinates</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="n">splineOrder</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">fillVal</span><span class="p">)</span></div>


<div class="viewcode-block" id="rotateGalaxy"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.rotateGalaxy">[docs]</a><span class="k">def</span> <span class="nf">rotateGalaxy</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">PA</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">splineOrder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fitIn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fillVal</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Apply PA rotation to a galaxy image.</span>
<span class="sd">    </span>
<span class="sd">    .. deprecated::</span>
<span class="sd">        </span>
<span class="sd">        This function is deprecated and may be removed soon.</span>

<span class="sd">    :param model: intensity map of the galaxy model</span>
<span class="sd">    :type model: 2D ndarray</span>

<span class="sd">    :param fillVal: (**Optional**) value to fill pixels which may become empty</span>
<span class="sd">    :type fillVal: int or float</span>
<span class="sd">    :param bool fitIn: (**Optional**) whether to resize the image to fit it in or not. If False a new image is generated with the same dimensions.</span>
<span class="sd">    :param PA: (**Optional**) rotation angle to apply (counted clock-wise in degrees). Default is 0 so that no rotation is applied.</span>
<span class="sd">    :type PA: int or float</span>
<span class="sd">    :param int splineOrder: (**Optional**) order of the spline used to compute the intensity value at new pixel location</span>
<span class="sd">    </span>
<span class="sd">    :returns: a new image of a galaxy rotated by a certain angle</span>
<span class="sd">    :rtype: 2D ndarray</span>
<span class="sd">    </span>
<span class="sd">    :raises ValueError: if model image is not 2-dimensional</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Model should be 2-dimensional only. Current number of dimensions is </span><span class="si">%d</span><span class="s1">. Cheers !&#39;</span> <span class="o">%</span><span class="n">model</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
    
    <span class="c1"># We count angles anti clock-wise so we need to inverte the value for rotate which counts clock-wise</span>
    <span class="k">return</span> <span class="n">nd</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">-</span><span class="n">PA</span><span class="p">,</span> <span class="n">reshape</span><span class="o">=</span><span class="n">fitIn</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">splineOrder</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">fillVal</span><span class="p">)</span></div>
</pre></div>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Wilfried Mercier<br/>
        
            &copy; Copyright 2021, Wilfried Mercier.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>