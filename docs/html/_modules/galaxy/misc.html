
<!DOCTYPE html>

<html lang="en">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<title>galaxy.misc | wilfried library 1.0 documentation</title>
<link href="../../_static/pygments.css" rel="stylesheet"/>
<link href="../../_static/theme.313ea551d1799b2102b1.css" rel="stylesheet"/>
<link href="../../_static/plot_directive.css" rel="stylesheet"/>
<link href="../../_static/copybutton.css" rel="stylesheet"/>
<link href="../../search.html" rel="search" title="Search"/>
<link href="../../genindex.html" rel="index" title="Index"/>
</head>
<body class="antialiased text-gray">
<div class="h-screen xl:grid xl:grid-layout" data-action="keydown@window-&gt;search#focus" data-controller="sidebar search" id="page">
<a class="block text-xl bg-white py-4 z-20 absolute top-0 h-18 inset-x-0 text-center transform -translate-y-full focus:translate-y-0 focus:outline-none transition-transform duration-75" href="#galaxy-misc" title="Skip navigation links">Skip to content</a>
<header class="grid-area-header z-10 h-14 sm:h-18">
<div class="bg-gray-dark shadow-md flex items-center h-full xl:px-2 relative"><div class="flex items-center">
<button class="xl:hidden h-14 w-14 sm:h-18 sm:w-18 leading-14 sm:leading-18 text-gray-100 hover:bg-gray-700 hover:text-brand focus:outline-none focus:bg-gray-700 focus:text-brand" data-action="sidebar#open" data-sidebar-target="hamburger">
<span class="sr-only">Open navigation menu</span>
<svg aria-hidden="true" class="fill-current h-8 w-8" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg>
</button><a aria-label="Back to homepage" class="hover:bg-gray-700 focus:bg-gray-700 focus:outline-none tooltipped tooltipped-sw" href="../../index.html"><span class="hidden lg:inline-block shrink-0 font-medium text-gray-100 mx-5 leading-14 sm:leading-18 tracking-wider">wilfried library 1.0 documentation</span>
</a></div><div class="flex justify-end items-center flex-1"><form action="../../search.html" class="flex print:hidden justify-between items-center leading-14 sm:leading-18 md:ml-4 bg-gray-dark text-gray-300 focus-within:bg-gray-50 focus-within:text-gray-800 focus-within:absolute focus-within:inset-x-0 focus-within:top-0 md:focus-within:w-full md:focus-within:static" data-action="click-&gt;search#focusSearchInput" id="searchbox" method="get">
<button aria-label="Get search results" class="text-inherit h-14 w-14 sm:h-18 sm:w-18" tabindex="-1">
<svg aria-hidden="true" class="fill-current stroke-current h-8 w-8" stroke-width="0.5" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
</button>
<input aria-label="Search the docs" class="pr-2 bg-transparent text-inherit focus:outline-none w-0 md:w-auto focus:w-full transition-all duration-100" data-search-target="searchInput" id="search-input" name="q" placeholder="Search the docs" type="search"/>
</form></div>
</div>
</header>
<aside class="grid-area-sidebar h-full fixed xl:relative inset-y-0 left-0 z-20 xl:z-0 print:hidden overflow-y-auto transition-all transform transform-gpu -translate-x-full opacity-0 duration-300 xl:translate-x-0 xl:opacity-100" data-sidebar-target="sidebar">
<nav class="h-full overflow-y-auto bg-white text-gray-600 pt-8 flex flex-col" role="navigation">
<div class="nav-toc flex-1 pl-6"><ul>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../dependencies.html">Required dependencies</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../makeLifeSimpler.html">makeLifeSimpler</a></div></li>
<li class="toctree-l1"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/index.html">Useful utilities</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/coloredMessages.html">Colored messages</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/coloredMessages.html#list-of-available-functions">List of available functions</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/coloredMessages.html#example">Example</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/coloredMessages.html#module-utilities.coloredMessages">Documentation</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/dict.html">Dictionaries</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/dict.html#list-of-available-functions">List of available functions</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/dict.html#examples">Examples</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/dict.html#module-utilities.dictionaries">Documentation</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/io.html">Input/Output</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/io.html#list-of-available-functions">List of available functions</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/io.html#examples">Examples</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/io.html#module-utilities.io">Documentation</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/list.html">List manipulations</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/list.html#list-of-available-functions">List of available functions</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/list.html#examples">Examples</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/list.html#module-utilities.lists">Documentation</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/strings.html">Strings manipulation</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/strings.html#list-of-available-functions">List of available functions</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/strings.html#examples">Examples</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/strings.html#module-utilities.strings">Documentation</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/plotUtilities/index.html">Plot utilities</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/plotUtilities/asManyHists.html">Histograms</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/plotUtilities/hst.html">Galfit related plots</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/plotUtilities/misc.html">Miscellaneous</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../utilities/plotUtilities/singleContour.html">Contours</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/index.html">Galaxy module</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/angularMomentum.html">Galaxies angular momentum</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/cosmology.html">Cosmology computations</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/geometry.html">Galaxies angular momentum</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/kinematics.html">Galaxy kinematics</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/misc.html">Miscellaneous</a></div></li>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/massModels.html">Galaxy mass models</a></div></li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/models.html">Galaxy models</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/models.html#d-profiles">1D profiles</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/models.html#id1">2D profiles</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/morphology/index.html">Galaxies morphology</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/morphology/index.html#functions-are-split-into-the-following-modules">Functions are split into the following modules:</a></div></li>
</ul>
</li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/photometry/index.html">Galaxies photometry</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galaxy/photometry/index.html#functions-are-split-into-the-following-modules">Functions are split into the following modules:</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galfit/index.html">Galfit module</a></div><ul>
<li class="toctree-l2"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galfit/galfit.html">Galfit auto-routines</a></div></li>
<li class="toctree-l2"><div class="nav-link"><svg class="expand" data-action="click-&gt;sidebar#expand keydown-&gt;sidebar#expandKeyPressed" tabindex="0" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galfit/models.html">Galfit models</a></div><ul>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galfit/models.html#miscellaneous">Miscellaneous</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galfit/models.html#galfit-profiles">Galfit profiles</a></div></li>
<li class="toctree-l3"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="../../galfit/models.html#galfit-additional-tags">Galfit additional tags</a></div></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<button class="text-4xl text-gray-800 p-4 bottom-0 hover:text-brand xl:hidden focus:text-brand self-center" data-action="" title="Close navigation menu">
<span class="sr-only">Close navigation menu</span>
<svg aria-hidden="true" class="fill-current stroke-current h-6 w-6" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</aside>
<main class="px-10 xl:ml-fluid grid-area-main overflow-y-auto flex flex-col h-full mx-0 md:mx-auto xl:mr-0" data-action="scroll-&gt;scroll#showButton" data-controller="scroll"><nav aria-label="breadcrumbs" class="print:hidden mt-12 text-sm text-gray-light" role="navigation">
<a class="text-gray-light text-sm hover:text-gray-dark font-medium focus:text-gray-dark" href="../../index.html">wilfried library 1.0 documentation</a>
<span class="mr-1">/</span><a class="text-gray-light text-sm hover:text-gray-dark" href="../index.html">Module code</a>
<span class="mr-1">/</span><span aria-current="page">galaxy.misc</span>
</nav>
<article class="flex-1" role="main">
<h1>Source code for galaxy.misc</h1><div class="highlight"><pre>
<code><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">"""</span>
<span class="sd">.. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>

<span class="sd">Miscellaneous functions related to galaxy computations.</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">scipy.ndimage</span>                      <span class="k">as</span>     <span class="nn">nd</span>
<span class="kn">import</span> <span class="nn">astropy.units</span>                      <span class="k">as</span>     <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">numpy</span>                              <span class="k">as</span>     <span class="nn">np</span>
<span class="kn">from</span>   <span class="nn">numpy.fft</span>                          <span class="kn">import</span> <span class="n">fft2</span><span class="p">,</span> <span class="n">ifft2</span>
<span class="kn">from</span>   <span class="nn">scipy.special</span>                      <span class="kn">import</span> <span class="n">gammaincinv</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gammainc</span>

<span class="c1">#####################################################################</span>
<span class="c1">#                 Sersic profiles related functions                 #</span>
<span class="c1">#####################################################################</span>

<div class="viewcode-block" id="checkAndComputeIe"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.checkAndComputeIe">[docs]</a><span class="k">def</span> <span class="nf">checkAndComputeIe</span><span class="p">(</span><span class="n">Ie</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">bn</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">noError</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Check whether Ie is provided. If not, but the magnitude and magnitude offset are, it computes it.</span>

<span class="sd">    :param bn: bn factor appearing in the Sersic profile (see :py:func:`compute_bn`)</span>
<span class="sd">    :type bn: float or ndarray[float]</span>
<span class="sd">    :param float Ie: intensity at effective radius</span>
<span class="sd">    :type Ie: float or ndarray[float]</span>
<span class="sd">    :param mag: total integrated magnitude</span>
<span class="sd">    :type mag: float or ndarray[float]</span>
<span class="sd">    :param n: Sersic index</span>
<span class="sd">    :type n: int or float or list[int] or list[float] or ndarray[int] or ndarray[float]</span>
<span class="sd">    :param offset: magnitude offset</span>
<span class="sd">    :type offset: float or ndarray[float]</span>
<span class="sd">    :param re: half-light/effective radius</span>
<span class="sd">    :type re: float or ndarray[float]</span>

<span class="sd">    :param bool noError: (**Optional**) whether to not raise an error or not when data is missing to compute the intensity. If True, None is returned.</span>

<span class="sd">    :returns: Ie if it could be computed or already existed, or None if **noError** flag is set to True.</span>
<span class="sd">    :rtype: float or ndarray[float] or None</span>

<span class="sd">    :raises ValueError: if neither Ie, nor mag and offset are provided</span>
<span class="sd">    """</span>
    
    <span class="k">if</span> <span class="n">Ie</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">intensity_at_re</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">bn</span><span class="o">=</span><span class="n">bn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">noError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Ie value is None, but mag and/or offset is/are also None. If no Ie is given, please provide a value for the total magnitude and magnitude offset in order to compute the former one. Cheers !"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ie</span></div>
    
<div class="viewcode-block" id="intensity_at_re"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.intensity_at_re">[docs]</a><span class="k">def</span> <span class="nf">intensity_at_re</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">bn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Compute the intensity of a given Sersic profile with index n at the position of the half-light radius re. This assumes to know the integrated magnitude of the profile, as well as the offset used for the magnitude definition.</span>
<span class="sd">    </span>
<span class="sd">    :param mag: total integrated magnitude of the profile</span>
<span class="sd">    :type mag: float or ndarray[float]</span>
<span class="sd">    :param n: Sersic index of the given profile</span>
<span class="sd">    :type n: int or float or list[int] or list[float] or ndarray[int] or ndarray[float]</span>
<span class="sd">    :param offset: magnitude offset used in the defition of the magnitude system</span>
<span class="sd">    :type offset: float or ndarray[float]</span>
<span class="sd">    :param re: effective (half-light) radius</span>
<span class="sd">    :type re: float or ndarray[float]</span>

<span class="sd">    :param bn: (**Optional**) bn factor appearing in the Sersic profile defined as $2\gamma(2n, bn) = \Gamma(2n)$. If None, its value will be computed from n.</span>
<span class="sd">    :type bn: float or ndarray[float]</span>
<span class="sd">    :returns: the intensity at re</span>
<span class="sd">    :rtype: float or ndarray[float]</span>
<span class="sd">    """</span>
 
    <span class="k">if</span> <span class="n">bn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bn</span> <span class="o">=</span> <span class="n">compute_bn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">offset</span> <span class="o">-</span> <span class="n">mag</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">bn</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">gamma</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">re</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">bn</span><span class="p">))</span></div>


<div class="viewcode-block" id="check_bns"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.check_bns">[docs]</a><span class="k">def</span> <span class="nf">check_bns</span><span class="p">(</span><span class="n">listn</span><span class="p">,</span> <span class="n">listbn</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Given a list of bn values, check those which are not given (i.e. equal to None), and compute their value using the related Sersic index.</span>

<span class="sd">    :param list[float] listbn: list of bn values</span>
<span class="sd">    :param listn: list of Sersic indices</span>
<span class="sd">    :type listn: list[int] or list[float]</span>
<span class="sd">    :returns: list of bn values</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    """</span>
    
    <span class="k">return</span> <span class="p">[</span><span class="n">compute_bn</span><span class="p">(</span><span class="n">listn</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="k">if</span> <span class="n">listbn</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">listbn</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listn</span><span class="p">))]</span></div>


<div class="viewcode-block" id="compute_bn"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.compute_bn">[docs]</a><span class="k">def</span> <span class="nf">compute_bn</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">"""</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Compute the value of bn used in the definition of a Sersic profile</span>
<span class="sd">    </span>
<span class="sd">    .. math::</span>
<span class="sd">            </span>
<span class="sd">        2\gamma(2n, b_n) = \Gamma(2n)</span>

<span class="sd">    :param n: Sersic index of the profile</span>
<span class="sd">    :type n: int or float or list[int] or list[float] or ndarray[int] or ndarray[float]</span>
<span class="sd">    :returns: bn</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    """</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">n</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">gammaincinv</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></div>


<span class="c1">#####################################################</span>
<span class="c1">#                       Other                       #</span>
<span class="c1">#####################################################</span>

<div class="viewcode-block" id="realGammainc"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.realGammainc">[docs]</a><span class="k">def</span> <span class="nf">realGammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">''''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Unnormalised lower incomplete gamma function</span>
<span class="sd">    </span>
<span class="sd">    .. math::</span>
<span class="sd">        </span>
<span class="sd">        \gamma(a, x) = \int_0^x dt~t^{a-1} e^{-t}</span>
<span class="sd">    </span>
<span class="sd">    :param a: power of the gamma function</span>
<span class="sd">    :type a: int or float</span>
<span class="sd">    :param x: upper bound of the integral</span>
<span class="sd">    :type x: int or float</span>
<span class="sd">    :returns: the incomplete gamma function</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    '''</span>
    
    <span class="k">return</span> <span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">gammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="PSFconvolution2D"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.PSFconvolution2D">[docs]</a><span class="k">def</span> <span class="nf">PSFconvolution2D</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">arcsecToGrid</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s1">'name'</span><span class="p">:</span><span class="s1">'Gaussian2D'</span><span class="p">,</span> <span class="s1">'FWHMX'</span><span class="p">:</span><span class="mf">0.8</span><span class="p">,</span> <span class="s1">'FWHMY'</span><span class="p">:</span><span class="mf">0.8</span><span class="p">,</span> <span class="s1">'sigmaX'</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">'sigmaY'</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">:</span><span class="s1">'arcsec'</span><span class="p">},</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Convolve using fast FFT a 2D array with a pre-defined (2D) PSF.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>

<span class="sd">        **How to use**</span>
<span class="sd">        </span>
<span class="sd">        Best practice is to provide the PSF model FWHM or sigma in arcsec, and the image pixel element resolution (arcsecToPixel), so that the fonction can convert correctly the PSF width in pixels.</span>
<span class="sd">        You can provide either the FWHM or sigma. If both are given, sigma is used.</span>

<span class="sd">    :param data: data to be convolved with the PSF</span>
<span class="sd">    :type data: 2D ndarray</span>
<span class="sd">        </span>
<span class="sd">    :param float arcsecToGrid: (**Optional**) conversion factor from arcsec to the grid pixel size, that is the width and height of a single pixel in the X and Y grids. Default is the pixel size of HST-ACS images (0.03"/px).</span>
<span class="sd">    :param dict model: (**Optional**) dictionnary of the PSF (and its parameters) to use for the convolution. Default is a (0, 0) centred radial gaussian (muX=muY=0 and sigmaX=sigmaY) with a FWHM corresponding to that of MUSE (~0.8"~4 MUSE pixels). For now, only 2D Gaussians are accepted as PSF.</span>
<span class="sd">    :param bool verbose: (**Optional**) whether to print text on stdout or not</span>

<span class="sd">    :returns: a new convolved image</span>
<span class="sd">    :rtype: 2D ndarray[float]</span>
<span class="sd">    </span>
<span class="sd">    :raises ValueError: </span>
<span class="sd">        </span>
<span class="sd">        * if unit key in **model** dict is not a valid astropy unit </span>
<span class="sd">        * if the PSF is not a 2D Gaussian model</span>
<span class="sd">    '''</span>
    
    <span class="k">def</span> <span class="nf">setListFromDict</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Fill a list with values from a dictionary or from default ones if the given key is not in the dictionary.</span>
<span class="sd">        </span>
<span class="sd">        Mandatory inputs</span>
<span class="sd">        ----------------</span>
<span class="sd">            dictionary : dict</span>
<span class="sd">                dictionary to get the keys values from</span>
<span class="sd">        </span>
<span class="sd">        Optional inputs</span>
<span class="sd">        ---------------</span>
<span class="sd">            default : list</span>
<span class="sd">                list of default values if given key is not in dictionary</span>
<span class="sd">            keys : list of str</span>
<span class="sd">                list of key names whose values will be appended into the list</span>
<span class="sd">                </span>
<span class="sd">        Return a list with values retrived from a dictionary keys or from a list of default values.</span>
<span class="sd">        """</span>
        
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Convoluting using PSF model </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span><span class="n">model</span><span class="p">)</span>
    
    <span class="c1"># Retrieve PSF parameters and set default values if not provided</span>
    <span class="k">if</span> <span class="n">model</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'gaussian2d'</span><span class="p">:</span>
        <span class="n">sigmaX</span><span class="p">,</span> <span class="n">sigmaY</span><span class="p">,</span> <span class="n">FWHMX</span><span class="p">,</span> <span class="n">FWHMY</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">setListFromDict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">'sigmaX'</span><span class="p">,</span> <span class="s1">'sigmaY'</span><span class="p">,</span> <span class="s1">'FWHMX'</span><span class="p">,</span> <span class="s1">'FWHMY'</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s2">"arcsec"</span><span class="p">])</span>
        
        <span class="c1"># Compute sigma from FWHM if sigma is not provided</span>
        <span class="k">if</span> <span class="n">sigmaX</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sigmaX</span> <span class="o">=</span> <span class="n">FWHMX</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">sigmaY</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sigmaY</span> <span class="o">=</span> <span class="n">FWHMY</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
            
        <span class="c1"># Convert sigma to arcsec and then go in grid pixel values</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sigmaX</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">sigmaX</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'arcsec'</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">arcsecToGrid</span>
            <span class="n">sigmaY</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">sigmaY</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'arcsec'</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">arcsecToGrid</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Given unit </span><span class="si">%s</span><span class="s1"> is not valid. Angles may generally be given in units of deg, arcmin, arcsec, hourangle, or rad.'</span><span class="p">)</span>
        
        <span class="c1"># Perform convolution</span>
        <span class="n">image</span>     <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">image</span>     <span class="o">=</span> <span class="n">fft2</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">image</span>     <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">fourier_gaussian</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="p">[</span><span class="n">sigmaX</span><span class="p">,</span> <span class="n">sigmaY</span><span class="p">])</span>
        <span class="n">image</span>     <span class="o">=</span> <span class="n">ifft2</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Given model </span><span class="si">%s</span><span class="s1"> is not recognised or implemented yet. Only gaussian2d model is accepted.'</span> <span class="o">%</span><span class="n">model</span><span class="p">[</span><span class="s1">'name'</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="n">image</span></div>
    
<div class="viewcode-block" id="fromStructuredArrayOrNot"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.fromStructuredArrayOrNot">[docs]</a><span class="k">def</span> <span class="nf">fromStructuredArrayOrNot</span><span class="p">(</span><span class="n">gal</span><span class="p">,</span> <span class="n">magD</span><span class="p">,</span> <span class="n">magB</span><span class="p">,</span> <span class="n">Rd</span><span class="p">,</span> <span class="n">Rb</span><span class="p">,</span> <span class="n">noStructuredArray</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Store values of the disk magnitude, the bulge magnitude, the disk effective radius and the bulge effective radius either directly from the given values or from a numpy structured array.</span>

<span class="sd">    :param gal: structured array with data for all the galaxies. The required column names are 'R_d_GF' (re for the disk component), 'R_b_GF' (re for the bulge component), 'Mag_d_GF' (the total integrated magnitude for the disk component), 'Mag_b_GF' (the total integrated magnitude for the bulge component).</span>
<span class="sd">    :type gal: structured ndarray</span>
<span class="sd">    :param magB: total magnitude of the bulge component of the galaxies</span>
<span class="sd">    :type magB: float or list(float)</span>
<span class="sd">    :param magD: total magnitude of the disk component of the galaxies</span>
<span class="sd">    :type magD: float or list(float)</span>
<span class="sd">    :param Rb: half-light radius of the bulge components of the galaxies</span>
<span class="sd">    :type Rb: float or list(float)</span>
<span class="sd">    :param Rd: half-light radius of the disk components of the galaxies</span>
<span class="sd">    :type Rd: float or list(float)</span>
<span class="sd">    :param bool noStructuredArray: if False, the structured array gal will be used. If False, values of the magnitudes and half-light radii of the two components must be given.</span>

<span class="sd">    :returns: the disk magnitude, the bulge magnitude, the disk effective radius and the bulge effective radius</span>
<span class="sd">    :rtype: float, float, float, float</span>
<span class="sd">    """</span>
    <span class="c1">#if no structured array is given, check that each necessary variable is given instead</span>
    <span class="k">if</span> <span class="n">noStructuredArray</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">magD</span><span class="p">,</span> <span class="n">magB</span><span class="p">,</span> <span class="n">Rd</span><span class="p">,</span> <span class="n">Rb</span><span class="p">]]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"ValueError: a None found. One of the inputs in the list magD, magB, Rd, Rb was not provided. If you are not using the structured array feature, you must provide magnitude and effective values for all galaxies and for both profiles (exponential disk and bulge)"</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">magD</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">magD</span><span class="p">)</span>
            <span class="n">magB</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">magB</span><span class="p">)</span>
            <span class="n">Rd</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Rd</span><span class="p">)</span>
            <span class="n">Rb</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Rb</span><span class="p">)</span>
    <span class="c1">#if a structured array is given, retrieve the correct columns</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">magD</span>         <span class="o">=</span> <span class="n">gal</span><span class="p">[</span><span class="s1">'Mag_d_GF'</span><span class="p">]</span>
        <span class="n">magB</span>         <span class="o">=</span> <span class="n">gal</span><span class="p">[</span><span class="s1">'Mag_b_GF'</span><span class="p">]</span>
        <span class="n">Rd</span>           <span class="o">=</span> <span class="n">gal</span><span class="p">[</span><span class="s1">'R_d_GF'</span><span class="p">]</span>
        <span class="n">Rb</span>           <span class="o">=</span> <span class="n">gal</span><span class="p">[</span><span class="s1">'R_b_GF'</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">magD</span><span class="p">,</span> <span class="n">magB</span><span class="p">,</span> <span class="n">Rd</span><span class="p">,</span> <span class="n">Rb</span></div>


<span class="c1">####################################################################################################</span>
<span class="c1">#                                            Trash                                                 #</span>
<span class="c1">####################################################################################################</span>

<div class="viewcode-block" id="mergeModelsIntoOne"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.mergeModelsIntoOne">[docs]</a><span class="k">def</span> <span class="nf">mergeModelsIntoOne</span><span class="p">(</span><span class="n">listX</span><span class="p">,</span> <span class="n">listY</span><span class="p">,</span> <span class="n">listModels</span><span class="p">,</span> <span class="n">pixWidth</span><span class="p">,</span> <span class="n">pixHeight</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Sum the contribution of different models with distorted X and Y grids into a single image with a regular grid.</span>
<span class="sd">    </span>
<span class="sd">    .. deprecated:: 1.0</span>
<span class="sd">        </span>
<span class="sd">        This function is deprecated and may be removed soon.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">    </span>
<span class="sd">        **How to use**</span>
<span class="sd">        </span>
<span class="sd">        Provide the X and Y grids for each model as well as the intensity maps.</span>
<span class="sd">        </span>
<span class="sd">    .. warning::</span>
<span class="sd">        </span>
<span class="sd">        pixWidth and pixHeight parameters are quite important as they will be used to define the pixel scale of the new regular grid. Additonally, all data points of every model falling inside a given pixel will be added to this pixel contribution.</span>
<span class="sd">        </span>
<span class="sd">        In principle, one should give the pixel scale of the original array (before sky projection was applied).</span>

<span class="sd">    :param list[2D ndarray] listX: list of X arrays for each model</span>
<span class="sd">    :param list[2D ndarray] listY: list of Y arrays for each model</span>
<span class="sd">    :param list[2D ndarray] listModels: list of intensity maps for each model</span>
<span class="sd">    :param float pixWidth: width (x-axis size) of a single pixel. With numpy meshgrid, it is possible to generate grids with Nx pixels between xmin and xmax values, so that each pixel would have a width of (xmax-xmin)/Nx.</span>
<span class="sd">    :param float pixHeight: height (y-axis size) of a single pixel. With numpy meshgrid, it is possible to generate grids with Ny pixels between ymin and ymax values, so that each pixel would have a height of (ymax-ymin)/Ny.</span>

<span class="sd">    :param 2-tuple[float] xlim: (**Optional**) lower and upper bounds (in that order) for the x-axis. If None, a symmetric grid in X is done, using the maximum absolute X value found.</span>
<span class="sd">    :param 2-tuple[float] ylim: (**Optional**) lower and upper bounds (in that order) for the y-axis. If None, a symmetric grid in Y is done, using the maximum absolute Y value found.</span>
<span class="sd">    </span>
<span class="sd">    :results: a new X grid, a new Y grid and a new model intensity map with the contribution of every model summed up</span>
<span class="sd">    :rtype: 2D ndarray, 2D ndarray, 2D ndarray</span>
<span class="sd">    </span>
<span class="sd">    :raises TypeError: if xlim or ylim are neither None, nor a tuple, nor a list</span>
<span class="sd">    '''</span>
    
    <span class="c1"># Generate the new X and Y grid</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">maxX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">listX</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">listX</span><span class="p">)])</span>
        <span class="n">minX</span> <span class="o">=</span> <span class="o">-</span><span class="n">maxX</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
        <span class="n">minX</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="n">maxX</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'Unvalid type (</span><span class="si">%s</span><span class="s1">) for xlim. If you provide values for xlim, please give it as a list or a tuple only. Cheers !'</span> <span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">xlim</span><span class="p">))</span>
        
    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">maxY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">listY</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">listY</span><span class="p">)])</span>
        <span class="n">minY</span> <span class="o">=</span> <span class="o">-</span><span class="n">maxY</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
        <span class="n">minY</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
        <span class="n">maxY</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'Unvalid type (</span><span class="si">%s</span><span class="s1">) for ylim. If you provide values for ylim, please give it as a list or a tuple only. Cheers !'</span> <span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">ylim</span><span class="p">))</span>

    <span class="n">nx</span>   <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">((</span><span class="n">maxX</span><span class="o">-</span><span class="n">minX</span><span class="p">)</span><span class="o">/</span><span class="n">pixWidth</span><span class="p">)</span>
    <span class="n">ny</span>   <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">((</span><span class="n">maxY</span><span class="o">-</span><span class="n">minY</span><span class="p">)</span><span class="o">/</span><span class="n">pixHeight</span><span class="p">)</span>
    <span class="n">x</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minX</span><span class="p">,</span> <span class="n">maxX</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
    <span class="n">y</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minY</span><span class="p">,</span> <span class="n">maxY</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    
    <span class="c1"># We have roundoff errors in our X and Y grids, so we need to round off to the precision of pixWidth or pixHeight</span>
    <span class="n">rnd</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="o">-</span><span class="nb">int</span><span class="p">((</span><span class="s2">"</span><span class="si">%e</span><span class="s2">"</span> <span class="o">%</span><span class="n">pixWidth</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'e'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="o">-</span><span class="nb">int</span><span class="p">((</span><span class="s2">"</span><span class="si">%e</span><span class="s2">"</span> <span class="o">%</span><span class="n">pixHeight</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'e'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])])</span>
    <span class="n">X</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">rnd</span><span class="p">)</span>
    <span class="n">Y</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">rnd</span><span class="p">)</span>
    
    <span class="c1"># Combine data (3 loops, not very efficient...)</span>
    <span class="n">Z</span>    <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">*</span><span class="mf">0.0</span>
    <span class="n">shp</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    
    <span class="n">rg0</span>  <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">shp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">rg1</span>  <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">shp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="k">for</span> <span class="n">Xmodel</span><span class="p">,</span> <span class="n">Ymodel</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">listX</span><span class="p">,</span> <span class="n">listY</span><span class="p">,</span> <span class="n">listModels</span><span class="p">):</span>
        <span class="n">Xmodel</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Xmodel</span><span class="p">,</span> <span class="n">rnd</span><span class="p">)</span>
        <span class="n">Ymodel</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Ymodel</span><span class="p">,</span> <span class="n">rnd</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">xpos</span> <span class="ow">in</span> <span class="n">rg0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ypos</span> <span class="ow">in</span> <span class="n">rg1</span><span class="p">:</span>
                <span class="n">Xmask</span>          <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">Xmodel</span><span class="o">&gt;=</span><span class="n">X</span><span class="p">[</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">],</span> <span class="n">Xmodel</span><span class="o">&lt;</span><span class="n">X</span><span class="p">[</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">]</span> <span class="o">+</span> <span class="n">pixWidth</span><span class="p">)</span>
                <span class="n">Ymask</span>          <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">Ymodel</span><span class="o">&gt;=</span><span class="n">Y</span><span class="p">[</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">],</span> <span class="n">Ymodel</span><span class="o">&lt;</span><span class="n">Y</span><span class="p">[</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">]</span> <span class="o">+</span> <span class="n">pixHeight</span><span class="p">)</span>
                <span class="n">mask</span>           <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">Xmask</span><span class="p">,</span> <span class="n">Ymask</span><span class="p">)</span>
                <span class="n">Z</span><span class="p">[</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span></div>


<div class="viewcode-block" id="projectModel2D"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.projectModel2D">[docs]</a><span class="k">def</span> <span class="nf">projectModel2D</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inclination</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">PA</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">splineOrder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fillVal</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Project onto the sky a 2D model of a galaxy viewed face-on.</span>
<span class="sd">    </span>
<span class="sd">    .. deprecated:: 1.0</span>
<span class="sd">        </span>
<span class="sd">        This function is deprecated and may be removed soon.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        Sky projection is used with scipy ndimage functions. Two projections are applied (in this order):</span>
<span class="sd">            - inclination: the 2D model is rotated along the vertical axis passing through the centre of the image</span>
<span class="sd">            - PA rotation: the (inclined) model is rotated clock-wise in the sky plane</span>
<span class="sd">        </span>
<span class="sd">        If you do not desire to apply one of the following coordinate transform, either do not provide it, or let it be 0.</span>
<span class="sd">        By default, no transform whatsoever is applied.</span>
<span class="sd">    </span>
<span class="sd">    :param model: intensity map of the model</span>
<span class="sd">    :type model: 2D ndarray</span>

<span class="sd">    :param inclination: (**Optional**) inclination of the galaxy on the sky in **degrees**</span>
<span class="sd">    :type inclination: int or float</span>
<span class="sd">    :param fillVal: (**Optional**) value used to filled pixels with missing data</span>
<span class="sd">    :type fillVal: int or float</span>
<span class="sd">    :param PA: (**Optional**) position angle of the galaxy on the sky in degrees. Generally, this number is given between -90° and +90°</span>
<span class="sd">    :type PA: int or float</span>
<span class="sd">    :param int splineOrder: (**Optional**) order of the spline used to interpolate values at new sky coordinate</span>
<span class="sd">    </span>
<span class="sd">    :returns: a new image (intensity map) projected onto the sky with interpolated values at new coordinate location</span>
<span class="sd">    :rtype: 2D ndarray</span>
<span class="sd">    </span>
<span class="sd">    :raises ValueError: if PA not in [-90°, +90°] range or if model image is not 2-dimensional</span>
<span class="sd">    '''</span>
    
    <span class="c1"># Checking PA</span>
    <span class="k">if</span> <span class="n">PA</span><span class="o">&lt;-</span><span class="mi">90</span> <span class="ow">or</span> <span class="n">PA</span><span class="o">&gt;</span><span class="mi">90</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'PA should be given in the range -90° &lt;= PA &lt;= 90°, counting angles anti clock-wise. Cheers !'</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Model should be 2-dimensional only. Current number of dimensions is </span><span class="si">%d</span><span class="s1">. Cheers !'</span> <span class="o">%</span><span class="n">model</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
    
    <span class="n">newModel</span>     <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># We do not use the notation X *= something for the arrays because of cast issues when having X and Y gris with numpy int values instead of numpy floats</span>
    <span class="k">if</span> <span class="n">inclination</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">newModel</span> <span class="o">=</span> <span class="n">tiltGalaxy</span><span class="p">(</span><span class="n">newModel</span><span class="p">,</span> <span class="n">inclination</span><span class="o">=</span><span class="n">inclination</span><span class="p">,</span> <span class="n">splineOrder</span><span class="o">=</span><span class="n">splineOrder</span><span class="p">,</span> <span class="n">fillVal</span><span class="o">=</span><span class="n">fillVal</span><span class="p">)</span>
    
    <span class="c1"># PA rotation (positive PA means rotating anti clock-wise)</span>
    <span class="k">if</span> <span class="n">PA</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">newModel</span> <span class="o">=</span> <span class="n">rotateGalaxy</span><span class="p">(</span><span class="n">newModel</span><span class="p">,</span> <span class="n">PA</span><span class="o">=</span><span class="n">PA</span><span class="p">,</span> <span class="n">splineOrder</span><span class="o">=</span><span class="n">splineOrder</span><span class="p">,</span> <span class="n">fillVal</span><span class="o">=</span><span class="n">fillVal</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">newModel</span></div>


<div class="viewcode-block" id="tiltGalaxy"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.tiltGalaxy">[docs]</a><span class="k">def</span> <span class="nf">tiltGalaxy</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inclination</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">splineOrder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fillVal</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Tilt a galaxy image around the South-North axis (assumed vertical) passing through the image centre.</span>
<span class="sd">    </span>
<span class="sd">    .. deprecated:: 1.0</span>
<span class="sd">        </span>
<span class="sd">        This function is deprecated and may be removed soon.</span>

<span class="sd">    :param model: intensity map of the galaxy model</span>
<span class="sd">    :type model: 2D ndarray</span>

<span class="sd">    :param fillVal: (**Optional**) value to fill pixels which may become empty</span>
<span class="sd">    :type fillVal: int or float</span>
<span class="sd">    :param bool fitIn: (**Optional**) whether to resize the image to fit it in or not. If False, a new image is generated with the same dimensions.</span>
<span class="sd">    :param inclination: (**Optional**) rotation angle to apply (counted clock-wise in degrees). Is 0, no rotation is applied.</span>
<span class="sd">    :param int splineOrder: (**Optional**) order of the spline used to compute the intensity value at new pixel location</span>
<span class="sd">    </span>
<span class="sd">    :returns: a new image of a galaxy tilted by some angle around the vertical axis passing through the image centre</span>
<span class="sd">    :rtype: 2D ndarray</span>
<span class="sd">    </span>
<span class="sd">    :raises ValueError: if model image is not 2-dimensional</span>
<span class="sd">    '''</span>
    
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Model should be 2-dimensional only. Current number of dimensions is </span><span class="si">%d</span><span class="s1">. Cheers !'</span> <span class="o">%</span><span class="n">model</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
    
    <span class="c1"># Apply coordinate transform on grid</span>
    <span class="n">inclination</span>   <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span>           <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">midX</span>           <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0</span>
    
    <span class="k">if</span> <span class="n">inclination</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">&gt;</span><span class="n">midX</span><span class="p">]</span>  <span class="o">=</span> <span class="n">midX</span> <span class="o">+</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">&gt;</span><span class="n">midX</span><span class="p">]</span><span class="o">-</span><span class="n">midX</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">inclination</span><span class="p">)</span>
        <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">&lt;=</span><span class="n">midX</span><span class="p">]</span> <span class="o">=</span> <span class="n">midX</span> <span class="o">-</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">&lt;=</span><span class="n">midX</span><span class="p">]</span><span class="o">-</span><span class="n">midX</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">inclination</span><span class="p">)</span>
    
    <span class="c1"># Apply coordinate transform on image then using the grid</span>
    <span class="k">return</span> <span class="n">nd</span><span class="o">.</span><span class="n">map_coordinates</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="n">splineOrder</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">fillVal</span><span class="p">)</span></div>


<div class="viewcode-block" id="rotateGalaxy"><a class="viewcode-back" href="../../galaxy/misc.html#galaxy.misc.rotateGalaxy">[docs]</a><span class="k">def</span> <span class="nf">rotateGalaxy</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">PA</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">splineOrder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fitIn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fillVal</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Apply PA rotation to a galaxy image.</span>
<span class="sd">    </span>
<span class="sd">    .. deprecated:: 1.0</span>
<span class="sd">        </span>
<span class="sd">        This function is deprecated and may be removed soon.</span>

<span class="sd">    :param model: intensity map of the galaxy model</span>
<span class="sd">    :type model: 2D ndarray</span>

<span class="sd">    :param fillVal: (**Optional**) value to fill pixels which may become empty</span>
<span class="sd">    :type fillVal: int or float</span>
<span class="sd">    :param bool fitIn: (**Optional**) whether to resize the image to fit it in or not. If False a new image is generated with the same dimensions.</span>
<span class="sd">    :param PA: (**Optional**) rotation angle to apply (counted clock-wise in degrees). Default is 0 so that no rotation is applied.</span>
<span class="sd">    :type PA: int or float</span>
<span class="sd">    :param int splineOrder: (**Optional**) order of the spline used to compute the intensity value at new pixel location</span>
<span class="sd">    </span>
<span class="sd">    :returns: a new image of a galaxy rotated by a certain angle</span>
<span class="sd">    :rtype: 2D ndarray</span>
<span class="sd">    </span>
<span class="sd">    :raises ValueError: if model image is not 2-dimensional</span>
<span class="sd">    '''</span>
    
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Model should be 2-dimensional only. Current number of dimensions is </span><span class="si">%d</span><span class="s1">. Cheers !'</span> <span class="o">%</span><span class="n">model</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
    
    <span class="c1"># We count angles anti clock-wise so we need to inverte the value for rotate which counts clock-wise</span>
    <span class="k">return</span> <span class="n">nd</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">-</span><span class="n">PA</span><span class="p">,</span> <span class="n">reshape</span><span class="o">=</span><span class="n">fitIn</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">splineOrder</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">fillVal</span><span class="p">)</span></div>
</code></pre></div>
</article>
<footer>
<div class="mt-20 mb-4 text-sm text-gray-700">© 2022, Wilfried Mercier Made with <a href="https://www.sphinx-doc.org">Sphinx 4.4.0</a></div>
</footer></main>
<button class="fixed bottom-0 right-0 z-20 opacity-0 p-4 m-4 tracking-wide bg-gray-900 text-gray-100 transition transform transform-gpu duration-500 translate-y-full" data-action="search#hideSnackbar" data-search-target="snackbar">
  Clear highlights
</button><div class="fixed hidden inset-0 bg-black bg-opacity-50" data-action="click-&gt;sidebar#close" data-sidebar-target="screen">
</div>
</div>
<script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
<script src="../../_static/jquery.js"></script>
<script src="../../_static/underscore.js"></script>
<script src="../../_static/doctools.js"></script>
<script src="../../_static/clipboard.min.js"></script>
<script src="../../_static/copybutton.js"></script>
<script src="../../_static/theme.3666d2347a4c66e5d7a8.js"></script>
</body>
</html>