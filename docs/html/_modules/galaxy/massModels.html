<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <meta name="generator" content="sphinx-4.4.0, furo 2021.09.22"/>
        <title>galaxy.massModels - wilfried library 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=150e365fa939648e89c22f6d7d13c72a1657915a" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=16fb25fabf47304eee183a5e9af80b1ba98259b1" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: red;
  --color-brand-content: #CC3333;
  --color-admonition-background: orange;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: red;
  --color-brand-content: #CC3333;
  --color-content-foreground: #ababab;
  --color-api-overall: white;
  --color-sidebar-brand-text: red;
  --color-sidebar-item-background--current: #CC3333;
  --color-sidebar-link-text: white;
  --color-sidebar-link-text--top-level: white;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: red;
  --color-brand-content: #CC3333;
  --color-content-foreground: #ababab;
  --color-api-overall: white;
  --color-sidebar-brand-text: red;
  --color-sidebar-item-background--current: #CC3333;
  --color-sidebar-link-text: white;
  --color-sidebar-link-text--top-level: white;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">wilfried library 1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">wilfried library 1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../dependencies.html">Required dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../makeLifeSimpler.html">makeLifeSimpler</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../utilities/index.html">Useful utilities</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../utilities/coloredMessages.html">Colored messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utilities/dict.html">Dictionaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utilities/io.html">Input/Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utilities/list.html">List manipulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utilities/strings.html">Strings manipulation</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../utilities/plotUtilities/index.html">Plot utilities</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../utilities/plotUtilities/asManyHists.html">Histograms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../utilities/plotUtilities/hst.html">Galfit related plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../utilities/plotUtilities/misc.html">Miscellaneous</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../utilities/plotUtilities/singleContour.html">Contours</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../galaxy/index.html">Galaxy module</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../galaxy/angularMomentum.html">Galaxies angular momentum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../galaxy/cosmology.html">Cosmology computations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../galaxy/geometry.html">Galaxies angular momentum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../galaxy/kinematics.html">Galaxy kinematics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../galaxy/misc.html">Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../galaxy/massModels.html">Galaxy mass models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../galaxy/models.html">Galaxy models</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../galaxy/morphology/index.html">Galaxies morphology</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../galaxy/morphology/SersicFlux.html">Sersic fluxes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../galaxy/morphology/Morpho.html">Morphological parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../galaxy/morphology/Thickness.html">Galaxies thickness</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../galaxy/morphology/MUSE.html">MUSE related functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../galaxy/morphology/Other.html">Other Sersic related functions</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../galaxy/photometry/index.html">Galaxies photometry</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../galaxy/photometry/Fluxes.html">Fluxes, colour excess and attenuation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../galaxy/photometry/Masses_SFR.html">Masses and SFR estimates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../galaxy/photometry/Magnitudes.html">Magnitude conversions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../galfit/index.html">Galfit module</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../galfit/galfit.html">Galfit auto-routines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../galfit/models.html">Galfit models</a></li>
</ul>
</li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for galaxy.massModels</h1><div class="highlight"><pre>
<span></span>    <span class="c1">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">"""</span>
<span class="sd">.. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>

<span class="sd">3D and 2D mass models for different mass and light profiles.</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">numpy</span>                      <span class="k">as</span>     <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">astropy.units</span>              <span class="k">as</span>     <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">wilfried.galaxy.morphology</span> <span class="k">as</span>     <span class="nn">morpho</span>
<span class="kn">from</span>   <span class="nn">astropy.units.core</span>         <span class="kn">import</span> <span class="n">UnitConversionError</span>
<span class="kn">from</span>   <span class="nn">.models</span>                    <span class="kn">import</span> <span class="n">checkAndComputeIe</span><span class="p">,</span> <span class="n">sersic_profile</span>
<span class="kn">from</span>   <span class="nn">.misc</span>                      <span class="kn">import</span> <span class="n">compute_bn</span><span class="p">,</span> <span class="n">realGammainc</span>
<span class="kn">from</span>   <span class="nn">astropy.constants</span>          <span class="kn">import</span> <span class="n">G</span>
<span class="kn">from</span>   <span class="nn">scipy.special</span>              <span class="kn">import</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">k1</span>
<span class="kn">from</span>   <span class="nn">numpy</span>                      <span class="kn">import</span> <span class="n">ndarray</span>

<span class="kn">from</span>   <span class="nn">typing</span>                     <span class="kn">import</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span>   <span class="nn">astropy.cosmology</span>      <span class="kn">import</span> <span class="n">Planck18</span> <span class="k">as</span> <span class="n">cosmo</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span>   <span class="nn">astropy.cosmology</span>      <span class="kn">import</span> <span class="n">Planck15</span> <span class="k">as</span> <span class="n">cosmo</span>

<span class="c1"># Custom types</span>
<span class="n">QuantityType</span> <span class="o">=</span> <span class="n">Type</span><span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">]</span>

<span class="c1">#######################################################################################</span>
<span class="c1">#                           3D profiles and their functions                           #</span>
<span class="c1">#######################################################################################</span>

<div class="viewcode-block" id="MassModelBase"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase">[docs]</a><span class="k">class</span> <span class="nc">MassModelBase</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Base class for mass models.</span>
<span class="sd">    </span>
<span class="sd">    .. warning::</span>
<span class="sd">    </span>
<span class="sd">        When using a method, make sure the unit of the radial distance is identical to that of the scale parameter of the model.</span>
<span class="sd">        </span>
<span class="sd">    .. note::</span>
<span class="sd">            </span>
<span class="sd">        Units must be given such that they are recognised by astropy.units module.</span>

<span class="sd">    :param int dim: number of dimensions of the model</span>
<span class="sd">    :param float M_L: mass to light ratio</span>
<span class="sd">    :param str unit_M_L: unit of the mass to light ratio. Refer to the specific mass model to know which unit to provide.</span>
<span class="sd">    :raises ValueError: if </span>
<span class="sd">    </span>
<span class="sd">    * **dim** is not an integer</span>
<span class="sd">    * **dim** &lt; 1</span>
<span class="sd">    * **M_L** &lt;= 0</span>
<span class="sd">    * **M_L** is neither an int or float or np.float16 or np.float32 or np.float64</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="MassModelBase.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">M_L</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'solMass.s.cm^2.A/erg)'</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Given dimension is not correct.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">M_L</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Mass to light ratio is negative or null.'</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">M_L</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">M_L</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Mass to light ratio must either be an int, float, np.float16, np.float32 or np.float64.'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">M_L</span> <span class="o">=</span> <span class="n">M_L</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_M_L</span><span class="p">)</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">M_L</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Mass to light ratio must either be an int or a float.'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">M_L</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">M_L</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit_M_L</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span> <span class="o">=</span> <span class="n">dim</span></div>
        
        
<div class="viewcode-block" id="MassModelBase.__add__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.__add__">[docs]</a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">'''Add this instance with any other object. Only adding 3D models is allowed.'''</span>
        
        <span class="k">return</span> <span class="n">Multiple3DModels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="MassModelBase._checkR"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase._checkR">[docs]</a>    <span class="k">def</span> <span class="nf">_checkR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">against</span><span class="p">:</span> <span class="n">QuantityType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Check whether radial distance is positive and has a unit.</span>
<span class="sd">        </span>
<span class="sd">        :param r: radial distance</span>
<span class="sd">        :type r: int or float or astropy.units Quantity</span>
<span class="sd">        :param against: parameter to retrieve the unit from</span>
<span class="sd">        :type against: astropy.unit Quantity</span>
<span class="sd">        </span>
<span class="sd">        :returns: the radial distance</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises ValueError: if **r** &lt; 0</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">r</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Radial distance is &lt; 0. Please provide a positive valued distance.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">*=</span> <span class="n">against</span><span class="o">.</span><span class="n">unit</span>

        <span class="k">return</span> <span class="n">r</span></div>
    
    
    <span class="c1">###########################################################</span>
    <span class="c1">#       Default methods (some need to be overriden)       #</span>
    <span class="c1">###########################################################</span>
    
<div class="viewcode-block" id="MassModelBase.flux"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.flux">[docs]</a>    <span class="k">def</span> <span class="nf">flux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Compute the enclosed flux at radius r</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">                    </span>
<span class="sd">            F(&lt;r) = 4\pi \int_0^r dx~x^2 \rho (&lt;x),</span>
<span class="sd">            </span>
<span class="sd">        with :math:`\rho(r)` the light density profile.</span>

<span class="sd">        :param r: radius where to compute the luminosity</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        :returns: flux enclosed in a sphere of radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises NotImplementedError: This method needs be implemented in a subclass first in order to be used</span>
<span class="sd">        '''</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'flux method not implemented yet.'</span><span class="p">)</span>
        <span class="k">return</span></div>
    
    
<div class="viewcode-block" id="MassModelBase.gfield"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.gfield">[docs]</a>    <span class="k">def</span> <span class="nf">gfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the gravitational field at radius r.</span>

<span class="sd">        :param r: radius where the gravitational field is computed</span>
<span class="sd">        :type r: int or float</span>

<span class="sd">        :returns: g(r)</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises NotImplementedError: This method needs be implemented in a subclass first in order to be used</span>
<span class="sd">        '''</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'gfield method not implemented yet.'</span><span class="p">)</span>
        <span class="k">return</span></div>
    
    
<div class="viewcode-block" id="MassModelBase.mass"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.mass">[docs]</a>    <span class="k">def</span> <span class="nf">mass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the enclosed (integrated) mass at radius r.</span>

<span class="sd">        :param r: radius where to compute the mass</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        </span>
<span class="sd">        :returns: mass enclosed in a sphere of radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises NotImplementedError: This method needs be implemented in a subclass first in order to be used</span>
<span class="sd">        '''</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="MassModelBase.mass_profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.mass_profile">[docs]</a>    <span class="k">def</span> <span class="nf">mass_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the **mass density** profile at radius r.</span>

<span class="sd">        :param r: radius where to compute the profile</span>
<span class="sd">        :type r: int or float</span>

<span class="sd">        :returns: mass density profile at radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        '''</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="MassModelBase.profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.profile">[docs]</a>    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the light density profile at radius r.</span>

<span class="sd">        :param r: radius where to compute the profile</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        </span>
<span class="sd">        :returns: light profile at radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises NotImplementedError: This method needs be implemented in a subclass first in order to be used</span>
<span class="sd">        '''</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'profile method not implemented yet.'</span><span class="p">)</span>
        <span class="k">return</span></div>
    
    
<div class="viewcode-block" id="MassModelBase.velocity"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.MassModelBase.velocity">[docs]</a>    <span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Velocity profile for a self-sustaining 3D profile against its own gravity through centripedal acceleration</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">            </span>
<span class="sd">            V(r) = \sqrt{\frac{G M(&lt;r)}{r}},</span>
<span class="sd">            </span>
<span class="sd">        where :math:`G` is the gravitational constant and :math:`M(&lt;r)` is the enclosed mass.</span>

<span class="sd">        :param r: radius where the velocity profile is computed</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        </span>
<span class="sd">        :returns: V(r)</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        '''</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">)</span></div>
    
    
    <span class="c1">################################</span>
    <span class="c1">#          Properties          #</span>
    <span class="c1">################################</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Ftot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Total flux of the profile.</span>
<span class="sd">        </span>
<span class="sd">        :raises NotImplementedError: This property needs be implemented in a subclass first in order to be used</span>
<span class="sd">        '''</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'Ftot method not implemented yet.'</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Mtot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Total mass of the profile.</span>
<span class="sd">        </span>
<span class="sd">        :raises NotImplementedError: This property needs be implemented in a subclass first in order to be used</span>
<span class="sd">        '''</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftot</span></div>

<div class="viewcode-block" id="Multiple3DModels"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels">[docs]</a><span class="k">class</span> <span class="nc">Multiple3DModels</span><span class="p">(</span><span class="n">MassModelBase</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    A master class used when combining two 3D models into a single object.</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="Multiple3DModels.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">'''</span>
<span class="sd">        :param model1: 1st model</span>
<span class="sd">        :type model1: MassModelBase[_dim = 3]</span>
<span class="sd">        :param model2: 2nd model</span>
<span class="sd">        :type model2: MassModelBase[_dim = 3]</span>
<span class="sd">        </span>
<span class="sd">        :raises AttributeError: if **model1** or **model2** does not have a **_dim** attribute</span>
<span class="sd">        :raises ValueError: if **model1** or **model2** do not have **_dim** = 3</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="s1">'_dim'</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="s1">'_dim'</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">'One of the objects is not a valid model instance.'</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">model1</span><span class="o">.</span><span class="n">_dim</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">model2</span><span class="o">.</span><span class="n">_dim</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'One of the models is not 3D or higher. Only 3D models can be combined. Cheers !'</span><span class="p">)</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            
        <span class="c1"># We keep track of models in a list</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">Multiple3DModels</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">Multiple3DModels</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">Multiple3DModels</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">Multiple3DModels</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">models</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">Multiple3DModels</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">Multiple3DModels</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">models</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">models</span> <span class="o">+</span> <span class="n">model2</span><span class="o">.</span><span class="n">models</span></div>
            
            
    <span class="c1">######################################################</span>
    <span class="c1">#            Methods (alphabetical order)            #</span>
    <span class="c1">######################################################</span>
    
    <span class="k">def</span> <span class="nf">__checkArgs__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">'''Check args and kwargs so that they have the same len.'''</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)):</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        
        <span class="k">return</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span>
            
    
<div class="viewcode-block" id="Multiple3DModels.gfield"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels.gfield">[docs]</a>    <span class="k">def</span> <span class="nf">gfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]],</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}])</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the full gravitational field at radius r.</span>
<span class="sd">        </span>
<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            Because models can require different arguments (for instance 3D radial distance r for one and 2D R in disk plane for the other), these are separated in lists.</span>
<span class="sd">            Each element will be passed to the corresponding model. The order is the same as in models list variable.</span>
<span class="sd">    </span>
<span class="sd">        :param list[list] args: (**Optional**) arguments to pass to each model. Order is that of models list.</span>
<span class="sd">        :param list[list] kwargs: (**Optional**) kwargs to pass to each model. Order is that of models list.</span>
<span class="sd">        </span>
<span class="sd">        :returns: sum of the gravitational fields for each model</span>
<span class="sd">        '''</span>
        
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checkArgs__</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">gfield</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>
        
        
        
<div class="viewcode-block" id="Multiple3DModels.flux"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels.flux">[docs]</a>    <span class="k">def</span> <span class="nf">flux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]],</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}])</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the enclosed flux at radius r.</span>
<span class="sd">        </span>
<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            Because models can require different arguments (for instance 3D radial distance r for one and 2D R in disk plane for the other), these are separated in lists.</span>
<span class="sd">            Each element will be passed to the corresponding model. The order is the same as in models list variable.</span>
<span class="sd">    </span>
<span class="sd">        :param list[list] args: (**Optional**) arguments to pass to each model. Order is that of models list.</span>
<span class="sd">        :param list[list] kwargs: (**Optional**) kwargs to pass to each model. Order is that of models list.</span>
<span class="sd">        </span>
<span class="sd">        :returns: sum of the flux for each model</span>
<span class="sd">        '''</span>
        
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checkArgs__</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">mass</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>
        
    
<div class="viewcode-block" id="Multiple3DModels.mass"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels.mass">[docs]</a>    <span class="k">def</span> <span class="nf">mass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]],</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}])</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the enclosed mass at radius r.</span>
<span class="sd">        </span>
<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            Because models can require different arguments (for instance 3D radial distance r for one and 2D R in disk plane for the other), these are separated in lists.</span>
<span class="sd">            Each element will be passed to the corresponding model. The order is the same as in models list variable.</span>
<span class="sd">    </span>
<span class="sd">        :param list[list] args: (**Optional**) arguments to pass to each model. Order is that of models list.</span>
<span class="sd">        :param list[list] kwargs: (**Optional**) kwargs to pass to each model. Order is that of models list.</span>
<span class="sd">        </span>
<span class="sd">        :returns: sum of the mass for each model</span>
<span class="sd">        '''</span>
        
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checkArgs__</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">mass</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="Multiple3DModels.mass_profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels.mass_profile">[docs]</a>    <span class="k">def</span> <span class="nf">mass_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]],</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}])</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the mass profile at radius r.</span>

<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            Because models can require different arguments (for instance 3D radial distance r for one and 2D R in disk plane for the other), these are separated in lists.</span>
<span class="sd">            Each element will be passed to the corresponding model. The order is the same as in models list variable.</span>
<span class="sd">    </span>
<span class="sd">        :param list[list] args: (**Optional**) arguments to pass to each model. Order is that of models list.</span>
<span class="sd">        :param list[list] kwargs: (**Optional**) kwargs to pass to each model. Order is that of models list.</span>
<span class="sd">        </span>
<span class="sd">        :returns: sum of the mass density profile for each model</span>
<span class="sd">        '''</span>
        
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checkArgs__</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">mass_profile</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>
    
            
<div class="viewcode-block" id="Multiple3DModels.profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels.profile">[docs]</a>    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]],</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}])</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the light profile at radius r.</span>

<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            Because models can require different arguments (for instance 3D radial distance r for one and 2D R in disk plane for the other), these are separated in lists.</span>
<span class="sd">            Each element will be passed to the corresponding model. The order is the same as in models list variable.</span>
<span class="sd">    </span>
<span class="sd">        :param list[list] args: (**Optional**) arguments to pass to each model. Order is that of models list.</span>
<span class="sd">        :param list[list] kwargs: (**Optional**) kwargs to pass to each model. Order is that of models list.</span>
<span class="sd">        </span>
<span class="sd">        :returns: sum of the light profile for each model</span>
<span class="sd">        '''</span>
        
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checkArgs__</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span> <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>
    
    
    <span class="c1">################################################################</span>
    <span class="c1">#                          Velocities                          #</span>
    <span class="c1">################################################################            </span>
    
<div class="viewcode-block" id="Multiple3DModels.velocity"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Multiple3DModels.velocity">[docs]</a>    <span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[]],</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}])</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Velocity profile for the 3D models against their own gravity through centripedal acceleration.</span>

<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            Because models can require different arguments (for instance 3D radial distance r for one and 2D R in disk plane for the other), these are separated in lists.</span>
<span class="sd">            Each element will be passed to the corresponding model. The order is the same as in models list variable.</span>
<span class="sd">    </span>
<span class="sd">        :param list[list] args: (**Optional**) arguments to pass to each model. Order is that of models list.</span>
<span class="sd">        :param list[list] kwargs: (**Optional**) kwargs to pass to each model. Order is that of models list.</span>
<span class="sd">        </span>
<span class="sd">        :returns: sum of the velocity profile for each model</span>
<span class="sd">        '''</span>
        
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checkArgs__</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">velocity</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span></div>
    
    
    <span class="c1">##############################</span>
    <span class="c1">#         Properties         #</span>
    <span class="c1">##############################</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Ftot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''Total flux of the profiles.'''</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">Ftot</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Mtot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''Total mass of the profiles.'''</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">Mtot</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Hernquist"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Hernquist">[docs]</a><span class="k">class</span> <span class="nc">Hernquist</span><span class="p">(</span><span class="n">MassModelBase</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    3D Hernquist model class.</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="Hernquist.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Hernquist.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">F</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">M_L</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> 
                 <span class="n">unit_a</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">'kpc'</span><span class="p">,</span> <span class="n">unit_F</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">'erg/(s.A)'</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">'solMass.s.A.cm^2/(erg.kpc^2)'</span><span class="p">,</span> 
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        :param a: scale factor</span>
<span class="sd">        :type a: int or float</span>
<span class="sd">        :param F: amplitude parameter (total flux)</span>
<span class="sd">        :type F: int or float</span>
<span class="sd">        :param M_L: mass to light ratio</span>
<span class="sd">        :type M_L: int or float</span>
<span class="sd">               </span>
<span class="sd">        :param str unit_a: unit of the scale parameter a</span>
<span class="sd">        :param str unit_F: unit of the amplitude parameter M</span>
<span class="sd">        :param str unit_M_L: unit used to convert from light to mass profiles</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if **a** or **F** are neither int, float, np.foat16, np.float32 or np.float64</span>
<span class="sd">        '''</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">M_L</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="o">=</span><span class="n">unit_M_L</span><span class="p">)</span>
        
        <span class="c1"># If parameters are already passed as Astropy Quantities, just convert them</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a</span>  <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a</span>  <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">unit_a</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">F</span>  <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_F</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">F</span>  <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">unit_F</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'One of the parameters is not an int, float, np.float16, np.float32 or np.float64.'</span><span class="p">)</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'km/s'</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UnitConversionError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnitConversionError</span><span class="p">(</span><span class="s1">'The unit of Vmax (</span><span class="si">%s</span><span class="s1">) could not be converted to km/s. Please check carefully the units of F, a and M_L parameters. Cheers !'</span> <span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
        
        <span class="c1">#: Offset parameter to make the conversion Re (Sersic) &lt;-&gt; a (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha_a</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.454</span>
        
        <span class="c1">#: Slope parameter to make the conversion Re (Sersic) &lt;-&gt; a (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_beta_a</span>  <span class="o">=</span> <span class="mf">0.725</span>
        
        <span class="c1">#: Offset parameter to make the conversion Ie (Sersic) &lt;-&gt; F (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha_F</span> <span class="o">=</span> <span class="mf">1.194</span>
        
        <span class="c1">#: Slope parameter to make the conversion Ie (Sersic) &lt;-&gt; F (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_beta_F</span>  <span class="o">=</span> <span class="mf">1.75</span></div>
        
        
    <span class="c1">######################################################</span>
    <span class="c1">#            Methods (alphabetical order)            #</span>
    <span class="c1">######################################################    </span>
    
<div class="viewcode-block" id="Hernquist.flux"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Hernquist.flux">[docs]</a>    <span class="k">def</span> <span class="nf">flux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the enclosed flux at radius r.</span>

<span class="sd">        :param r: radius where to compute the luminosity</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        </span>
<span class="sd">        :returns: flux enclosed in a sphere of radius r</span>
<span class="sd">        :rtype: astropy.units Quantity </span>
<span class="sd">        '''</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span></div>
    
    
<div class="viewcode-block" id="Hernquist.gfield"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Hernquist.gfield">[docs]</a>    <span class="k">def</span> <span class="nf">gfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the gravitational field of a single Hernquist profile at radius r.</span>

<span class="sd">        :param r: radius where the gravitational field is computed</span>
<span class="sd">        :type r: int or float</span>

<span class="sd">        :returns: g(r)</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>   
            <span class="k">return</span> <span class="o">-</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span></div>
        
        
<div class="viewcode-block" id="Hernquist.profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Hernquist.profile">[docs]</a>    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the light density profile at radius r.</span>

<span class="sd">        :param r: radius where to compute the profile</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        </span>
<span class="sd">        :returns: light profile at radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span></div>
    
        
<div class="viewcode-block" id="Hernquist.velocity"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Hernquist.velocity">[docs]</a>    <span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">QuantityType</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Velocity profile for a self-sustaining Hernquist 3D profile against its own gravity through centripedal acceleration.</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">            </span>
<span class="sd">            V(r) = \sqrt{\frac{G M(&lt;r)}{r}},</span>
<span class="sd">            </span>
<span class="sd">        where :math:`G` is the gravitational constant and :math:`M(&lt;r)` is the enclosed mass.</span>

<span class="sd">        :param r: radius where the velocity profile is computed</span>
<span class="sd">        :type r: int, float, astropy Quantity or ndarray[float]</span>
<span class="sd">        </span>
<span class="sd">        :returns: velocity profile at a radius **r** in :math:`\rm{km/s}`</span>
<span class="sd">        :rtype: Astropy Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if **r** is neither int, float, np.float16, np.float32, np.foat64 or ndarray</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vr</span>   <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'km/s'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vr</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">+</span><span class="n">r</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">vr</span>       <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">r</span><span class="p">)),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'km/s'</span><span class="p">)</span>
            <span class="n">mask</span>     <span class="o">=</span> <span class="n">r</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="n">rmask</span>    <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">vr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">*</span><span class="n">rmask</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">+</span><span class="n">rmask</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'r array has type </span><span class="si">%s</span><span class="s1"> but only float and numpy array are expected.'</span> <span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">vr</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'km/s'</span><span class="p">)</span></div>
    
    
    <span class="c1">################################</span>
    <span class="c1">#          Properties          #</span>
    <span class="c1">################################</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Ftot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''Total flux of the profile.'''</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">todeVaucouleur</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''Alias of :py:attr:`toSersic`.'''</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">toSersic</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">toSersic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">'''</span>
<span class="sd">        Create the best fit Sersic instance from this Hernquist instance.</span>
<span class="sd">        </span>
<span class="sd">        :returns: Best-fit Sersic instance (see Mercier et al., 2021)</span>
<span class="sd">        :rtype: Sersic</span>
<span class="sd">        '''</span>
        
        <span class="n">Re</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha_a</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_beta_a</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">Ie</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha_F</span> <span class="o">*</span> <span class="n">Re</span><span class="o">.</span><span class="n">value</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_beta_F</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">unit</span><span class="o">/</span><span class="p">(</span><span class="n">Re</span><span class="o">.</span><span class="n">unit</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">deVaucouleur</span><span class="p">(</span><span class="n">Re</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="n">Ie</span><span class="p">,</span> <span class="n">unit_Re</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Re</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span> <span class="n">unit_Ie</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Ie</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span></div>
        
        
<div class="viewcode-block" id="NFW"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW">[docs]</a><span class="k">class</span> <span class="nc">NFW</span><span class="p">(</span><span class="n">MassModelBase</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Navarro Frenk and White profile.</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="NFW.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Rs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">QuantityType</span><span class="p">],</span> 
                 <span class="n">c</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Vmax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">QuantityType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                 <span class="n">unit_Rs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'kpc'</span><span class="p">,</span> <span class="n">unit_Vmax</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'km/s'</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            Two pairs of parameters can be passed:</span>
<span class="sd">                </span>
<span class="sd">                * **Rs** and **c** </span>
<span class="sd">                * **Rs** and **Vmax**</span>

<span class="sd">        :param Rs: scale parameter</span>
<span class="sd">        :type Rs: int or float or astropy.units Quantity with distance unit</span>
<span class="sd">        </span>
<span class="sd">        :param c: (**Optional**)  concentration parameter. If None, **Vmax** must be given.</span>
<span class="sd">        :type c: int or float</span>
<span class="sd">        :param Vmax: (**Optional**) maximum circular velocity at 2.15*Rs. If None, **c** must be given. If not given as an astropy Quantity, provide the correct unit with **unit_Vmax**.</span>
<span class="sd">        :type Vmax: int or float or astropy.units Quantity with velocity unit</span>
<span class="sd">        :param str unit_Rs: (**Optional**) unit of **Rs**</span>
<span class="sd">        :param str unit_Vmax: (**Optional**) unit of **Vmax**</span>
<span class="sd">        </span>
<span class="sd">        :raises ValueError: if both **Vmax** and **c** are None or if both are not None</span>
<span class="sd">        :raises TypeError: if **c** is not dimensionless</span>
<span class="sd">        :raises astropy.units.core.UnitConversionError: if **Vmax** could not be broadcast to km/s unit</span>
<span class="sd">        '''</span>
        
        <span class="n">Rmax</span>              <span class="o">=</span> <span class="mf">2.163</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_factor</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">Rmax</span><span class="p">)</span><span class="o">/</span><span class="n">Rmax</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">Rmax</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">Vmax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">Vmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Either Vmax or c must be None.'</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Rs</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span>       <span class="o">=</span> <span class="n">Rs</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_Rs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span>       <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">Rs</span><span class="p">,</span> <span class="n">unit_Rs</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">Vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless_unscaled</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'concentration parameter must have no unit.'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">c</span>    <span class="o">=</span> <span class="n">c</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">delta_c</span>  <span class="o">=</span> <span class="mi">200</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)))</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_c</span><span class="o">*</span><span class="n">cosmo</span><span class="o">.</span><span class="n">critical_density</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_factor</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'km/s'</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">UnitConversionError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UnitConversionError</span><span class="p">(</span><span class="s1">'The unit of Vmax (</span><span class="si">%s</span><span class="s1">) could not be converted to km/s. Please check carefully the units of Rs. Cheers !'</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_c</span><span class="o">*</span><span class="n">cosmo</span><span class="o">.</span><span class="n">critical_density</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span>        <span class="o">=</span> <span class="n">c</span>
            
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Vmax</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_Vmax</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">Vmax</span><span class="p">,</span> <span class="n">unit_Vmax</span><span class="p">)</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delta_c</span>  <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_factor</span><span class="o">*</span><span class="n">cosmo</span><span class="o">.</span><span class="n">critical_density</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">UnitConversionError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UnitConversionError</span><span class="p">(</span><span class="s1">'delta_c parameter could not be computed as a dimensionless quantity.'</span><span class="p">)</span>
            
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="o">=</span><span class="s1">'solMass.s.A.cm^2/(erg.kpc^2)'</span><span class="p">)</span></div>
      
        
    <span class="c1">######################################################</span>
    <span class="c1">#            Methods (alphabetical order)            #</span>
    <span class="c1">######################################################</span>
    
<div class="viewcode-block" id="NFW.flux"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW.flux">[docs]</a>    <span class="k">def</span> <span class="nf">flux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the enclosed flux at radius r.</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            The flux returned is 0 since this is a DM profile.</span>

<span class="sd">        :param r: radius where to compute the luminosity</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        :returns: flux enclosed in a sphere of radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'erg/(s.A)'</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="NFW.gfield"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW.gfield">[docs]</a>    <span class="k">def</span> <span class="nf">gfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the gravitational field of a single NFW profile at radius r.</span>

<span class="sd">        :param r: radius where the gravitational field is computed</span>
<span class="sd">        :type r: int or float</span>

<span class="sd">        :returns: g(r)</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises NotImplementedError: This method needs be implemented</span>
<span class="sd">        '''</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'gfield not implemented for a NFW profile'</span><span class="p">)</span>
        <span class="k">return</span></div>
    
    
<div class="viewcode-block" id="NFW.mass"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW.mass">[docs]</a>    <span class="k">def</span> <span class="nf">mass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
         <span class="sd">'''</span>
<span class="sd">        Compute the enclosed (integrated) mass at radius r.</span>
<span class="sd">        </span>
<span class="sd">        :param r: radius where to compute the mass</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        :returns: mass enclosed in a sphere of radius r</span>
<span class="sd">        :rtype: astropy.units Quantity'''</span>
        
         <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">r</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">velocity</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">G</span></div>

    
<div class="viewcode-block" id="NFW.mass_profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW.mass_profile">[docs]</a>    <span class="k">def</span> <span class="nf">mass_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the **mass density** profile at radius r.</span>

<span class="sd">        :param r: radius where to compute the profile</span>
<span class="sd">        :type r: int or float</span>

<span class="sd">        :returns: mass density profile at radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_factor</span> <span class="o">*</span> <span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="NFW.profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW.profile">[docs]</a>    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Compute the light density profile at radius r.</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            The light density profile returned is 0 since this is a DM profile.</span>

<span class="sd">        :param r: radius where to compute the profile</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        </span>
<span class="sd">        :returns: light profile at radius r</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'erg/(s.A.cm^2)'</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="NFW.velocity"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.NFW.velocity">[docs]</a>    <span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">QuantityType</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Velocity profile for a self-sustaining 3D profile against its own gravity through centripedal acceleration</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">            </span>
<span class="sd">            V(r) = \sqrt{\frac{G M(&lt;r)}{r}},</span>
<span class="sd">            </span>
<span class="sd">        where :math:`G` is the gravitational constant and :math:`M(&lt;r)` is the enclosed mass.</span>

<span class="sd">        :param r: radius where the velocity profile is computed</span>
<span class="sd">        :type r: int, float, astropy Quantity or ndarray[float]</span>
<span class="sd">        </span>
<span class="sd">        :returns: velocity profile at a radius **r** in :math:`\rm{km/s}`</span>
<span class="sd">        :rtype: Astropy Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if **r** is neither int, float, np.float16, np.float32, np.foat64 or ndarray</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vr</span>   <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'km/s'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vr</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span><span class="o">/</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factor</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">vr</span>       <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">r</span><span class="p">)),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'km/s'</span><span class="p">)</span>
            <span class="n">mask</span>     <span class="o">=</span> <span class="n">r</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="n">rmask</span>    <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">vr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rmask</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">)</span><span class="o">/</span><span class="n">rmask</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">rmask</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_factor</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'r array has type </span><span class="si">%s</span><span class="s1"> but only float and numpy array are expected.'</span> <span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">vr</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'km/s'</span><span class="p">)</span></div>
        
    
    <span class="c1">################################</span>
    <span class="c1">#          Properties          #</span>
    <span class="c1">################################</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Ftot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">'''Total flux (infinite).'''</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Mvir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''Virial mass.'''</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="mi">800</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">cosmo</span><span class="o">.</span><span class="n">critical_density</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rvir</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>

    <span class="nd">@property</span>    
    <span class="k">def</span> <span class="nf">Rvir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Virial radius.</span>
<span class="sd">        </span>
<span class="sd">        :raises ValueError: if **c** is None</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Virial radius cannot be computed if the concentration parameter is not provided.'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rs</span></div>
        

<span class="c1">#################################################################################</span>
<span class="c1">#                                Sersic profiles                                #</span>
<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="Sersic"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Sersic">[docs]</a><span class="k">class</span> <span class="nc">Sersic</span><span class="p">:</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    2D Sersic profile class.</span>
<span class="sd">    </span>
<span class="sd">    .. warning::</span>
<span class="sd">    </span>
<span class="sd">        When using a method, make sure the unit of the radial distance is identical to that of the scale parameter of the model.</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="Sersic.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Sersic.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">Re</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> 
                 <span class="n">Ie</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mag</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                 <span class="n">unit_Re</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'kpc'</span><span class="p">,</span> <span class="n">unit_Ie</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'erg/(cm^2.s.A)'</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            You can either provide:</span>
<span class="sd">                </span>
<span class="sd">                * **n**, **Re** and **Ie**</span>
<span class="sd">                * **n**, **Re**, **mag** and **offset**</span>
<span class="sd">        </span>
<span class="sd">        :param n: Sersic index</span>
<span class="sd">        :type n: int or flat</span>
<span class="sd">        :param Re: half-light radius</span>
<span class="sd">        :type Re: int or float</span>
<span class="sd">        </span>
<span class="sd">        :param float Ie: (**Optional**) intensity at half-light radius</span>
<span class="sd">        :param float mag: (**Optional**) galaxy total integrated magnitude used to compute Ie if not given</span>
<span class="sd">        :param float offset: (**Optional**) magnitude offset in the magnitude system used</span>
<span class="sd">        :param str unit_Ie: (**Optional**) unit for the surface brightness. If **Ie** already has a unit, it is converted to this unit.</span>
<span class="sd">        :param str unit_Re: (**Optional**) unit for the scale radius **Re**. If **Re** already has a unit, it is converted to this unit.</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if n or Re are neither int, float, np.float16, np.float32 or np.float64</span>
<span class="sd">        :raises ValueError: if Ie and mag and offset are None, if n &lt;= 0, if Re &lt;= 0 or if Ie &lt;= 0</span>
<span class="sd">        """</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'n is not an int, float, np.float16, np.float32 or np.float64.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Re</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'Re is not an int, float, np.float16, np.float32 or np.float64.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">Ie</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mag</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Ie is None but no magnitude and no offset is given.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">n</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'n must be positive valued. Cheers !'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">Re</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'The effective radius Re must be positive valued. Cheers !'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">Ie</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">Ie</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'The effective radius Re must be positive valued. Cheers !'</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span>     <span class="o">=</span> <span class="mi">2</span>
        
        <span class="c1">#: Sersic index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span>        <span class="o">=</span> <span class="n">n</span>
        
        <span class="c1">#: Sersic :math:`b_n` factor defined as :math:`2\gamma(2n, b_n) = \Gamma(2n)`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bn</span>       <span class="o">=</span> <span class="n">compute_bn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        
        <span class="c1"># If the parameters already are Astropy quantities, we just convert them to the required unit</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Re</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="c1">#: Effective (half-light) radius</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Re</span>   <span class="o">=</span> <span class="n">Re</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_Re</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Re</span>   <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">Re</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit_Re</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Ie</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="c1">#: Surface brightness at Re</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span>   <span class="o">=</span> <span class="n">Ie</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_Ie</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span>   <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">checkAndComputeIe</span><span class="p">(</span><span class="n">Ie</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">offset</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit_Ie</span><span class="p">)</span>
            
        <span class="c1">#: Central intensity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I0</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span></div>
        

    <span class="c1">######################################################</span>
    <span class="c1">#            Methods (alphabetical order)            #</span>
    <span class="c1">######################################################</span>
    
<div class="viewcode-block" id="Sersic._checkR"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Sersic._checkR">[docs]</a>    <span class="k">def</span> <span class="nf">_checkR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">QuantityType</span><span class="p">],</span> <span class="n">against</span><span class="p">:</span> <span class="n">QuantityType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Check whether radial distance is positive and has a unit.</span>
<span class="sd">        </span>
<span class="sd">        :param r: radial distance</span>
<span class="sd">        :type r: int or float or astropy.units Quantity</span>
<span class="sd">        :param against: parameter to retrieve the unit from</span>
<span class="sd">        :type against: astropy.unit Quantity</span>
<span class="sd">        </span>
<span class="sd">        :returns: the radial distance</span>
<span class="sd">        :rtype: astropy.units Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises ValueError: if **r** &lt; 0</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">r</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Radial distance is &lt; 0. Please provide a positive valued distance.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">*=</span> <span class="n">against</span><span class="o">.</span><span class="n">unit</span>

        <span class="k">return</span> <span class="n">r</span></div>
        
<div class="viewcode-block" id="Sersic.profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Sersic.profile">[docs]</a>    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Sersic surface brightness profile at radius r.</span>

<span class="sd">        :param r: radius where the profile is computed</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        :returns: Sersic profile computed at the radius r</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sersic_profile</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="p">,</span> <span class="n">bn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="Sersic.flux"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.Sersic.flux">[docs]</a>    <span class="k">def</span> <span class="nf">flux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Flux at radius r (encompassed within a disk since this is a 2D profile).</span>

<span class="sd">        :param r: radius where the profile is computed</span>
<span class="sd">        :type r: int or float</span>
<span class="sd">        :returns: flux computed within a disk of radius r</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="k">return</span> <span class="n">n2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span><span class="o">*</span><span class="n">realGammainc</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">**</span><span class="n">n2</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Ftot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''Total flux of the profile.'''</span>
        
        <span class="n">n2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="k">return</span> <span class="n">n2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span><span class="o">*</span><span class="n">gamma</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">**</span><span class="n">n2</span></div>
    
    
<div class="viewcode-block" id="deVaucouleur"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.deVaucouleur">[docs]</a><span class="k">class</span> <span class="nc">deVaucouleur</span><span class="p">(</span><span class="n">Sersic</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    2D de Vaucouleur profile.</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="deVaucouleur.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.deVaucouleur.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Re</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">Ie</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mag</span><span class="p">:</span> <span class="nb">float</span>  <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                 <span class="n">unit_Re</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">'kpc'</span><span class="p">,</span> <span class="n">unit_Ie</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'erg/(cm^2.s.A)'</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            You can either provide:</span>
<span class="sd">                </span>
<span class="sd">                * **Re** and **Ie**</span>
<span class="sd">                * **Re**, **mag** and **offset**</span>
<span class="sd">        </span>
<span class="sd">        :param Re: half-light radius</span>
<span class="sd">        :type Re: int or float</span>
<span class="sd">        </span>
<span class="sd">        :param float Ie: (**Optional**) intensity at half-light radius</span>
<span class="sd">        :param float mag: (**Optional**) galaxy total integrated magnitude used to compute Ie if not given</span>
<span class="sd">        :param float offset: (**Optional**) magnitude offset in the magnitude system used</span>
<span class="sd">        :param str unit_Ie: (**Optional**) unit for the surface brightness. If **Ie** already has a unit, it is converted to this unit.</span>
<span class="sd">        :param str unit_Re: (**Optional**) unit for the scale radius **Re**. If **Re** already has a unit, it is converted to this unit.</span>
<span class="sd">        """</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Re</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="n">Ie</span><span class="p">,</span> <span class="n">mag</span><span class="o">=</span><span class="n">mag</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">unit_Re</span><span class="o">=</span><span class="n">unit_Re</span><span class="p">,</span> <span class="n">unit_Ie</span><span class="o">=</span><span class="n">unit_Ie</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1">#: Offset parameter to make the conversion Re (Sersic) &lt;-&gt; a (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha_a</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.454</span>
        
        <span class="c1">#: Slope parameter to make the conversion Re (Sersic) &lt;-&gt; a (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_beta_a</span>  <span class="o">=</span> <span class="mf">0.725</span>
        
        <span class="c1">#: Offset parameter to make the conversion Ie (Sersic) &lt;-&gt; F (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha_F</span> <span class="o">=</span> <span class="mf">1.194</span>
        
        <span class="c1">#: Slope parameter to make the conversion Ie (Sersic) &lt;-&gt; F (Hernquist) (see Mercier et al., 2021)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_beta_F</span>  <span class="o">=</span> <span class="mf">1.75</span></div>
        
        
<div class="viewcode-block" id="deVaucouleur.toHernquist"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.deVaucouleur.toHernquist">[docs]</a>    <span class="k">def</span> <span class="nf">toHernquist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M_L</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">unit_M_L</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'solMass.s.A.cm^2/(erg.kpc^2)'</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">Hernquist</span><span class="p">]:</span>
        <span class="sd">'''</span>
<span class="sd">        Create the best-fit Hernquist instance from this de Vaucouleur instance (see Mercier et al., 2021).</span>
<span class="sd">    </span>
<span class="sd">        :param M_L: mass to light ratio</span>
<span class="sd">        :type M_L: int or float</span>
<span class="sd">        </span>
<span class="sd">        :param str unit_M_L: unit of the mass to light ratio. If M_L already has a unit, it is converted to this unit.</span>
<span class="sd">        </span>
<span class="sd">        :returns: best-fit Hernquist instance (see Mercier et al., 2021)</span>
<span class="sd">        :rtype: Hernquist</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if M_L is neither an int, float, float16, float32, float64 or astropy.units Quantity</span>
<span class="sd">        '''</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">M_L</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'Mass to light ratio must either be an int, float, np.float16, np.float32 or np.float64.'</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">M_L</span><span class="p">,</span> <span class="s1">'unit'</span><span class="p">):</span>
            <span class="n">M_L</span> <span class="o">=</span> <span class="n">M_L</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit_M_L</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">M_L</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">M_L</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit_M_L</span><span class="p">)</span>
    
        <span class="n">a</span>       <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha_a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">.</span><span class="n">value</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_beta_a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">F</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha_F</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">.</span><span class="n">value</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_beta_F</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">.</span><span class="n">unit</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">.</span><span class="n">unit</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">Hernquist</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">M_L</span><span class="p">,</span> <span class="n">unit_a</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span> <span class="n">unit_F</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span> <span class="n">unit_M_L</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">M_L</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span></div></div>
    

<div class="viewcode-block" id="ExponentialDisk"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.ExponentialDisk">[docs]</a><span class="k">class</span> <span class="nc">ExponentialDisk</span><span class="p">(</span><span class="n">Sersic</span><span class="p">,</span> <span class="n">MassModelBase</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    2D/3D exponential disk profile class (razor-thin).</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        Some functions such as the light profile correspond to the 2D Sersic profiles, while others such as the velocity assume a 3D **razor-thin disk**.</span>
<span class="sd">        </span>
<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        You can either provide:</span>
<span class="sd">        </span>
<span class="sd">        * **M_L**, **Re** and **Ie**</span>
<span class="sd">        * **M_L**, **Re**, **mag** and **offset**</span>
<span class="sd">    </span>
<span class="sd">    :param M_L: mass to light ratio</span>
<span class="sd">    :type M_L: int or float</span>
<span class="sd">    :param Re: half-light radius</span>
<span class="sd">    :type Re: int or float</span>
<span class="sd">    </span>
<span class="sd">    :param float Ie: (**Optional**) intensity at half-light radius</span>
<span class="sd">    :param float mag: (**Optional**) galaxy total integrated magnitude used to compute Ie if not given</span>
<span class="sd">    :param float offset: (**Optional**) magnitude offset in the magnitude system used</span>
<span class="sd">    :param str unit_Ie: (**Optional**) unit for the surface brightness. If **Ie** already has a unit, it is converted to this unit.</span>
<span class="sd">    :param str unit_M_L: (**Optional**) unit of the mass to light ratio</span>
<span class="sd">    :param str unit_Re: (**Optional**) unit for the scale radius **Re**. If **Re** already has a unit, it is converted to this unit.</span>
<span class="sd">    </span>
<span class="sd">    :raises astropy.units.core.UnitConversionError: if **Vmax** could not be broadcast to km/s unit</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="ExponentialDisk.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.ExponentialDisk.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Re</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">M_L</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">Ie</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mag</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                 <span class="n">unit_Re</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'kpc'</span><span class="p">,</span> <span class="n">unit_Ie</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'erg/(cm^2.s.A)'</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'solMass.s.A.cm^2/(erg.kpc^2)'</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>        
        
        <span class="n">MassModelBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">M_L</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="p">)</span>
        <span class="n">Sersic</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>       <span class="bp">self</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Re</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="n">Ie</span><span class="p">,</span> <span class="n">mag</span><span class="o">=</span><span class="n">mag</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">unit_Re</span><span class="o">=</span><span class="n">unit_Re</span><span class="p">,</span> <span class="n">unit_Ie</span><span class="o">=</span><span class="n">unit_Ie</span><span class="p">)</span>
        
        <span class="c1">#: Disk scale length :math:`R_{\rm{d}} = R_{\rm{e}} / b_n`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rd</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span>
        
        <span class="c1">#: Position of maximum velocity :math:`2.15 \times R_{\rm{d}}`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rmax</span>     <span class="o">=</span> <span class="mf">2.15</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#: Maximum velocity :math:`0.8798243 \times \sqrt{\pi G R_{\rm{d}} \Sigma_0 \Upsilon }` with :math:`\Sigma_0` the central surface brightness and :math:`\Upsilon` the mass to light ratio</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span> <span class="o">=</span> <span class="mf">0.8798243</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">I0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'km/s'</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UnitConversionError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnitConversionError</span><span class="p">(</span><span class="s1">'The unit of Vmax (</span><span class="si">%s</span><span class="s1">) could not be converted to km/s. Please check carefully the units of Ie, Re and M_L parameters. Cheers !'</span> <span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">))</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span></div>
        
        
    <span class="c1">######################################################</span>
    <span class="c1">#            Methods (alphabetical order)            #</span>
    <span class="c1">######################################################</span>
    
<div class="viewcode-block" id="ExponentialDisk.velocity"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.ExponentialDisk.velocity">[docs]</a>    <span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">QuantityType</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Velocity profile for a self-sustaining 3D inifinitely thin disk against its own gravity through centripedal acceleration</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">            </span>
<span class="sd">            V(r) = V_{\rm{max}} \frac{r}{0.8798243 \times R_{\rm{d}}} \sqrt{I_0(y) K_0(y) - I_1 (y) K_1 (y)}</span>
<span class="sd">            </span>
<span class="sd">        where :math:`I_i, K_i` are the modified Bessel functions of the first and second kind, respectively, of order i, and  :math:`y = r/(2 R_{\rm{d}})`.</span>

<span class="sd">        :param r: radius where the velocity profile is computed</span>
<span class="sd">        :type r: int, float, astropy Quantity or ndarray[float]</span>
<span class="sd">        </span>
<span class="sd">        :returns: velocity profile at a radius **r** in :math:`\rm{km/s}`</span>
<span class="sd">        :rtype: Astropy Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if **r** is neither int, float, np.float16, np.float32, np.foat64 or ndarray</span>
<span class="sd">        '''</span>
        
        <span class="n">r</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vr</span>   <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'km/s'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span>    <span class="o">=</span> <span class="n">r</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="p">)</span>
                <span class="n">vr</span>   <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span><span class="o">*</span><span class="n">r</span><span class="o">/</span><span class="p">(</span><span class="mf">0.8798243</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">i0</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">k0</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">i1</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">k1</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">vr</span>       <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">r</span><span class="p">)),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'km/s'</span><span class="p">)</span>
            <span class="n">mask</span>     <span class="o">=</span> <span class="n">r</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="n">rmask</span>    <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">y</span>        <span class="o">=</span> <span class="n">rmask</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="p">)</span>
            <span class="n">vr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vmax</span><span class="o">*</span><span class="n">rmask</span><span class="o">/</span><span class="p">(</span><span class="mf">0.8798243</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">i0</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">k0</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">i1</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">k1</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'r array has type </span><span class="si">%s</span><span class="s1"> but only float and numpy array are expected.'</span> <span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">vr</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'km/s'</span><span class="p">)</span></div></div>
            
        
        

<div class="viewcode-block" id="DoubleExponentialDisk"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.DoubleExponentialDisk">[docs]</a><span class="k">class</span> <span class="nc">DoubleExponentialDisk</span><span class="p">(</span><span class="n">Sersic</span><span class="p">,</span> <span class="n">MassModelBase</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Double exponential disk profile class implementing Bovy rotation curve.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        You can either provide:</span>
<span class="sd">        </span>
<span class="sd">        * **M_L**, **hz**, **Re** and **Ie**</span>
<span class="sd">        * **M_L**, **hz**, **Re**, **mag** and **offset**</span>
<span class="sd">            </span>
<span class="sd">        You can also provide **q0** instead of **hz** (which must be None in this case).</span>
<span class="sd">        </span>
<span class="sd">        The observed or intrinsic inclination must be given with **inc** or **inc0**, respectively, if one wants to correct the central surface brightness for the effect of finite thickness.</span>
<span class="sd">        </span>
<span class="sd">    :param hz: vertical scale height</span>
<span class="sd">    :type hz: int or float</span>
<span class="sd">    :param M_L: mass to light ratio</span>
<span class="sd">    :type M_L: int or float</span>
<span class="sd">    :param Re: half-light radius in the plane of symmetry</span>
<span class="sd">    :type Re: int or float</span>
<span class="sd">    </span>
<span class="sd">    :param float inc: (**Optional**) observed inclination (not corrected of the galaxy thickness)</span>
<span class="sd">    :param float inc0: (**Optional**) intrinsic inclination (corrected of the galaxy thickness)</span>
<span class="sd">            </span>
<span class="sd">    :param float Ie: (**Optional**) intensity at half-light radius if the galaxy was seen face-on (must correct for inclination effects)</span>
<span class="sd">    :param float mag: (**Optional**) galaxy total integrated magnitude used to compute **Ie** if not given</span>
<span class="sd">    :param float offset: (**Optional**) magnitude offset in the magnitude system used</span>
<span class="sd">    :param float q0: (**Optional**) axis ratio equal to hz/Rd with Rd the disk scale length. If this value is different from None, it overrides **hz**.</span>
<span class="sd">    :param str unit_Ie: (**Optional**) unit for the surface brightness</span>
<span class="sd">    :param str unit_M_L: (**Optional**) unit of the mass to light ratio</span>
<span class="sd">    :param str unit_Re: (**Optional**) unit for the scale radius **Re**</span>
<span class="sd">    '''</span>
    
<div class="viewcode-block" id="DoubleExponentialDisk.__init__"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.DoubleExponentialDisk.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Re</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">hz</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">M_L</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> 
                 <span class="n">q0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Ie</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mag</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">inc</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">inc0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                 <span class="n">unit_Re</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'kpc'</span><span class="p">,</span> <span class="n">unit_hz</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'kpc'</span><span class="p">,</span> <span class="n">unit_Ie</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'erg/(cm^2.s.A)'</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'solMass.s.A.cm^2/(erg.kpc^2)'</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        
        <span class="n">MassModelBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">M_L</span><span class="p">,</span> <span class="n">unit_M_L</span><span class="p">)</span>
        <span class="n">Sersic</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>       <span class="bp">self</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Re</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="n">Ie</span><span class="p">,</span> <span class="n">mag</span><span class="o">=</span><span class="n">mag</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">unit_Re</span><span class="o">=</span><span class="n">unit_Re</span><span class="p">,</span> <span class="n">unit_Ie</span><span class="o">=</span><span class="n">unit_Ie</span><span class="p">)</span>
        
        <span class="c1">#: Disk scale length :math:`R_{\rm{d}} = R_{\rm{e}} / b_n`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rd</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span>
        
        <span class="k">if</span> <span class="n">q0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">q0</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">q0</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1">#: Axis ratio</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">q0</span> <span class="o">=</span> <span class="n">q0</span>
                
                <span class="c1">#: Scale height</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'q0 is equal to </span><span class="si">%s</span><span class="s1">, but it must be between 0 and 1.'</span> <span class="o">%</span><span class="n">q0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hz</span>     <span class="o">=</span> <span class="n">hz</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q0</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hz</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span>
            
        <span class="c1"># Surface density computed in Sersic assumes no thickness so we must correct for this effect if the user provides an intrinsic inclination (see Mercier et al., in prep.)</span>
        <span class="k">if</span> <span class="n">inc0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">inc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I0</span>     <span class="o">=</span> <span class="n">morpho</span><span class="o">.</span><span class="n">correct_I0</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q0</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="n">inc</span><span class="p">,</span> <span class="n">inc0</span><span class="o">=</span><span class="n">inc0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span></div>
        
        
    <span class="c1">######################################################</span>
    <span class="c1">#            Methods (alphabetical order)            #</span>
    <span class="c1">######################################################</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_Rmax_razor_thin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''Position of the maximum of the razor-thin disk curve'''</span>
        
        <span class="k">return</span> <span class="mf">2.2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span>
    
<div class="viewcode-block" id="DoubleExponentialDisk._velocity_correction"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.DoubleExponentialDisk._velocity_correction">[docs]</a>    <span class="k">def</span> <span class="nf">_velocity_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">QuantityType</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Velocity correction necessary for the rotation curve</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">        </span>
<span class="sd">            V_{\rm{corr}} (r) = V_{\rm{c, max}} \times \sqrt{\frac{r~e^{1-r/R_{\rm{d}}}}{R_{\rm{d}}}},</span>
<span class="sd">        </span>
<span class="sd">        where :math:`R_{\rm{d}}` is the disk scale length, and :math:`V_{\rm{c, max}}` is the maximum of the velocity correction.</span>

<span class="sd">        :param R: radius where the velocity correction is computed</span>
<span class="sd">        :type R: float or ndarray[float]</span>
<span class="sd">        </span>
<span class="sd">        :returns: velocity correction</span>
<span class="sd">        :rtype: float or ndarray[float]</span>
<span class="sd">        '''</span>
        
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Vmax_correction</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">R</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rd</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="DoubleExponentialDisk._velocity_razor_thin"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.DoubleExponentialDisk._velocity_razor_thin">[docs]</a>    <span class="k">def</span> <span class="nf">_velocity_razor_thin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">]:</span>
        <span class="sd">'''</span>
<span class="sd">        Velocity if the disk was razor thin.</span>
<span class="sd">                </span>
<span class="sd">        :param R: radius where the velocity is computed</span>
<span class="sd">        :type R: float or ndarray[float]</span>
<span class="sd">        </span>
<span class="sd">        :returns: velocity if the disk was razor thin</span>
<span class="sd">        :rtype: float or ndarray[float]</span>
<span class="sd">        </span>
<span class="sd">        .. seealso:: :py:meth:`ExponentialDisk.velocity`</span>
<span class="sd">        '''</span>
        
        <span class="n">R</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
        <span class="n">disk_RT</span> <span class="o">=</span> <span class="n">ExponentialDisk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">disk_RT</span><span class="o">.</span><span class="n">velocity</span><span class="p">(</span><span class="n">R</span><span class="p">)</span></div>
        
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_Vmax_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Maximum of the velocity correction</span>
<span class="sd">        </span>
<span class="sd">        .. math ::</span>
<span class="sd">            </span>
<span class="sd">            V_{\rm{c, max}} = \sqrt{2\pi G h_z \Upsilon \Sigma_0 / \exp\lbrace 1 \rbrace},</span>
<span class="sd">            </span>
<span class="sd">        with :math:`\Sigma_0` the central surface brightness if the disk was seen face-on, and :math:`\Upsilon` the mass to light ratio.</span>
<span class="sd">        '''</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hz</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">I0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_Vmax_razor_thin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sd">'''</span>
<span class="sd">        Maximum velocity if the disk was razor thin.</span>
<span class="sd">        </span>
<span class="sd">        .. seealso:: :py:meth:`ExponentialDisk.velocity`</span>
<span class="sd">        '''</span>
        
        <span class="n">disk_RT</span> <span class="o">=</span> <span class="n">ExponentialDisk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M_L</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">disk_RT</span><span class="o">.</span><span class="n">Vmax</span>
        
        
<div class="viewcode-block" id="DoubleExponentialDisk.profile"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.DoubleExponentialDisk.profile">[docs]</a>    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">z</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Light density profile at radius **R** and height **z**</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">            </span>
<span class="sd">            \rho(R, z) = \frac{\Sigma_0}{2 h_z} e^{-R/R_{\rm{e}} - |z|/h_z}</span>
<span class="sd">    </span>
<span class="sd">        with :math:`\Sigma_0 = I_{\rm{e}} e^{b_1}` the central surface density in the plane of the disk, :math:`R_{\rm{e}}` the disk effective radius in the plane of symmetry and :math:`h_z` the vertical scale height.</span>

<span class="sd">        :param R: radial position in the plane of symmetry</span>
<span class="sd">        :type R: int or float</span>
<span class="sd">        :param z: vertical position</span>
<span class="sd">        :type z: int or float</span>
<span class="sd">        </span>
<span class="sd">        :returns: double exponential profile computed at position (**R**, **z**)</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        '''</span>
        
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hz</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sersic_profile</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">,</span> <span class="n">Ie</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="p">,</span> <span class="n">bn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">hz</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hz</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="DoubleExponentialDisk.velocity"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.DoubleExponentialDisk.velocity">[docs]</a>    <span class="k">def</span> <span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">inner_correction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantityType</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">'''</span>
<span class="sd">        Velocity profile for a self-sustaining 3D double exponential disk against its own gravity through centripedal acceleration</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">        </span>
<span class="sd">            V(r) = \sqrt{V_{\rm{RT}}^2 (r) - V_{\rm{corr}}^2 (r)},</span>
<span class="sd">        </span>
<span class="sd">        where :math:`V_{\rm{RT}}` is the rotation curve of a similar razor-thin disk, and :math:`V_{\rm{corr}}` is the correction to apply to take into account the finite thickness of the disk.</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            This formula is a `Bovy rotation curve &lt;http://astro.utoronto.ca/~bovy/AST1420/notes-2017/notebooks/05.-Flattened-Mass-Distributions.html#Potentials-for-disks-with-finite-thickness&gt;`_, i.e. an approximation for a thin (but non-zero thickness) disk.</span>
<span class="sd">                </span>
<span class="sd">            This rotation curve is ill-defined below a certain radius which depends on the disk thickness since the correction will become too important near the centre of the galaxy. </span>
<span class="sd">            </span>
<span class="sd">            To correct for this effect, one can use the **inner_correction** optional parameter. This parameter will approximate the rotation curve in the inner parts. The approximation, called inner ramp, corresponds to the tangent which passes through the origin. This simply writes as</span>
<span class="sd">            </span>
<span class="sd">            .. math::</span>
<span class="sd">                </span>
<span class="sd">                V(r) = V_{\rm{d}} (R_0) \times r / R_0,</span>
<span class="sd">                </span>
<span class="sd">            where :math:`V_{\rm{d}}` is the Bovy rotation curve defined above and :math:`R_0` is the radius at which the tangent line passes through the origin. From personal derivations, this radius is the solution of the following equation</span>
<span class="sd">        </span>
<span class="sd">            .. math::</span>

<span class="sd">                x^2 \left [ I_1(x) K_0(x) - I_0(x) K_1(x) \right ] + x I_1(x) K_1(x) + q_0 (x + 0.5) e^{-2x} = 0,</span>
<span class="sd">            </span>
<span class="sd">            where :math:`I_n` and :math:`K_n` are the modified Bessel functions of first and second kind, respectively, and :math:`q_0` is the disk thickness.</span>
<span class="sd">        </span>
<span class="sd">            A numerical approximation, incorrect by less than 1% in the :math:`0 &lt; q_0 &lt; 1` range, is given by</span>
<span class="sd">        </span>
<span class="sd">            .. math::</span>
<span class="sd">            </span>
<span class="sd">                \log R / R_{\rm{d}} = 0.767 + 0.86 \times x - 0.14 \times x^2 - 0.023 \times x^3 + 0.005 \times x^4 + 0.001 \times x^5,</span>
<span class="sd">        </span>
<span class="sd">            where :math:`x = \log q_0`.</span>
<span class="sd">            </span>
<span class="sd">        :param R: radius where the velocity is computed</span>
<span class="sd">        :type R: float or ndarray[float]</span>
<span class="sd">        </span>
<span class="sd">        :param bool inner_correction: (**Optional**) whether to apply the correction in the inner parts (ramp approximation) or not</span>
<span class="sd">        </span>
<span class="sd">        :returns: velocity in :math:`\rm{km/s}`</span>
<span class="sd">        :rtype: Astropy Quantity</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if **R** is neither int, float, np.float16, np.float32, np.foat64 or ndarray</span>
<span class="sd">        '''</span>
        
        <span class="n">R</span>                 <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
        <span class="n">v_RT2</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_razor_thin</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># Razor thin velocity squared</span>
        <span class="n">v_corr2</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_correction</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># Bovy approximation correction squared</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            
            <span class="k">if</span> <span class="n">inner_correction</span> <span class="ow">and</span> <span class="n">R</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramp_radius</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">q0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vr</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner_ramp_approximation</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">v_RT2</span> <span class="o">&lt;</span> <span class="n">v_corr2</span><span class="p">:</span>
                <span class="n">vr</span>        <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'km/s'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vr</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v_RT2</span> <span class="o">-</span> <span class="n">v_corr2</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            
            <span class="n">vr</span>            <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">R</span><span class="p">)),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'km/s'</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">inner_correction</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">q0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mask</span>      <span class="o">=</span> <span class="n">R</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramp_radius</span>
                <span class="n">vr</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner_ramp_approximation</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask</span>      <span class="o">=</span> <span class="n">v_corr2</span> <span class="o">&lt;</span> <span class="n">v_RT2</span>
                
            <span class="n">vr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v_RT2</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">v_corr2</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'R array has type </span><span class="si">%s</span><span class="s1"> but only float and numpy array are expected.'</span> <span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">vr</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'km/s'</span><span class="p">)</span></div>
     
      
    <span class="c1">#####################################################</span>
    <span class="c1">#       Inner parts linear ramp approximation       #</span>
    <span class="c1">#####################################################</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_ramp_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">'''Compute the radius where the ramp approximation ends (same unit as Rd).'''</span>
     
        <span class="n">lq0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rd</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.767</span> <span class="o">+</span> <span class="mf">0.86</span><span class="o">*</span><span class="n">lq0</span> <span class="o">-</span> <span class="mf">0.14</span><span class="o">*</span><span class="n">lq0</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.023</span><span class="o">*</span><span class="n">lq0</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mf">0.005</span><span class="o">*</span><span class="n">lq0</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mf">0.001</span><span class="o">*</span><span class="n">lq0</span><span class="o">**</span><span class="mi">5</span><span class="p">)</span>
   
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_ramp_slope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">'''Compute the slope for the ramp approximation.'''</span>
       
        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramp_radius</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">inner_correction</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">/</span> <span class="n">radius</span>
    
<div class="viewcode-block" id="DoubleExponentialDisk.inner_ramp_approximation"><a class="viewcode-back" href="../../galaxy/massModels.html#galaxy.massModels.DoubleExponentialDisk.inner_ramp_approximation">[docs]</a>    <span class="k">def</span> <span class="nf">inner_ramp_approximation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">]:</span>
        <span class="sd">'''</span>
<span class="sd">        Inner ramp approximation. This gives the linear model which is tagent to the bovy rotation curve. It is used to correct the rotation curves in the inner parts where the bovy correction becomes larger than the razor thin disk velocity.</span>

<span class="sd">        :param R: radius where to compute the velocity</span>
<span class="sd">        :type R: float or ndarray[float]</span>
<span class="sd">      </span>
<span class="sd">        :returns: velocity profile for the inner ramp</span>
<span class="sd">        :rtype: float or ndarray[float]</span>
<span class="sd">      </span>
<span class="sd">        :raises TypeError: if **R** is neither int, float, np.float16, np.float32, np.foat64 or ndarray</span>
<span class="sd">        :raises ValueError: if **R** is larger than the ramp radius</span>
<span class="sd">        '''</span>
      
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkR</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Re</span><span class="p">)</span>
      
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">R</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramp_radius</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'At least one radius in </span><span class="si">%s</span><span class="s1"> is larger than the ramp radius </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramp_radius</span><span class="p">))</span>
         
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramp_slope</span> <span class="o">*</span> <span class="n">R</span></div></div>
    
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>

        <div class="related-information">
              Copyright &#169; 2022, Wilfried Mercier |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/main.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    </body>
</html>