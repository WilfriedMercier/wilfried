
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>galfit.galfit &#8212; wilfried library 1.0 documentation</title>
    
  <link rel="stylesheet" href="../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  
  <h1 class="site-logo" id="site-title">wilfried library 1.0 documentation</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../index.html">
   Table of content
  </a>
 </li>
</ul>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../dependencies.html">
   Required dependencies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../makeLifeSimpler.html">
   makeLifeSimpler
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../galaxy/index.html">
   Galaxy module
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../galaxy/angularMomentum.html">
     Galaxies angular momentum
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../galaxy/cosmology.html">
     Cosmology computations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../galaxy/kinematics.html">
     Galaxy kinematics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../galaxy/misc.html">
     Miscellaneous
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../galaxy/massModels.html">
     Galaxy mass models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../galaxy/models.html">
     Galaxy models
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../galaxy/morphology/index.html">
     Galaxies morphology
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../galaxy/morphology/SersicFlux.html">
       Sersic fluxes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../galaxy/morphology/Morpho.html">
       Morphological parameters
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../galaxy/morphology/Thickness.html">
       Galaxies thickness
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../galaxy/morphology/MUSE.html">
       MUSE related functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../galaxy/morphology/Other.html">
       Other Sersic related functions
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../galaxy/photometry/index.html">
     Galaxies photometry
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../galaxy/photometry/Fluxes.html">
       Fluxes, colour excess and attenuation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../galaxy/photometry/Masses_SFR.html">
       Masses and SFR estimates
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../galfit/index.html">
   Galfit module
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../galfit/galfit.html">
     Galfit auto-routines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../galfit/models.html">
     Galfit models
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/WilfriedMercier/wilfried"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <h1>Source code for galfit.galfit</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>

<span class="sd">Functions related to automating galfit modelling.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span>   <span class="nn">.io</span>                              <span class="kn">import</span> <span class="n">errorMessage</span><span class="p">,</span> <span class="n">okMessage</span><span class="p">,</span> <span class="n">brightMessage</span><span class="p">,</span> <span class="n">dimMessage</span>
<span class="kn">from</span>   <span class="nn">.models</span>                          <span class="kn">import</span> <span class="n">gendeVaucouleur</span><span class="p">,</span> <span class="n">genEdgeOnDisk</span><span class="p">,</span> <span class="n">genExpDisk</span><span class="p">,</span> <span class="n">genFerrer</span><span class="p">,</span> <span class="n">genGaussian</span><span class="p">,</span> <span class="n">genKing</span><span class="p">,</span> <span class="n">genMoffat</span><span class="p">,</span> <span class="n">genNuker</span><span class="p">,</span> <span class="n">genPSF</span><span class="p">,</span> <span class="n">genSersic</span><span class="p">,</span> <span class="n">genSky</span><span class="p">,</span> <span class="n">bendingModes</span><span class="p">,</span> <span class="n">boxy_diskyness</span><span class="p">,</span> <span class="n">fourierModes</span>
<span class="kn">from</span>   <span class="nn">wilfried.utilities.dictionaries</span>  <span class="kn">import</span> <span class="n">checkDictKeys</span><span class="p">,</span> <span class="n">removeKeys</span><span class="p">,</span> <span class="n">setDict</span>
<span class="kn">from</span>   <span class="nn">wilfried.utilities.strings</span>       <span class="kn">import</span> <span class="n">putStringsTogether</span><span class="p">,</span> <span class="n">toStr</span><span class="p">,</span> <span class="n">maxStringsLen</span>
<span class="kn">from</span>   <span class="nn">wilfried.utilities.plotUtilities</span> <span class="kn">import</span> <span class="n">genMeThatPDF</span>
<span class="kn">from</span>   <span class="nn">os</span>                               <span class="kn">import</span> <span class="n">mkdir</span>
<span class="kn">import</span> <span class="nn">subprocess</span>                       <span class="k">as</span>     <span class="nn">sub</span>
<span class="kn">from</span>   <span class="nn">numpy</span>                            <span class="kn">import</span> <span class="n">unique</span><span class="p">,</span> <span class="n">array</span>
<span class="kn">import</span> <span class="nn">os.path</span>                          <span class="k">as</span>     <span class="nn">opath</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">colorama</span>                         <span class="k">as</span>     <span class="nn">col</span>
<span class="n">col</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>



<span class="c1">##########################################</span>
<span class="c1">#          Global variables              #</span>
<span class="c1">##########################################</span>

<span class="c1"># keys allowed per model. If you change a parameter name in a function declaration, you must also change the name here</span>
<span class="n">fullKeys</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;header&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;parameters&#39;</span><span class="p">:[</span><span class="s1">&#39;outputImage&#39;</span><span class="p">,</span> <span class="s1">&#39;xmin&#39;</span><span class="p">,</span> <span class="s1">&#39;xmax&#39;</span><span class="p">,</span> <span class="s1">&#39;ymin&#39;</span><span class="p">,</span> <span class="s1">&#39;ymax&#39;</span><span class="p">,</span> <span class="s1">&#39;inputImage&#39;</span><span class="p">,</span> <span class="s1">&#39;sigmaImage&#39;</span><span class="p">,</span> <span class="s1">&#39;psfImage&#39;</span><span class="p">,</span> <span class="s1">&#39;maskImage&#39;</span><span class="p">,</span> <span class="s1">&#39;couplingFile&#39;</span><span class="p">,</span> <span class="s1">&#39;psfSamplingFactor&#39;</span><span class="p">,</span> <span class="s1">&#39;zeroPointMag&#39;</span><span class="p">,</span> <span class="s1">&#39;arcsecPerPixel&#39;</span><span class="p">,</span> <span class="s1">&#39;sizeConvX&#39;</span><span class="p">,</span> <span class="s1">&#39;sizeConvY&#39;</span><span class="p">,</span> <span class="s1">&#39;displayType&#39;</span><span class="p">,</span> <span class="s1">&#39;option&#39;</span><span class="p">],</span> 
                       <span class="s1">&#39;default&#39;</span><span class="p">:[</span><span class="s1">&#39;output.fits&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;regular&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">]},</span>
                                   
            <span class="s1">&#39;deVaucouleur&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;parameters&#39;</span><span class="p">:[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="s1">&#39;re&#39;</span><span class="p">,</span> <span class="s1">&#39;bOvera&#39;</span><span class="p">,</span> <span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="s1">&#39;skipComponentInResidual&#39;</span><span class="p">,</span> <span class="s1">&#39;fixedParams&#39;</span><span class="p">,</span> <span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;noComments&#39;</span><span class="p">],</span> 
                             <span class="s1">&#39;default&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span>
                                         
            <span class="s1">&#39;edgeOnDisk&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;parameters&#39;</span><span class="p">:[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;diskScaleLength&#39;</span><span class="p">,</span> <span class="s1">&#39;diskScaleHeight&#39;</span><span class="p">,</span> <span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="s1">&#39;skipComponentInResidual&#39;</span><span class="p">,</span> <span class="s1">&#39;fixedParams&#39;</span><span class="p">,</span> <span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;noComments&#39;</span><span class="p">],</span> 
                           <span class="s1">&#39;default&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span>
                                       
            <span class="s1">&#39;expDisk&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;parameters&#39;</span><span class="p">:[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="s1">&#39;rs&#39;</span><span class="p">,</span> <span class="s1">&#39;bOvera&#39;</span><span class="p">,</span> <span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="s1">&#39;skipComponentInResidual&#39;</span><span class="p">,</span> <span class="s1">&#39;fixedParams&#39;</span><span class="p">,</span> <span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;noComments&#39;</span><span class="p">],</span> 
                        <span class="s1">&#39;default&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span>
                                    
            <span class="s1">&#39;ferrer&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;parameters&#39;</span><span class="p">:[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;alphaFerrer&#39;</span><span class="p">,</span> <span class="s1">&#39;betaFerrer&#39;</span><span class="p">,</span> <span class="s1">&#39;bOvera&#39;</span><span class="p">,</span> <span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="s1">&#39;skipComponentInResidual&#39;</span><span class="p">,</span> <span class="s1">&#39;fixedParams&#39;</span><span class="p">,</span> <span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;noComments&#39;</span><span class="p">],</span> 
                       <span class="s1">&#39;default&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span>
                                   
            <span class="s1">&#39;gaussian&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;parameters&#39;</span><span class="p">:[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="s1">&#39;FWHM&#39;</span><span class="p">,</span> <span class="s1">&#39;bOvera&#39;</span><span class="p">,</span> <span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="s1">&#39;skipComponentInResidual&#39;</span><span class="p">,</span> <span class="s1">&#39;fixedParams&#39;</span><span class="p">,</span> <span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;noComments&#39;</span><span class="p">],</span> 
                         <span class="s1">&#39;default&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span>

            <span class="s1">&#39;king&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;parameters&#39;</span><span class="p">:[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;mu0&#39;</span><span class="p">,</span> <span class="s1">&#39;rc&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;powerlaw&#39;</span><span class="p">,</span> <span class="s1">&#39;bOvera&#39;</span><span class="p">,</span> <span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="s1">&#39;skipComponentInResidual&#39;</span><span class="p">,</span> <span class="s1">&#39;fixedParams&#39;</span><span class="p">,</span> <span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;noComments&#39;</span><span class="p">],</span> 
                     <span class="s1">&#39;default&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span>

            <span class="s1">&#39;moffat&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;parameters&#39;</span><span class="p">:[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="s1">&#39;FWHM&#39;</span><span class="p">,</span> <span class="s1">&#39;powerlaw&#39;</span><span class="p">,</span> <span class="s1">&#39;bOvera&#39;</span><span class="p">,</span> <span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="s1">&#39;skipComponentInResidual&#39;</span><span class="p">,</span> <span class="s1">&#39;fixedParams&#39;</span><span class="p">,</span> <span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;noComments&#39;</span><span class="p">],</span> 
                       <span class="s1">&#39;default&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span>

            <span class="s1">&#39;nuker&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;parameters&#39;</span><span class="p">:[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;bOvera&#39;</span><span class="p">,</span> <span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="s1">&#39;skipComponentInResidual&#39;</span><span class="p">,</span> <span class="s1">&#39;fixedParams&#39;</span><span class="p">,</span> <span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;noComments&#39;</span><span class="p">],</span> 
                      <span class="s1">&#39;default&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span>

            <span class="s1">&#39;psf&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;parameters&#39;</span><span class="p">:[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="s1">&#39;skipComponentInResidual&#39;</span><span class="p">,</span> <span class="s1">&#39;fixedParams&#39;</span><span class="p">,</span> <span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;noComments&#39;</span><span class="p">],</span> 
                    <span class="s1">&#39;default&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span>
                    
            <span class="s1">&#39;sersic&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;parameters&#39;</span><span class="p">:[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="s1">&#39;re&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;bOvera&#39;</span><span class="p">,</span> <span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="s1">&#39;skipComponentInResidual&#39;</span><span class="p">,</span> <span class="s1">&#39;fixedParams&#39;</span><span class="p">,</span> <span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;noComments&#39;</span><span class="p">],</span> 
                       <span class="s1">&#39;default&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span>
                       
            <span class="s1">&#39;sky&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;parameters&#39;</span><span class="p">:[</span><span class="s1">&#39;background&#39;</span><span class="p">,</span> <span class="s1">&#39;xGradient&#39;</span><span class="p">,</span> <span class="s1">&#39;yGradient&#39;</span><span class="p">,</span> <span class="s1">&#39;skipComponentInResidual&#39;</span><span class="p">,</span> <span class="s1">&#39;fixedParams&#39;</span><span class="p">,</span> <span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;noComments&#39;</span><span class="p">],</span> 
                    <span class="s1">&#39;default&#39;</span><span class="p">:[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]}</span>
            <span class="p">}</span>
            
<span class="c1"># Every unique parameter</span>
<span class="n">everyParam</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">fullKeys</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fullKeys</span><span class="p">]:</span>
    <span class="n">everyParam</span> <span class="o">+=</span> <span class="n">i</span>
<span class="n">everyParam</span> <span class="o">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">everyParam</span><span class="p">)</span>
            
<span class="c1">#: Recognised models</span>
<span class="n">modelFunctions</span> <span class="o">=</span> <span class="p">{</span>  <span class="s1">&#39;deVaucouleur&#39;</span><span class="p">:</span> <span class="n">gendeVaucouleur</span><span class="p">,</span> 
                    <span class="s1">&#39;edgeOnDisk&#39;</span>  <span class="p">:</span> <span class="n">genEdgeOnDisk</span><span class="p">,</span>     
                    <span class="s1">&#39;expDisk&#39;</span>     <span class="p">:</span> <span class="n">genExpDisk</span><span class="p">,</span>    
                    <span class="s1">&#39;ferrer&#39;</span>      <span class="p">:</span> <span class="n">genFerrer</span><span class="p">,</span>
                    <span class="s1">&#39;gaussian&#39;</span>    <span class="p">:</span> <span class="n">genGaussian</span><span class="p">,</span>
                    <span class="s1">&#39;king&#39;</span>        <span class="p">:</span> <span class="n">genKing</span><span class="p">,</span>
                    <span class="s1">&#39;moffat&#39;</span>      <span class="p">:</span> <span class="n">genMoffat</span><span class="p">,</span>
                    <span class="s1">&#39;nuker&#39;</span>       <span class="p">:</span> <span class="n">genNuker</span><span class="p">,</span>
                    <span class="s1">&#39;psf&#39;</span>         <span class="p">:</span> <span class="n">genPSF</span><span class="p">,</span>        
                    <span class="s1">&#39;sersic&#39;</span>      <span class="p">:</span> <span class="n">genSersic</span><span class="p">,</span>
                    <span class="s1">&#39;sky&#39;</span>         <span class="p">:</span> <span class="n">genSky</span><span class="p">,</span> 
                    <span class="s1">&#39;fourier&#39;</span>     <span class="p">:</span> <span class="n">fourierModes</span><span class="p">,</span>
                    <span class="s1">&#39;bending&#39;</span>     <span class="p">:</span> <span class="n">bendingModes</span><span class="p">,</span>
                    <span class="s1">&#39;boxyness&#39;</span>    <span class="p">:</span> <span class="n">boxy_diskyness</span>
                <span class="p">}</span>

<span class="c1">#: Additional tag functions</span>
<span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fourier&#39;</span><span class="p">,</span> <span class="s1">&#39;bending&#39;</span><span class="p">,</span> <span class="s1">&#39;boxyness&#39;</span><span class="p">]</span>

<span class="c1">#: Default pdf viewer</span>
<span class="n">myPDFViewer</span> <span class="o">=</span> <span class="s1">&#39;okular&#39;</span>


<div class="viewcode-block" id="run_galfit"><a class="viewcode-back" href="../../galfit/galfit.html#galfit.galfit.run_galfit">[docs]</a><span class="k">def</span> <span class="nf">run_galfit</span><span class="p">(</span><span class="n">feedmeFiles</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="p">{},</span> <span class="n">listProfiles</span><span class="o">=</span><span class="p">[],</span> <span class="n">inputNames</span><span class="o">=</span><span class="p">[],</span> <span class="n">outputNames</span><span class="o">=</span><span class="p">[],</span> <span class="n">constraintNames</span><span class="o">=</span><span class="p">[],</span>
               <span class="n">pathFeedme</span><span class="o">=</span><span class="s2">&quot;./feedme/&quot;</span><span class="p">,</span> <span class="n">pathIn</span><span class="o">=</span><span class="s2">&quot;./inputs/&quot;</span><span class="p">,</span> <span class="n">pathOut</span><span class="o">=</span><span class="s2">&quot;./outputs/&quot;</span><span class="p">,</span> <span class="n">pathConstraints</span><span class="o">=</span><span class="s2">&quot;./constraints/&quot;</span><span class="p">,</span> <span class="n">pathLog</span><span class="o">=</span><span class="s2">&quot;./log/&quot;</span><span class="p">,</span> <span class="n">pathRecap</span><span class="o">=</span><span class="s1">&#39;./recap/&#39;</span><span class="p">,</span>
               <span class="n">constraints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">forceConfig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noGalfit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noPDF</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">showRecapFiles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">showLog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">divergingNorm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">numThreads</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Run GALFIT given some models and a header. If necessary, it creates GALFIT config files. </span>
<span class="sd">    </span>
<span class="sd">    If the FEEDME and CONSTRAINT files already exist, just use the following command to run GALFIT on all the galaxies</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; run_galfit(yourList)</span>
<span class="sd">    </span>
<span class="sd">    where yourList is a list of FEEDME files.</span>
<span class="sd">    </span>
<span class="sd">    .. note ::</span>
<span class="sd">    </span>
<span class="sd">        If at least one FEEDME file does not exist, the following information must be provided</span>
<span class="sd">        </span>
<span class="sd">        * a header</span>
<span class="sd">        * a list of profiles (models) </span>
<span class="sd">        * input (HST) file names</span>
<span class="sd">        </span>
<span class="sd">        **See** :py:func:`writeConfigs` **function for more information.**</span>
<span class="sd">    </span>
<span class="sd">        Using the correct optional arguments, one can **skip** the following steps:</span>
<span class="sd">            </span>
<span class="sd">        * FEEDME and CONSTRAINT files creation by setting **forceConfig** to False. This is done by default in order to avoid to destroy already existing input files.</span>
<span class="sd">        * GALFIT modelling by setting **noGalfit** to True. This can be useful if one only wants to make the pdf recap files when the modelling has already been done.</span>
<span class="sd">        * generating pdf recap files at the end of the program by setting **noPDF** to True</span>
<span class="sd">        * opening of the recap files at the end of the program by setting **showRecapFiles** to False</span>
<span class="sd">        * showing the content of the LOG file once the fit is complete by setting **showLog** to False. By default, LOG files are not shown.</span>

<span class="sd">    :param list[str] feedmeFiles: name of the GALFIT FILES to run galfit onto</span>
<span class="sd">                </span>
<span class="sd">    :param bool divergingNorm: (**Optional**) whether to use a diverging norm in the output pdf figure or not</span>
<span class="sd">    :param list[dict] constraints: (**Optional**)</span>
<span class="sd">        </span>
<span class="sd">        list of dictionaries used to generate the constraints. If None, no constraints are applied. </span>
<span class="sd">    </span>
<span class="sd">        Each dictionary must contain three keys, namely &#39;components&#39;, &#39;parameter&#39; and &#39;constraint&#39; (see below for use cases):</span>
<span class="sd">            </span>
<span class="sd">        * &#39;constraint&#39; : dict with keys &#39;type&#39; and &#39;value&#39;</span>
<span class="sd">            </span>
<span class="sd">            This sets the type of constraint one wants and its range. The possible &#39;type&#39; of constraints are:</span>
<span class="sd">                </span>
<span class="sd">            * &#39;offset&#39; to set the value of some parameter between different profiles relative to one another (based on the initial values provided in the FEEDME file)</span>
<span class="sd">            * &#39;ratio&#39; to fix the ratio of some parameter between different profiles (based on the initial values provided in the FEEDME file)</span>
<span class="sd">            * &#39;absoluteRange&#39; to set an asbolute range of values for some parameter</span>
<span class="sd">            * &#39;relativeRange&#39; to set a range of possible values around the initial value given in the FEEDME file</span>
<span class="sd">            * &#39;componentWiseRange&#39; to set a range of possible values around the initial value of the same parameter but from another component</span>
<span class="sd">            * &#39;componentWiseRatio&#39; to set a range of possible values for the ratio of the same parameter in two components</span>
<span class="sd">        </span>
<span class="sd">            And the corresponding values are:</span>
<span class="sd">            </span>
<span class="sd">            * single value for &#39;offset&#39; and &#39;ratio&#39; types</span>
<span class="sd">            * a list of two floats to define bounds for the other types</span>
<span class="sd">    </span>
<span class="sd">        * &#39;components&#39; : int or list[int]</span>
<span class="sd">        </span>
<span class="sd">            The number(s) associated to the model(s) one wants to constrain:</span>
<span class="sd">            </span>
<span class="sd">            * for &#39;offset&#39; and &#39;ratio&#39; types a list of an indefinite number of int can be given</span>
<span class="sd">            * for both relative and absolute ranges, a single profile number (int) must be given</span>
<span class="sd">            * for component wise ranges or ratios, a list of two numbers (int) must be provided</span>
<span class="sd">            </span>
<span class="sd">        * &#39;parameter&#39; : str</span>
<span class="sd">        </span>
<span class="sd">            Name of the parameter to contrain.</span>
<span class="sd">        </span>
<span class="sd">        .. rubric:: **Example**</span>
<span class="sd">                </span>
<span class="sd">        Let us assume we want to model two Sersic components such that we have :samp:`listProfiles=[sersic1, sersic2]` where</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; sersic1 = {&#39;name&#39;:&#39;sersic&#39;, &#39;x&#39;:81, &#39;y&#39;:60, &#39;n&#39;:1, &#39;fixedParams&#39;:[&#39;n&#39;],                 &#39;re&#39;:10, &#39;mag&#39;:25, &#39;PA&#39;:40}</span>
<span class="sd">        &gt;&gt;&gt; sersic2 = {&#39;name&#39;:&#39;sersic&#39;, &#39;x&#39;:81, &#39;y&#39;:60, &#39;n&#39;:4, &#39;fixedParams&#39;:[&#39;n&#39;, &#39;PA&#39;, &#39;bOvera&#39;], &#39;re&#39;:2,  &#39;mag&#39;:25}</span>
<span class="sd">        </span>
<span class="sd">        Assume we want to constrain the X coordinate of :samp:`sersic1` and :samp:`sersic2` to always be similar, then we can do</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; c1 = {&#39;components&#39;:[1, 2], &#39;parameter&#39;:&#39;x&#39;, &#39;constraint&#39;:{&#39;type&#39;:&#39;offset&#39;, &#39;value&#39;:0.0}}</span>
<span class="sd">        </span>
<span class="sd">        Similarly, for the Y coordinate, we can do</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; c2 = {&#39;components&#39;:[1, 2], &#39;parameter&#39;:&#39;y&#39;, &#39;constraint&#39;:{&#39;type&#39;:&#39;offset&#39;, &#39;value&#39;:0.0}}</span>
<span class="sd">        </span>
<span class="sd">        In both cases, the number 1 refers to the first model appearing in listProfiles (i.e. :samp:`sersic1`), and the number 2 to :samp:`sersic2`.</span>
<span class="sd">        </span>
<span class="sd">        Additionnaly, let us say we want to force the X and Y coordinates to be allowed to change by :math:`\pm 10` relative to the initial value. This can be done with</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; c3 = {&#39;components&#39;:1, &#39;parameter&#39;:&#39;x&#39;, &#39;constraint&#39;:{&#39;type&#39;:&#39;relativeRange&#39;, &#39;value&#39;:[-10, 10]}}</span>
<span class="sd">        &gt;&gt;&gt; c4 = {&#39;components&#39;:1, &#39;parameter&#39;:&#39;y&#39;, &#39;constraint&#39;:{&#39;type&#39;:&#39;relativeRange&#39;, &#39;value&#39;:[-10, 10]}}</span>
<span class="sd">        </span>
<span class="sd">        Now, it still remains to build the constraint list, so that we write</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; constraint = [c1, c2, c3, c4]</span>
<span class="sd">        </span>
<span class="sd">        And we provide :samp:`constraints=constraint` when calling :func:`run_galfit`.</span>
<span class="sd">            </span>
<span class="sd">    :param bool forceConfig: (**Optional**) whether to make all the configuration files no matter if they exist or not</span>
<span class="sd">    :param dict header: (**Optional**) dictionnary with key names corresponding to input parameter names in :py:func:`genHeader` function</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            You do not need to provide an input and an output image files as this is given with the inputNames keyword.</span>
<span class="sd">        </span>
<span class="sd">    :param list[str] inputNames: (**Optional**) list of galaxies input .fits files</span>
<span class="sd">    </span>
<span class="sd">    :param list[dict] listProfiles: (**Optional**) list of profiles (models). Each dictionnary corresponds to a profile:</span>
<span class="sd">    </span>
<span class="sd">        * A key &#39;name&#39; is mandatory to indentify the profile. Its value is one of the following:</span>
<span class="sd">            </span>
<span class="sd">            * &#39;deVaucouleur&#39; for a de Vaucouleur profile</span>
<span class="sd">            * &#39;edgeOnDisk&#39; for an edge-on (razor-thin) disk</span>
<span class="sd">            * &#39;expDisk&#39; for an exponential disk</span>
<span class="sd">            * &#39;ferrer&#39; for a Ferrer profile</span>
<span class="sd">            * &#39;gaussian&#39; for a Gaussian </span>
<span class="sd">            * &#39;king&#39; for a King profile</span>
<span class="sd">            * &#39;moffat&#39; for a Moffat profile</span>
<span class="sd">            * &#39;nuker&#39; for a Nuker profile</span>
<span class="sd">            * &#39;psf&#39;</span>
<span class="sd">            * &#39;sersic&#39; for a Sersic profile</span>
<span class="sd">            * &#39;sky&#39; for a sky gradient</span>
<span class="sd">            </span>
<span class="sd">        * Other keys correspond to the parameters corresponding to each profile. **See each profile description, to know which key to use**. Only mandatory parameters can be provided as keys if the default values seem fine to you</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>

<span class="sd">            You can also add fourier modes, bending modes and/or a boxyness-diskyness parameter to each profile. To do so, provide one of the following keys:</span>
<span class="sd">            </span>
<span class="sd">            * &#39;fourier&#39;</span>
<span class="sd">            * &#39;bending&#39;</span>
<span class="sd">            * &#39;boxyness&#39;</span>
<span class="sd">                </span>
<span class="sd">            These keys must also contain dictionnaries whose keys are the parameters of the functions :py:func:`fourierModes`, :py:func:`bendingModes` and :py:func:`boxy_diskyness`.</span>
<span class="sd">            </span>
<span class="sd">        .. rubric:: **Example**</span>
<span class="sd">                       </span>
<span class="sd">        Let us assume we want to model two Sersic components such that we have :samp:`listProfiles=[sersic1, sersic2]`, where :samp:`sersic1` is an exponential disk (Sersic with n=1), and :samp:`sersic2` is a de Vaucouleurs bulge (Sersic n=4) with fixed axis ratio and PA.</span>
<span class="sd">        </span>
<span class="sd">        If we look at the function declaration for the :py:func:`genSersic` function we find the following parameters</span>
<span class="sd">        </span>
<span class="sd">        .. code::</span>
<span class="sd">            </span>
<span class="sd">            def genSersic(x=50, y=50, mag=25.0, re=10.0, n=4, bOvera=1.0, PA=0.0, skipComponentInResidual=False, fixedParams=[], comments=None, noComments=False):</span>
<span class="sd">                       </span>
<span class="sd">        For the exponential disk, we only need the Sersic index to be fixed, and we can plug typical values for the other parameters</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; sersic1 = {&#39;name&#39;:&#39;sersic&#39;, &#39;x&#39;:81, &#39;y&#39;:60, &#39;n&#39;:1, &#39;fixedParams&#39;:[&#39;n&#39;], &#39;re&#39;:10, &#39;mag&#39;:25, &#39;PA&#39;:40}</span>
<span class="sd">        </span>
<span class="sd">        For the de Vaucouleur bulge, we use the same centre, a slightly smaller bulge, and we also fix the :samp:`PA` and :samp:`bOvera`</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; sersic2 = {&#39;name&#39;:&#39;sersic&#39;, &#39;x&#39;:81, &#39;y&#39;:60, &#39;n&#39;:4, &#39;fixedParams&#39;:[&#39;n&#39;, &#39;PA&#39;, &#39;bOvera&#39;], &#39;re&#39;:2, &#39;mag&#39;:25}</span>
<span class="sd">        </span>
<span class="sd">        We do not provide the :samp:`&#39;bOvera&#39;` and :samp:`&#39;PA&#39;` values because default values are :samp:`bOvera=1` and :samp:`PA=0` which is perfect for this example.</span>
<span class="sd">            </span>
<span class="sd">                </span>
<span class="sd">    :param bool noGalfit: (**Optional**) whether to not run galfit or not</span>
<span class="sd">    :param bool noPDF: (**Optional**) whether to make the pdf recap files or not</span>
<span class="sd">    :param int numThreads: (**Optional**) number of threads used to parallelise</span>
<span class="sd">    :param list[str] outputNames: (**Optional**) list of galaxies output .fits files. If not provided, the output files will have the same name as the input ones with _out appended before the .fits extension.</span>
<span class="sd">    :param str pathFeedme: (**Optional**) location of the feedme files relative to the current folder or as an absolute path</span>
<span class="sd">    :param str pathIn: (**Optional**) location of the input files relative to the current folder or as an absolute path</span>
<span class="sd">    :param str pathLog: (**Optional**) location of the log files relative to the current folder or as an absolute path</span>
<span class="sd">    :param str pathOut: (**Optional**) location of the output files relative to the current folder or as an absolute path</span>
<span class="sd">    :param str pathRecap: (**Optional**) location of the pdf recap files relative to the current folder or as an absolute path</span>
<span class="sd">    :param bool showLog: (**Optional**) whether to show log files or not</span>
<span class="sd">    :param bool showRecapFiles: (**Optional**) whether to show the recap files made at the end or not</span>
<span class="sd">    </span>
<span class="sd">    :raises TypeError: if feedmeFiles is not a list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Enabling colored text</span>
    <span class="n">col</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
    
    <span class="c1">#################################################</span>
    <span class="c1">#                Local functions                #</span>
    <span class="c1">#################################################</span>
    
    <span class="k">def</span> <span class="nf">singleGalfit</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">all_procs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Run galfit for a single image.&#39;&#39;&#39;</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get galfit output into a variable</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;galfit&#39;</span><span class="p">,</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathFeedme</span><span class="p">,</span> <span class="n">name</span><span class="p">)])</span>
            
            <span class="c1"># Only keep the relevant part in the ouput</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Iteration &#39;</span> <span class="o">+</span> <span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Iteration&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;COUNTDOWN&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="c1"># Save content into a log file</span>
            <span class="n">log</span>  <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathLog</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.feedme&#39;</span><span class="p">,</span> <span class="s1">&#39;.log&#39;</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="n">okMessage</span><span class="p">(</span><span class="s1">&#39;Object </span><span class="si">%s</span><span class="s1"> done &#39;</span> <span class="o">%</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.feedme&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;[~</span><span class="si">%.2f%%</span><span class="s1">]&#39;</span>  <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_procs</span><span class="p">)</span><span class="o">/</span><span class="n">total_num</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
            
        <span class="k">except</span> <span class="n">sub</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">(</span><span class="s1">&#39;Galfit failed:&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Probably a segmentation fault caused by a wrong constraint name or value. Try running galfit by hand on one of the feedme files to find out what went wrong.&#39;</span><span class="p">)</span>
            
        <span class="n">semaphore</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="k">return</span> 
    
    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">maxImages</span><span class="p">,</span> <span class="n">splt</span><span class="p">,</span> <span class="n">ll</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Generate a single pdf file.&#39;&#39;&#39;</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Making pdf file recap</span><span class="si">%d</span><span class="s2">.pdf&quot;</span> <span class="o">%</span><span class="n">i</span><span class="p">)</span>
        <span class="n">mini</span>         <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">maxImages</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">splt</span> <span class="ow">or</span> <span class="n">splt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">maxi</span>     <span class="o">=</span> <span class="n">ll</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maxi</span>     <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">maxImages</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">genMeThatPDF</span><span class="p">(</span><span class="n">outputFiles</span><span class="p">[</span><span class="n">mini</span><span class="p">:</span><span class="n">maxi</span><span class="p">],</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathRecap</span><span class="p">,</span> <span class="s1">&#39;recap</span><span class="si">%d</span><span class="s1">.pdf&#39;</span> <span class="o">%</span><span class="n">i</span><span class="p">),</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">diverging</span><span class="o">=</span><span class="n">divergingNorm</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">okMessage</span><span class="p">(</span><span class="s2">&quot;Recap file number </span><span class="si">%d</span><span class="s2"> made.&quot;</span> <span class="o">%</span><span class="n">i</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">semaphore</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="k">return</span>
    
    
    <span class="c1">##########################################</span>
    <span class="c1">#            Checking section            #</span>
    <span class="c1">##########################################</span>
    
    <span class="c1"># Check input data type is okay</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">feedmeFiles</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">(</span><span class="s1">&#39;Given feedmeFiles variable is not a list&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;. Please provide a list of galfit .feedme file names. Cheers !&#39;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">numThreads</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">numThreads</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">(</span><span class="s1">&#39;Incorrect given number of threads: </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span><span class="n">numThreads</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Setting default value to &#39;</span> <span class="o">+</span> <span class="n">brightMessage</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">))</span>
        <span class="n">numThreads</span>        <span class="o">=</span> <span class="mi">1</span>
    
    <span class="c1"># Find where given .feedme files do not exist</span>
    <span class="n">notExists</span>             <span class="o">=</span> <span class="p">[</span><span class="ow">not</span> <span class="n">opath</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">pathFeedme</span> <span class="o">+</span> <span class="n">fname</span><span class="p">)</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">feedmeFiles</span><span class="p">]</span>
            
    
    <span class="c1">##################################################</span>
    <span class="c1">#          Configuration files creation          #</span>
    <span class="c1">##################################################</span>
    
    <span class="k">if</span> <span class="n">forceConfig</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">notExists</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">forceConfig</span><span class="p">:</span>
            <span class="n">notExists</span>     <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">feedmeFiles</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">answer</span>        <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">brightMessage</span><span class="p">(</span><span class="s1">&#39;Some .feedme files do not exist yet. Do you want to generate automatically the files using the provided input parameters ? [N] or Y: &#39;</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            
        <span class="k">if</span> <span class="n">forceConfig</span> <span class="ow">or</span> <span class="n">answer</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Making configuration files&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># If empty lists are given, do not apply the mask</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outputNames</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">out</span>   <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">outputNames</span><span class="p">)[</span><span class="n">notExists</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span>   <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">constraintNames</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">con</span>   <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">constraintNames</span><span class="p">)[</span><span class="n">notExists</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">con</span>   <span class="o">=</span> <span class="p">[]</span>
        
                <span class="n">writeConfigs</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">listProfiles</span><span class="p">,</span> <span class="n">inputNames</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">inputNames</span><span class="p">)[</span><span class="n">notExists</span><span class="p">]),</span> <span class="n">outputNames</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">constraintNames</span><span class="o">=</span><span class="n">con</span><span class="p">,</span> <span class="n">feedmeNames</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">feedmeFiles</span><span class="p">)[</span><span class="n">notExists</span><span class="p">]),</span>
                             <span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">,</span> <span class="n">pathFeedme</span><span class="o">=</span><span class="n">pathFeedme</span><span class="p">,</span> <span class="n">pathIn</span><span class="o">=</span><span class="n">pathIn</span><span class="p">,</span> <span class="n">pathOut</span><span class="o">=</span><span class="n">pathOut</span><span class="p">,</span> <span class="n">pathConstraints</span><span class="o">=</span><span class="n">pathConstraints</span><span class="p">)</span>
                    
                <span class="n">notExists</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">notExists</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">(</span><span class="s2">&quot;An Error occured during galfit configuration file creation.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">e</span>
                
                
    <span class="c1">##########################################################################</span>
    <span class="c1">#                      Run galfit using multi processes                  #</span>
    <span class="c1">##########################################################################</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">noGalfit</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">brightMessage</span><span class="p">(</span><span class="s2">&quot;Running galfit using multiprocesses&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; (</span><span class="si">%d</span><span class="s1"> threads used)&#39;</span> <span class="o">%</span><span class="n">numThreads</span><span class="p">)</span>
        
        <span class="c1"># Make log directory if it does not exist yet</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opath</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">pathLog</span><span class="p">):</span>
            <span class="n">mkdir</span><span class="p">(</span><span class="n">pathLog</span><span class="p">)</span>
        
        <span class="n">total_feedmes</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">feedmeFiles</span><span class="p">)[[</span><span class="ow">not</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">notExists</span><span class="p">]]</span>
        <span class="n">total_num</span>     <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">total_feedmes</span><span class="p">)</span>
        <span class="n">semaphore</span>     <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="n">numThreads</span><span class="p">)</span>
        <span class="n">all_procs</span>     <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">total_feedmes</span><span class="p">):</span>
            <span class="n">semaphore</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
            <span class="n">proc</span>      <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">singleGalfit</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">all_procs</span><span class="p">))</span>
            <span class="n">all_procs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span>
            <span class="n">proc</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_procs</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    
        <span class="c1"># Move the galfit files to log directory as well</span>
        <span class="n">sub</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;mv galfit.[0-9]* </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">pathLog</span><span class="p">],</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1">#############################################################</span>
    <span class="c1">#                 Generate pdf recap files                  #</span>
    <span class="c1">#############################################################</span>
    
    <span class="c1"># Matplotlib forces pdf images to have a maximum size. This corresponds to ~100 lines of plots given the plot size taken</span>
    <span class="n">outputFiles</span>      <span class="o">=</span> <span class="p">[</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathOut</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">outputNames</span><span class="p">]</span>
    <span class="n">ll</span>               <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">outputFiles</span><span class="p">)</span>
    <span class="n">maxImages</span>        <span class="o">=</span> <span class="mi">100</span>
    <span class="n">splt</span>             <span class="o">=</span> <span class="n">ll</span> <span class="o">//</span> <span class="n">maxImages</span>
    
    <span class="c1"># If there are less figures than the maximum allowed, we want a single pdf file</span>
    <span class="k">if</span> <span class="n">splt</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">splt</span>         <span class="o">=</span> <span class="mi">1</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">noPDF</span><span class="p">:</span>
        <span class="n">semaphore</span>        <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="n">numThreads</span><span class="p">)</span>
        <span class="n">all_procs</span>        <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Making pdf recap files&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">splt</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>                
            <span class="n">semaphore</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
            <span class="n">proc</span>         <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">maxImages</span><span class="p">,</span> <span class="n">splt</span><span class="p">,</span> <span class="n">ll</span><span class="p">))</span>
            <span class="n">all_procs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span>
            <span class="n">proc</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>        
            
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_procs</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>    
    
    
    <span class="c1">#############################################</span>
    <span class="c1">#               Show log file               #</span>
    <span class="c1">#############################################</span>
    
    <span class="k">if</span> <span class="n">showLog</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Showing log files&quot;</span><span class="p">)</span>
        
        <span class="n">logFiles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">pathLog</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.feedme&#39;</span><span class="p">,</span> <span class="s1">&#39;.log&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">feedmeFiles</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">logFiles</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>   
        
        
    <span class="c1">#######################################################</span>
    <span class="c1">#                   Show recap files                  # </span>
    <span class="c1">#######################################################</span>
                
    <span class="k">def</span> <span class="nf">askAgain</span><span class="p">(</span><span class="n">recapName</span><span class="p">,</span> <span class="n">showTips</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">myPDFViewer</span>
        
        <span class="n">myPDFViewer</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">(</span><span class="s1">&#39;Opening failed:&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Probably cannot find given pdf viewer &#39;</span> <span class="o">+</span> <span class="n">brightMessage</span><span class="p">(</span><span class="n">myPDFViewer</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;. Please provide a correct software name: &#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">showTips</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">dimMessage</span><span class="p">(</span><span class="s1">&#39;Tips: for next uses, you can change the myPDFViewer global variable in the Global Variable section of galfit.py and set it to your favourite pdf viewer.&#39;</span><span class="p">))</span>
        <span class="k">return</span>
    
    <span class="k">if</span> <span class="n">showRecapFiles</span><span class="p">:</span>
        <span class="k">global</span> <span class="n">myPDFViewer</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Trying to open recap files located in &#39;</span> <span class="o">+</span> <span class="n">brightMessage</span><span class="p">(</span><span class="n">pathRecap</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; with &#39;</span> <span class="o">+</span>  <span class="n">brightMessage</span><span class="p">(</span><span class="n">myPDFViewer</span><span class="p">))</span>
        <span class="n">recap</span>     <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathRecap</span><span class="p">,</span> <span class="s1">&#39;recap&#39;</span><span class="p">)</span>
        <span class="n">showTips</span>  <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">splt</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">recapName</span>        <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%d</span><span class="s1">.pdf&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">recap</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Showing recap file &#39;</span> <span class="o">+</span> <span class="n">brightMessage</span><span class="p">(</span><span class="n">recapName</span><span class="p">))</span>
            
            <span class="k">try</span><span class="p">:</span>
                
                <span class="n">code</span>         <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">myPDFViewer</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">recapName</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">returncode</span>
                
                <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">askAgain</span><span class="p">(</span><span class="n">recapName</span><span class="p">,</span> <span class="n">showTips</span><span class="o">=</span><span class="n">showTips</span><span class="p">)</span>
                        <span class="n">code</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">myPDFViewer</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">recapName</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">returncode</span>
                        
                        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">OSError</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">OSError</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">(</span><span class="s1">&#39;Could not open pdf recap file </span><span class="si">%s</span><span class="s1"> with pdf viewer </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">recapName</span><span class="p">,</span> <span class="n">myPDFViewer</span><span class="p">)))</span>
    
    <span class="c1"># Disabling future colored text</span>
    <span class="n">col</span><span class="o">.</span><span class="n">deinit</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">True</span></div>
     

<div class="viewcode-block" id="writeConfigs"><a class="viewcode-back" href="../../galfit/galfit.html#galfit.galfit.writeConfigs">[docs]</a><span class="k">def</span> <span class="nf">writeConfigs</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">listProfiles</span><span class="p">,</span> <span class="n">inputNames</span><span class="p">,</span> <span class="n">outputNames</span><span class="o">=</span><span class="p">[],</span> <span class="n">feedmeNames</span><span class="o">=</span><span class="p">[],</span> <span class="n">constraintNames</span><span class="o">=</span><span class="p">[],</span> <span class="n">constraints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">pathFeedme</span><span class="o">=</span><span class="s2">&quot;./feedme/&quot;</span><span class="p">,</span> <span class="n">pathIn</span><span class="o">=</span><span class="s2">&quot;./inputs/&quot;</span><span class="p">,</span> <span class="n">pathOut</span><span class="o">=</span><span class="s2">&quot;./outputs/&quot;</span><span class="p">,</span> <span class="n">pathConstraints</span><span class="o">=</span><span class="s2">&quot;./constraints/&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Make galfit FEEDME and CONSTRAINT files using the same profiles.</span>
<span class="sd">    </span>
<span class="sd">    :param dict header: dictionnary with key names corresponding to input parameter names in genHeader function. **See :py:func:run_galfit for more information**.</span>
<span class="sd">    :param list[str] inputNames: list of galaxies input .fits files</span>
<span class="sd">    :param list[dict] listProfiles: list of profiles (models). **See :py:func:run_galfit for more information**.</span>
<span class="sd">    </span>
<span class="sd">    :param list[str] constraintNames: (**Optional**) list of CONSTRAINT files. If not provided, the constraint files will have the same name as the input ones but with a .constraints extension at the end.</span>
<span class="sd">    :param list[str] feedmeNames: (**Optional**) list of FEEDME files. If not provided, the feedme files will have the same name as the input ones but with .feedme extensions at the end.</span>
<span class="sd">    :param list[str] outputNames: (**Optional**) list of galaxies output .fits files. If not provided, the output files will have the same name as the input ones with _out appended before the .fits extension.</span>
<span class="sd">    :param str pathFeedme: (**Optional**) location of the feedme files relative to the current folder or as an absolute path</span>
<span class="sd">    :param str pathIn: (**Optional**) location of the input files relative to the current folder or as an absolute path</span>
<span class="sd">    :param str pathOut: (**Optional**) location of the output files relative to the current folder or as an absolute path</span>
<span class="sd">    </span>
<span class="sd">    :param dict constraints: (**Optional**) list of dictionaries used to generate the constraints. If None, no constraints are applied. **See :py:func:run_galfit for more information**.</span>
<span class="sd">    </span>
<span class="sd">    :raises ValueError: if inputNames, outputName, feedmeNames and constraintNames are not iterables of the same length</span>
<span class="sd">    :raises OSError: if pathIn, pathOut, pathFeedme or pathConstraints are not correct path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">################################################</span>
    <span class="c1">#          Checking input parameters           #</span>
    <span class="c1">################################################</span>
    
    <span class="k">if</span> <span class="n">feedmeNames</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">feedmeNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.fits&#39;</span><span class="p">,</span> <span class="s1">&#39;.feedme&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inputNames</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">outputNames</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">outputNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.fits&#39;</span><span class="p">,</span> <span class="s1">&#39;_out.fits&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inputNames</span><span class="p">]</span>
        
    <span class="k">if</span> <span class="n">constraintNames</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">constraintNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.fits&#39;</span><span class="p">,</span> <span class="s1">&#39;.constraints&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inputNames</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputNames</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">outputNames</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputNames</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">feedmeNames</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputNames</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">constraintNames</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Lists intputNames, outputNames, feedmeNames and constraintNames do not have the same length. Please provide lists with similar length in order to know how many feedme files to generate. Cheers !&quot;</span><span class="p">)</span>
  
    <span class="k">if</span> <span class="n">pathIn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pathIn</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opath</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">pathIn</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;Given path </span><span class="si">%s</span><span class="s2"> does not exist or is not a directory. Please provide an existing directory before making the .feedme files. Cheers !&quot;</span> <span class="o">%</span><span class="n">pathIn</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="ow">not</span> <span class="n">opath</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">pathOut</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;Given path </span><span class="si">%s</span><span class="s2"> does not exist or is not a directory. Please provide an existing directory before making the .feedme files. Cheers !&quot;</span> <span class="o">%</span><span class="n">pathOut</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="ow">not</span> <span class="n">opath</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">pathFeedme</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;Given path </span><span class="si">%s</span><span class="s2"> does not exist or is not a directory. Please provide an existing directory before making the .feedme files. Cheers !&quot;</span> <span class="o">%</span><span class="n">pathFeedme</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">constraints</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No constraints provided. Parameters are free to vary as much they want.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opath</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">pathConstraints</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;Given path </span><span class="si">%s</span><span class="s2"> does not exist or is not a directory. Please provide an existing directory before making the .feedme files. Cheers !&quot;</span> <span class="o">%</span><span class="n">pathConstraints</span><span class="p">)</span>

    <span class="c1">#################################################################</span>
    <span class="c1">#                Writing feedme and constraint files            #</span>
    <span class="c1">#################################################################</span>
    
    <span class="k">for</span> <span class="n">inp</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">fee</span><span class="p">,</span> <span class="n">con</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">inputNames</span><span class="p">,</span> <span class="n">outputNames</span><span class="p">,</span> <span class="n">feedmeNames</span><span class="p">,</span> <span class="n">constraintNames</span><span class="p">):</span>

        <span class="c1"># output .constraint file</span>
        <span class="k">if</span> <span class="n">constraints</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathConstraints</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="c1"># Get formatted text</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">genConstraint</span><span class="p">(</span><span class="n">constraints</span><span class="p">)</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
                
                <span class="c1"># set header key to add the file name into the .feedme file</span>
                <span class="n">header</span><span class="p">[</span><span class="s1">&#39;couplingFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fname</span>
        
        <span class="c1"># output .feedme file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathFeedme</span><span class="p">,</span> <span class="n">fee</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            
            <span class="c1"># Set input and ouput file names</span>
            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;inputImage&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathIn</span><span class="p">,</span>  <span class="n">inp</span><span class="p">)</span>
            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;outputImage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathOut</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
            
            <span class="c1"># Get formatted text, check in genFeedme that dict keys are okay and write into file if so</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">genFeedme</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">listProfiles</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span></div>


<span class="c1">#####################################################################</span>
<span class="c1">#              General functions for galfit config files            #</span>
<span class="c1">#####################################################################</span>


<div class="viewcode-block" id="genConstraint"><a class="viewcode-back" href="../../galfit/galfit.html#galfit.galfit.genConstraint">[docs]</a><span class="k">def</span> <span class="nf">genConstraint</span><span class="p">(</span><span class="n">dicts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Make a galfit CONSTRAINT file.</span>
<span class="sd">    </span>
<span class="sd">    :param list[dict] constraintNames: list of constraint dictionaries. **See** :py:func:`run_galfit` **for more information**.</span>
<span class="sd">    </span>
<span class="sd">    :returns: CONSTRAINT file as formatted text</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    </span>
<span class="sd">    :raises TypeError: </span>
<span class="sd">        </span>
<span class="sd">        * if **dicts** is not a list</span>
<span class="sd">        * if &#39;type&#39; key in constraint dict is not an acceptable value</span>
<span class="sd">        * if &#39;components&#39; key in one of the dict is not a list</span>
<span class="sd">        * if &#39;value&#39; key in one of the dict is not a list</span>
<span class="sd">        </span>
<span class="sd">    :raises KeyError: if neither &#39;parameter&#39;, nor &#39;constraints&#39;, nor &#39;components&#39; keys are found in the dictionaries</span>
<span class="sd">    :raises ValueError: </span>
<span class="sd">        </span>
<span class="sd">        * if &#39;parameter&#39; key in one of the dict is not an acceptable value</span>
<span class="sd">        * if &#39;components&#39; key in one of the dict does not have the correct length</span>
<span class="sd">        * if &#39;type&#39; key in one of the dict does not have the correct length</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">mapParams</span><span class="p">(</span><span class="n">par</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Map the given parameter to its correct name (shall be updated as new segmentation faults are found)&#39;&#39;&#39;</span>
        
        <span class="k">if</span>   <span class="n">par</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;fwhm&#39;</span><span class="p">,</span> <span class="s1">&#39;diskscalelength&#39;</span><span class="p">,</span> <span class="s1">&#39;diskscaleheight&#39;</span><span class="p">,</span> <span class="s1">&#39;rs&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;rc&#39;</span><span class="p">]:</span>
            <span class="n">par</span> <span class="o">=</span> <span class="s1">&#39;re&#39;</span>
        <span class="k">elif</span> <span class="n">par</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;bovera&#39;</span><span class="p">:</span>
            <span class="n">par</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>
        <span class="k">elif</span> <span class="n">par</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;pa&#39;</span><span class="p">:</span>
            <span class="n">par</span> <span class="o">=</span> <span class="s1">&#39;pa&#39;</span>
        <span class="k">elif</span> <span class="n">par</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;alphaferrer&#39;</span><span class="p">,</span> <span class="s1">&#39;powerlaw&#39;</span><span class="p">]:</span>
            <span class="n">par</span> <span class="o">=</span> <span class="s1">&#39;alpha&#39;</span>
        <span class="k">elif</span> <span class="n">par</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;betaferrer&#39;</span><span class="p">:</span>
            <span class="n">par</span> <span class="o">=</span> <span class="s1">&#39;beta&#39;</span>
        
        <span class="k">return</span> <span class="n">par</span>
    

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dicts</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Given parameter &#39;dicts&#39; is not a list. Please provide a list of dictionaries. Cheers !&quot;</span><span class="p">)</span>
    
    <span class="n">everyConstraint</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="s1">&#39;ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;absoluteRange&#39;</span><span class="p">,</span> <span class="s1">&#39;relativeRange&#39;</span><span class="p">,</span> <span class="s1">&#39;componentWiseRange&#39;</span><span class="p">,</span> <span class="s1">&#39;componentWiseRatio&#39;</span><span class="p">]</span>
    
    <span class="n">compList</span>            <span class="o">=</span> <span class="p">[]</span>
    <span class="n">paramList</span>           <span class="o">=</span> <span class="p">[]</span>
    <span class="n">constraintList</span>      <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dicts</span><span class="p">:</span>
        
        <span class="c1"># Retrieve the three information (components, parameter and constraint type)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">param</span>       <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;parameter&#39;</span><span class="p">]</span>
            <span class="n">constraint</span>  <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;constraint&#39;</span><span class="p">]</span>
            <span class="n">components</span>  <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;components&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;One of the keys &#39;parameter&#39;, &#39;constraint&#39; or &#39;components&#39; is missing in one of the dictionaries.&quot;</span><span class="p">)</span>

        
        <span class="c1">############################################################</span>
        <span class="c1">#           Check that given parameters are okay           #</span>
        <span class="c1">############################################################</span>
        
        <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">everyParam</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Given parameter </span><span class="si">%s</span><span class="s1"> is not correct. Possible values are </span><span class="si">%s</span><span class="s1">. Please provide one of these values if you want to put constraints on one of these parameters. Cheers !&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">everyParam</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">constraint</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">everyConstraint</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Given constraint type </span><span class="si">%s</span><span class="s1"> is not correct. Possible values are </span><span class="si">%s</span><span class="s1">. Please provide one of these values if you want to put a constraint on parameters. Cheers !&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">constraint</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">everyConstraint</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;constraint&#39; key value in dictionary should be a dictionary with keys &#39;type&#39; and &#39;value&#39;. Please provide a dictionary with these keys for the constraint. Cheers !&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">constraint</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="s1">&#39;ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;componentWiseRange&#39;</span><span class="p">,</span> <span class="s1">&#39;componentWiseRatio&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Given components </span><span class="si">%s</span><span class="s2"> should be a list. Please provide a list. Cheers !&quot;</span> <span class="o">%</span><span class="n">components</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Given components list </span><span class="si">%s</span><span class="s2"> should contain at least two values. Please provide two component numbers at the very least. Cheers !&quot;</span> <span class="o">%</span><span class="n">components</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;componentWiseRange&#39;</span><span class="p">,</span> <span class="s1">&#39;componentWiseRatio&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Given components list </span><span class="si">%s</span><span class="s2"> should have exactly two values. Please provide only two component numbers. Cheers !&quot;</span> <span class="o">%</span><span class="n">components</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Given component </span><span class="si">%s</span><span class="s2"> sould be a single integer value corresponding to the component number. Please provide an integer. Cheers !&quot;</span> <span class="o">%</span><span class="n">components</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">constraint</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;absoluteRange&#39;</span><span class="p">,</span> <span class="s1">&#39;relativeRange&#39;</span><span class="p">,</span> <span class="s1">&#39;componentWiseRange&#39;</span><span class="p">,</span> <span class="s1">&#39;componentWiseRatio&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">constraint</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Given constraint values are not a list. Please provide two values in order to have a range. Cheers !&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">constraint</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Constraint list does have the correct amount of elements. Two values must be provided. Cheers !&quot;</span><span class="p">)</span>
        
        
        <span class="c1">#######################################</span>
        <span class="c1">#        Gather columns values        #</span>
        <span class="c1">#######################################</span>
        
        <span class="c1"># Set components</span>
        <span class="k">if</span> <span class="n">constraint</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="s1">&#39;ratio&#39;</span><span class="p">]:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">_&quot;</span> <span class="o">%</span><span class="n">num</span>
            <span class="n">compList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">constraint</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;componentWiseRange&#39;</span><span class="p">:</span>
            <span class="n">compList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">components</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;componentWiseRatio&#39;</span><span class="p">:</span>
            <span class="n">compList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">components</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">compList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">components</span><span class="p">)</span>
            
        <span class="c1"># Set constraint bounds</span>
        <span class="k">if</span> <span class="n">constraint</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="s1">&#39;ratio&#39;</span><span class="p">]:</span>
            <span class="n">constraintList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constraint</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;absoluteRange&#39;</span><span class="p">:</span>
            <span class="n">constraintList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1"> to </span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">constraint</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">constraintList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1"> </span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">constraint</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]))</span>
            
        <span class="c1"># Some parameters must change name between the feedme file and the constraint file (typically FWHM -&gt; re) so we map them</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">mapParams</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="n">paramList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        
    <span class="n">compList</span>       <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;# Component&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">compList</span>
    <span class="n">paramList</span>      <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;parameter&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">paramList</span>
    <span class="n">constraintList</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;constraint&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">constraintList</span>
        
    <span class="n">lineFormat</span>     <span class="o">=</span> <span class="s2">&quot;{:^&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">maxStringsLen</span><span class="p">(</span><span class="n">compList</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;s}   {:&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">maxStringsLen</span><span class="p">(</span><span class="n">paramList</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;s}   {:^&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">maxStringsLen</span><span class="p">(</span><span class="n">constraintList</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;s}&quot;</span>
    <span class="n">out</span>            <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">com</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span> <span class="n">con</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">compList</span><span class="p">,</span> <span class="n">paramList</span><span class="p">,</span> <span class="n">constraintList</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">con</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="s1">&#39;ratio&#39;</span><span class="p">]:</span>
            <span class="n">com</span>    <span class="o">=</span> <span class="n">com</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">out</span>       <span class="o">+=</span> <span class="n">lineFormat</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">com</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">com</span> <span class="o">==</span> <span class="s2">&quot;# Component&quot;</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="genFeedme"><a class="viewcode-back" href="../../galfit/galfit.html#galfit.galfit.genFeedme">[docs]</a><span class="k">def</span> <span class="nf">genFeedme</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">listProfiles</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Make a galfit FEEDME configuration file using the given profiles.</span>
<span class="sd">    </span>
<span class="sd">    :param dict header: (**Optional**) dictionnary with key names corresponding to input parameter names in :py:func:genHeader function</span>
<span class="sd">    :param list[dict] listProfiles: (**Optional**) list of profiles (models). **See** :py:func:`run_galfit` **for more information**.</span>
<span class="sd">                </span>
<span class="sd">    :returns: FEEDME configuration file with header and body as formatted text</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    </span>
<span class="sd">    :raises ValueError: if &#39;name&#39; key in one of the profiles is not an acceptable value</span>
<span class="sd">    :raises KeyError: if &#39;name&#39; key is missing in one of the profiles</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">header</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;header&#39;</span>
    <span class="n">correctNames</span>   <span class="o">=</span> <span class="n">fullKeys</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">dic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">header</span><span class="p">]</span> <span class="o">+</span> <span class="n">listProfiles</span><span class="p">):</span>
        <span class="c1"># Check that name is okay in dictionaries</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">correctNames</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Given name </span><span class="si">%s</span><span class="s2"> is not correct. Please provide a name among the list </span><span class="si">%s</span><span class="s2">. Cheers !&quot;</span> <span class="o">%</span><span class="n">correctNames</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Key &#39;name&#39; is not provided in one of the dictionaries.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Check that the given dictionnary only has valid keys</span>
        <span class="n">checkDictKeys</span><span class="p">(</span><span class="n">removeKeys</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">tags</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]),</span> <span class="n">keys</span><span class="o">=</span><span class="n">fullKeys</span><span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="s1">&#39;parameters&#39;</span><span class="p">],</span> <span class="n">dictName</span><span class="o">=</span><span class="s1">&#39;header or listProfiles&#39;</span><span class="p">)</span>
    
        <span class="c1"># Set default values if not provided</span>
        <span class="k">if</span> <span class="n">pos</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">setDict</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">fullKeys</span><span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="s1">&#39;parameters&#39;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="n">fullKeys</span><span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="s1">&#39;default&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">listProfiles</span><span class="p">[</span><span class="n">pos</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">setDict</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">fullKeys</span><span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="s1">&#39;parameters&#39;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="n">fullKeys</span><span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="s1">&#39;default&#39;</span><span class="p">])</span>
    
    <span class="c1"># Append each profile configuration into a variable of type str</span>
    <span class="n">out</span>      <span class="o">=</span> <span class="n">genHeader</span><span class="p">(</span><span class="o">**</span><span class="n">removeKeys</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">dic</span> <span class="ow">in</span> <span class="n">listProfiles</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">modelFunctions</span><span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]](</span><span class="o">**</span><span class="n">removeKeys</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;fourier&#39;</span><span class="p">,</span> <span class="s1">&#39;bending&#39;</span><span class="p">,</span> <span class="s1">&#39;boxyness&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">]))</span>
        
        <span class="c1"># Append tags such as fourier or bending modes if they are provided in the profile</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">modelFunctions</span><span class="p">[</span><span class="n">t</span><span class="p">](</span><span class="o">**</span><span class="n">dic</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="genHeader"><a class="viewcode-back" href="../../galfit/galfit.html#galfit.galfit.genHeader">[docs]</a><span class="k">def</span> <span class="nf">genHeader</span><span class="p">(</span><span class="n">inputImage</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">outputImage</span><span class="o">=</span><span class="s1">&#39;output.fits&#39;</span><span class="p">,</span> <span class="n">sigmaImage</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">psfImage</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">maskImage</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">couplingFile</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> 
              <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">sizeConvX</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sizeConvY</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">psfSamplingFactor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zeroPointMag</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span> <span class="n">arcsecPerPixel</span><span class="o">=</span><span class="p">[</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">],</span>
              <span class="n">displayType</span><span class="o">=</span><span class="s2">&quot;regular&quot;</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP &lt;wilfried.mercier@irap.omp.eu&gt;</span>
<span class="sd">    </span>
<span class="sd">    Constructs a galfit FEEDME header as general as possible.</span>

<span class="sd">    :param str inputImage: name of the input .fits file. </span>
<span class="sd">    </span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            If &quot;none&quot; is given, when running the feedme file, the fitting will be skipped and a model will be generated using the provided parameters.</span>
<span class="sd">        </span>
<span class="sd">    :param str outputImage: name of the file within which the image will be stored. </span>
<span class="sd">    </span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            Technically, the output &quot;image&quot; is not an image but a (1+3)D fits file, where:</span>
<span class="sd">            </span>
<span class="sd">                * layer 0 is a blank image whose header contains the fits keys</span>
<span class="sd">                * layer 1 is the original image within the fitting region</span>
<span class="sd">                * layer 2 is the model image</span>
<span class="sd">                * layer 3 is the residual between the model and the original image. </span>
<span class="sd">                </span>
<span class="sd">            The residual is computed by subtracting layer 2 from layer 1. </span>
<span class="sd">            </span>
<span class="sd">            Hence, if any galaxy component is missing in the model image (even if it was optimised), the residual will not reflect the &quot;fitness&quot; of fit.</span>
<span class="sd">    </span>
<span class="sd">    :param int xmax: maximum x coordinate of the fitting region box (in pixel)</span>
<span class="sd">    :param int xmin: minimum x coordinate of the fitting region box (in pixel)</span>
<span class="sd">    :param int ymax: maximum y coordinate of the fitting region box (in pixel)</span>
<span class="sd">    :param int ymin: minimum y coordinate of the fitting region box (in pixel)</span>
<span class="sd">    </span>
<span class="sd">    :param [float, float] arcsecPerPixel: (**Optional**) angular resolution (in arcsec) of image pixels. First element is the angular resolution in the x direction, second element in the y direction.</span>
<span class="sd">    :param displayType: (**Optional**) galfit display mode</span>
<span class="sd">    </span>
<span class="sd">        * &quot;Regular&quot; mode does not allow any interaction</span>
<span class="sd">        * &quot;Both&quot; and &quot;curses&quot; modes allow you to interact with galfit during the fitting routine (both will display a xterm terminal).</span>
<span class="sd">    :type displayType: &quot;regular&quot;, &quot;both&quot; or &quot;curses&quot;</span>
<span class="sd">    :param str couplingFile: name of the CONSTRAINT file used to add constraints on parameters</span>
<span class="sd">    :param str maskImage: name of the image with bad pixels masked. Possible options are:</span>
<span class="sd">        </span>
<span class="sd">        * a .fits file (with the same dimensions as the input image) with a value of 0 for good pixels and &gt;0 for bad pixels</span>
<span class="sd">        * an ASCII file with two columns separated by a blank space (first column x coordinate, second y coordinate) listing all the bad pixels locations</span>
<span class="sd">        </span>
<span class="sd">    :param int option: option</span>
<span class="sd">        </span>
<span class="sd">        * if 0, galfit run normally as explained above</span>
<span class="sd">        * if 1, the model image only is made using the given parameters</span>
<span class="sd">        * if 2, an image block (data, model and residual) is made using the given parameters</span>
<span class="sd">        * if 3, an image block with the first slice beeing the data, and the followings ones beeing one (best-fit) component per slice</span>
<span class="sd">   </span>
<span class="sd">    :param str psfImage: name of the psf image (fits file)</span>
<span class="sd">    :param int psfSamplingFactor: multiplicative factor used to scale the image pixel angular scale to the psf pixel angular scale if the psf is oversampled. Technically it is the ratio between the psf platescale (in arcsec/px) and the data platescale assuming the same seeing.</span>
<span class="sd">    :param str sigmaImage: name of the so called variance map (technically standard deviation map) where the value of the standard deviation of the underlying distribution of a pixel is given in place of the pixel value in the image (fits file only). If &quot;none&quot;, galfit will compute one.</span>
<span class="sd">    :param int sizeConvX: x size of the convolution box (in px)</span>
<span class="sd">    :param int sizeConvY: y size of the convolution box (in px)</span>
<span class="sd">    :param float zeroPointMag: zero point magnitude used in the definition </span>
<span class="sd">    </span>
<span class="sd">        .. math::</span>
<span class="sd">            </span>
<span class="sd">            m = -2.5 \log_{10} ({\rm{ADU}}/t_{\rm{exp}}) + {\rm{zeropoint}},</span>
<span class="sd">            </span>
<span class="sd">        where :math:`t_{\rm{exp}}` if the exposition time (generally found in the input .fits file header).</span>
<span class="sd">    </span>
<span class="sd">    :returns: header as a formatted string</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">psfSamplingFactor</span><span class="p">,</span> <span class="n">zeroPointMag</span><span class="p">,</span> <span class="n">option</span> <span class="o">=</span> <span class="n">toStr</span><span class="p">([</span><span class="n">psfSamplingFactor</span><span class="p">,</span> <span class="n">zeroPointMag</span><span class="p">,</span> <span class="n">option</span><span class="p">])</span>
    
    <span class="c1"># Define convolution box to full image and convolution center to image center if not given</span>
    <span class="n">xmaxmin</span>         <span class="o">=</span> <span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span>
    <span class="n">ymaxmin</span>         <span class="o">=</span> <span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span>
    <span class="k">if</span> <span class="n">sizeConvX</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sizeConvX</span> <span class="o">=</span> <span class="n">xmaxmin</span>
    <span class="k">if</span> <span class="n">sizeConvY</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sizeConvY</span> <span class="o">=</span> <span class="n">ymaxmin</span>
    
    <span class="c1"># Image region to fit</span>
    <span class="n">imageRegion</span>     <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
    
    <span class="c1"># Convolution box X and Y size</span>
    <span class="n">convBox</span>         <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">sizeConvX</span><span class="p">,</span> <span class="n">sizeConvY</span><span class="p">)</span>
    
    <span class="c1"># Angular size per pixel in X and Y directions</span>
    <span class="n">plateScale</span>      <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2"> </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">arcsecPerPixel</span><span class="p">)</span>
        
    <span class="c1"># Compute max text length to align columns</span>
    <span class="n">textLenMax</span>      <span class="o">=</span> <span class="n">maxStringsLen</span><span class="p">([</span><span class="n">outputImage</span><span class="p">,</span> <span class="n">inputImage</span><span class="p">,</span> <span class="n">sigmaImage</span><span class="p">,</span> <span class="n">psfImage</span><span class="p">,</span> <span class="n">psfSamplingFactor</span><span class="p">,</span> <span class="n">maskImage</span><span class="p">,</span> <span class="n">couplingFile</span><span class="p">,</span> <span class="n">imageRegion</span><span class="p">,</span> <span class="n">convBox</span><span class="p">,</span> <span class="n">zeroPointMag</span><span class="p">,</span> <span class="n">plateScale</span><span class="p">,</span> <span class="n">displayType</span><span class="p">,</span> <span class="n">option</span><span class="p">])</span>
    <span class="n">formatText</span>      <span class="o">=</span> <span class="s2">&quot;%-&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">textLenMax</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span>
    
    <span class="c1"># Generate items text </span>
    <span class="n">itemA</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;A) &quot;</span> <span class="o">+</span> <span class="n">formatText</span><span class="p">)</span><span class="o">%</span><span class="n">inputImage</span> <span class="o">+</span> <span class="s2">&quot;   # Input data image (FITS file)&quot;</span>
    <span class="n">itemB</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;B) &quot;</span> <span class="o">+</span> <span class="n">formatText</span><span class="p">)</span><span class="o">%</span><span class="n">outputImage</span> <span class="o">+</span> <span class="s2">&quot;   # Name for the output image&quot;</span>
    <span class="n">itemC</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;C) &quot;</span> <span class="o">+</span> <span class="n">formatText</span><span class="p">)</span><span class="o">%</span><span class="n">sigmaImage</span> <span class="o">+</span> <span class="s1">&#39;   # Noise image name (made from data if blank or &quot;none&quot;)&#39;</span>
    <span class="n">itemD</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;D) &quot;</span> <span class="o">+</span> <span class="n">formatText</span><span class="p">)</span><span class="o">%</span><span class="n">psfImage</span> <span class="o">+</span> <span class="s2">&quot;   # Input PSF image for convolutFITS file)&quot;</span>
    <span class="n">itemE</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;E) &quot;</span> <span class="o">+</span> <span class="n">formatText</span><span class="p">)</span><span class="o">%</span><span class="n">psfSamplingFactor</span> <span class="o">+</span> <span class="s2">&quot;   # PSF Fine-Sampling Factor&quot;</span>
    <span class="n">itemF</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;F) &quot;</span> <span class="o">+</span> <span class="n">formatText</span><span class="p">)</span><span class="o">%</span><span class="n">maskImage</span> <span class="o">+</span> <span class="s2">&quot;   # Pixel mask (ASCII file or FITS file with non-0 values)&quot;</span>
    <span class="n">itemG</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;G) &quot;</span> <span class="o">+</span> <span class="n">formatText</span><span class="p">)</span><span class="o">%</span><span class="n">couplingFile</span> <span class="o">+</span> <span class="s2">&quot;   # File with parameter ion (constraints (ASCII file)&quot;</span>
    <span class="n">itemH</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;H) &quot;</span> <span class="o">+</span> <span class="n">formatText</span><span class="p">)</span><span class="o">%</span><span class="n">imageRegion</span> <span class="o">+</span> <span class="s2">&quot;   # Image region to fit (xmin xmax ymin ymax)&quot;</span>
    <span class="n">itemI</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;I) &quot;</span> <span class="o">+</span> <span class="n">formatText</span><span class="p">)</span><span class="o">%</span><span class="n">convBox</span> <span class="o">+</span> <span class="s2">&quot;   # Size of convolution box (x y)&quot;</span>
    <span class="n">itemJ</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J) &quot;</span> <span class="o">+</span> <span class="n">formatText</span><span class="p">)</span><span class="o">%</span><span class="n">zeroPointMag</span> <span class="o">+</span> <span class="s2">&quot;   # Magnitude photometric zeropoint&quot;</span>
    <span class="n">itemK</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K) &quot;</span> <span class="o">+</span> <span class="n">formatText</span><span class="p">)</span><span class="o">%</span><span class="n">plateScale</span> <span class="o">+</span> <span class="s2">&quot;   # Plate scale (dx dy). Relevant only for Nuker/King models.&quot;</span>
    <span class="n">itemO</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;O) &quot;</span> <span class="o">+</span> <span class="n">formatText</span><span class="p">)</span><span class="o">%</span><span class="n">displayType</span> <span class="o">+</span> <span class="s2">&quot;   # Display type (regular, curses, both)&quot;</span>
    <span class="n">itemP</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;P) &quot;</span> <span class="o">+</span> <span class="n">formatText</span><span class="p">)</span><span class="o">%</span><span class="n">option</span> <span class="o">+</span> <span class="s2">&quot;   # Options: 0=normal run; 1,2=make model/imgblock &amp; quit; 3=normal run and separate components&quot;</span>
    
    <span class="n">textLenMax</span>      <span class="o">=</span> <span class="n">maxStringsLen</span><span class="p">([</span><span class="n">itemA</span><span class="p">,</span> <span class="n">itemB</span><span class="p">,</span> <span class="n">itemC</span><span class="p">,</span> <span class="n">itemD</span><span class="p">,</span> <span class="n">itemE</span><span class="p">,</span> <span class="n">itemF</span><span class="p">,</span> <span class="n">itemG</span><span class="p">,</span> <span class="n">itemH</span><span class="p">,</span> <span class="n">itemI</span><span class="p">,</span> <span class="n">itemJ</span><span class="p">,</span> <span class="n">itemK</span><span class="p">,</span> <span class="n">itemO</span><span class="p">,</span> <span class="n">itemP</span><span class="p">])</span>
    
    <span class="n">out</span> <span class="o">=</span> <span class="n">putStringsTogether</span><span class="p">([</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="n">textLenMax</span><span class="p">,</span> <span class="s2">&quot;# IMAGE PARAMETERS&quot;</span><span class="p">,</span>
                           <span class="n">itemA</span><span class="p">,</span> <span class="n">itemB</span><span class="p">,</span> <span class="n">itemC</span><span class="p">,</span> <span class="n">itemD</span><span class="p">,</span> <span class="n">itemE</span><span class="p">,</span> <span class="n">itemF</span><span class="p">,</span> <span class="n">itemG</span><span class="p">,</span> <span class="n">itemH</span><span class="p">,</span> <span class="n">itemI</span><span class="p">,</span> <span class="n">itemJ</span><span class="p">,</span> <span class="n">itemK</span><span class="p">,</span> <span class="n">itemO</span><span class="p">,</span> <span class="n">itemP</span><span class="p">,</span>
                           <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="n">textLenMax</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">out</span></div>
</pre></div>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Wilfried Mercier<br/>
        
            &copy; Copyright 2021, Wilfried Mercier.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>